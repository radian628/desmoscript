function uf(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const ff=(n,e)=>n===e,df=Symbol("solid-track"),pr={equals:ff};let dc=yc;const Ut=1,mr=2,pc={owned:null,cleanups:null,context:null,owner:null};var we=null;let gs=null,fe=null,Me=null,vt=null,Qr=0;function ir(n,e){const t=fe,i=we,r=n.length===0,s=r?pc:{owned:null,cleanups:null,context:null,owner:e===void 0?i:e},o=r?n:()=>n(()=>$t(()=>es(s)));we=s,fe=null;try{return Oi(o,!0)}finally{fe=t,we=i}}function at(n,e){e=e?Object.assign({},pr,e):pr;const t={value:n,observers:null,observerSlots:null,comparator:e.equals||void 0},i=r=>(typeof r=="function"&&(r=r(t.value)),gc(t,r));return[mc.bind(t),i]}function nn(n,e,t){const i=Fo(n,e,!1,Ut);Mi(i)}function Vo(n,e,t){dc=yf;const i=Fo(n,e,!1,Ut);(!t||!t.render)&&(i.user=!0),vt?vt.push(i):Mi(i)}function zs(n,e,t){t=t?Object.assign({},pr,t):pr;const i=Fo(n,e,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=t.equals||void 0,Mi(i),mc.bind(i)}function $t(n){if(fe===null)return n();const e=fe;fe=null;try{return n()}finally{fe=e}}function pf(n){return we===null||(we.cleanups===null?we.cleanups=[n]:we.cleanups.push(n)),n}function mc(){if(this.sources&&this.state)if(this.state===Ut)Mi(this);else{const n=Me;Me=null,Oi(()=>yr(this),!1),Me=n}if(fe){const n=this.observers?this.observers.length:0;fe.sources?(fe.sources.push(this),fe.sourceSlots.push(n)):(fe.sources=[this],fe.sourceSlots=[n]),this.observers?(this.observers.push(fe),this.observerSlots.push(fe.sources.length-1)):(this.observers=[fe],this.observerSlots=[fe.sources.length-1])}return this.value}function gc(n,e,t){let i=n.value;return(!n.comparator||!n.comparator(i,e))&&(n.value=e,n.observers&&n.observers.length&&Oi(()=>{for(let r=0;r<n.observers.length;r+=1){const s=n.observers[r],o=gs&&gs.running;o&&gs.disposed.has(s),(o?!s.tState:!s.state)&&(s.pure?Me.push(s):vt.push(s),s.observers&&bc(s)),o||(s.state=Ut)}if(Me.length>1e6)throw Me=[],new Error},!1)),e}function Mi(n){if(!n.fn)return;es(n);const e=we,t=fe,i=Qr;fe=we=n,mf(n,n.value,i),fe=t,we=e}function mf(n,e,t){let i;try{i=n.fn(e)}catch(r){return n.pure&&(n.state=Ut,n.owned&&n.owned.forEach(es),n.owned=null),n.updatedAt=t+1,wc(r)}(!n.updatedAt||n.updatedAt<=t)&&(n.updatedAt!=null&&"observers"in n?gc(n,i):n.value=i,n.updatedAt=t)}function Fo(n,e,t,i=Ut,r){const s={fn:n,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:we,context:null,pure:t};return we===null||we!==pc&&(we.owned?we.owned.push(s):we.owned=[s]),s}function gr(n){if(n.state===0)return;if(n.state===mr)return yr(n);if(n.suspense&&$t(n.suspense.inFallback))return n.suspense.effects.push(n);const e=[n];for(;(n=n.owner)&&(!n.updatedAt||n.updatedAt<Qr);)n.state&&e.push(n);for(let t=e.length-1;t>=0;t--)if(n=e[t],n.state===Ut)Mi(n);else if(n.state===mr){const i=Me;Me=null,Oi(()=>yr(n,e[0]),!1),Me=i}}function Oi(n,e){if(Me)return n();let t=!1;e||(Me=[]),vt?t=!0:vt=[],Qr++;try{const i=n();return gf(t),i}catch(i){t||(vt=null),Me=null,wc(i)}}function gf(n){if(Me&&(yc(Me),Me=null),n)return;const e=vt;vt=null,e.length&&Oi(()=>dc(e),!1)}function yc(n){for(let e=0;e<n.length;e++)gr(n[e])}function yf(n){let e,t=0;for(e=0;e<n.length;e++){const i=n[e];i.user?n[t++]=i:gr(i)}for(e=0;e<t;e++)gr(n[e])}function yr(n,e){n.state=0;for(let t=0;t<n.sources.length;t+=1){const i=n.sources[t];if(i.sources){const r=i.state;r===Ut?i!==e&&(!i.updatedAt||i.updatedAt<Qr)&&gr(i):r===mr&&yr(i,e)}}}function bc(n){for(let e=0;e<n.observers.length;e+=1){const t=n.observers[e];t.state||(t.state=mr,t.pure?Me.push(t):vt.push(t),t.observers&&bc(t))}}function es(n){let e;if(n.sources)for(;n.sources.length;){const t=n.sources.pop(),i=n.sourceSlots.pop(),r=t.observers;if(r&&r.length){const s=r.pop(),o=t.observerSlots.pop();i<r.length&&(s.sourceSlots[o]=i,r[i]=s,t.observerSlots[i]=o)}}if(n.owned){for(e=n.owned.length-1;e>=0;e--)es(n.owned[e]);n.owned=null}if(n.cleanups){for(e=n.cleanups.length-1;e>=0;e--)n.cleanups[e]();n.cleanups=null}n.state=0,n.context=null}function bf(n){return n instanceof Error?n:new Error(typeof n=="string"?n:"Unknown error",{cause:n})}function wc(n,e=we){throw bf(n)}const wf=Symbol("fallback");function Sl(n){for(let e=0;e<n.length;e++)n[e]()}function vf(n,e,t={}){let i=[],r=[],s=[],o=0,l=e.length>1?[]:null;return pf(()=>Sl(s)),()=>{let a=n()||[],c,h;return a[df],$t(()=>{let f=a.length,d,p,g,y,b,v,A,k,E;if(f===0)o!==0&&(Sl(s),s=[],i=[],r=[],o=0,l&&(l=[])),t.fallback&&(i=[wf],r[0]=ir(N=>(s[0]=N,t.fallback())),o=1);else if(o===0){for(r=new Array(f),h=0;h<f;h++)i[h]=a[h],r[h]=ir(u);o=f}else{for(g=new Array(f),y=new Array(f),l&&(b=new Array(f)),v=0,A=Math.min(o,f);v<A&&i[v]===a[v];v++);for(A=o-1,k=f-1;A>=v&&k>=v&&i[A]===a[k];A--,k--)g[k]=r[A],y[k]=s[A],l&&(b[k]=l[A]);for(d=new Map,p=new Array(k+1),h=k;h>=v;h--)E=a[h],c=d.get(E),p[h]=c===void 0?-1:c,d.set(E,h);for(c=v;c<=A;c++)E=i[c],h=d.get(E),h!==void 0&&h!==-1?(g[h]=r[c],y[h]=s[c],l&&(b[h]=l[c]),h=p[h],d.set(E,h)):s[c]();for(h=v;h<f;h++)h in g?(r[h]=g[h],s[h]=y[h],l&&(l[h]=b[h],l[h](h))):r[h]=ir(u);r=r.slice(0,o=f),i=a.slice(0)}return r});function u(f){if(s[h]=f,l){const[d,p]=at(h);return l[h]=p,e(a[h],d)}return e(a[h])}}}function Y(n,e){return $t(()=>n(e||{}))}const kf=n=>`Stale read from <${n}>.`;function xf(n){const e="fallback"in n&&{fallback:()=>n.fallback};return zs(vf(()=>n.each,n.children,e||void 0))}function Ws(n){const e=n.keyed,t=zs(()=>n.when,void 0,{equals:(i,r)=>e?i===r:!i==!r});return zs(()=>{const i=t();if(i){const r=n.children;return typeof r=="function"&&r.length>0?$t(()=>r(e?i:()=>{if(!$t(t))throw kf("Show");return n.when})):r}return n.fallback},void 0,void 0)}const Sf=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],Tf=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...Sf]),Af=new Set(["innerHTML","textContent","innerText","children"]),Cf=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Mf=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function Of(n,e){const t=Mf[n];return typeof t=="object"?t[e]?t.$:void 0:t}const Nf=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),Ef={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function Df(n,e,t){let i=t.length,r=e.length,s=i,o=0,l=0,a=e[r-1].nextSibling,c=null;for(;o<r||l<s;){if(e[o]===t[l]){o++,l++;continue}for(;e[r-1]===t[s-1];)r--,s--;if(r===o){const h=s<i?l?t[l-1].nextSibling:t[s-l]:a;for(;l<s;)n.insertBefore(t[l++],h)}else if(s===l)for(;o<r;)(!c||!c.has(e[o]))&&e[o].remove(),o++;else if(e[o]===t[s-1]&&t[l]===e[r-1]){const h=e[--r].nextSibling;n.insertBefore(t[l++],e[o++].nextSibling),n.insertBefore(t[--s],h),e[r]=t[s]}else{if(!c){c=new Map;let u=l;for(;u<s;)c.set(t[u],u++)}const h=c.get(e[o]);if(h!=null)if(l<h&&h<s){let u=o,f=1,d;for(;++u<r&&u<s&&!((d=c.get(e[u]))==null||d!==h+f);)f++;if(f>h-l){const p=e[o];for(;l<h;)n.insertBefore(t[l++],p)}else n.replaceChild(t[l++],e[o++])}else o++;else e[o++].remove()}}}const Tl="_$DX_DELEGATE";function _f(n,e,t,i={}){let r;return ir(s=>{r=s,e===document?n():se(e,n(),e.firstChild?null:void 0,t)},i.owner),()=>{r(),e.textContent=""}}function dn(n,e,t){let i;const r=()=>{const o=document.createElement("template");return o.innerHTML=n,t?o.content.firstChild.firstChild:o.content.firstChild},s=e?()=>$t(()=>document.importNode(i||(i=r()),!0)):()=>(i||(i=r())).cloneNode(!0);return s.cloneNode=s,s}function Pf(n,e=window.document){const t=e[Tl]||(e[Tl]=new Set);for(let i=0,r=n.length;i<r;i++){const s=n[i];t.has(s)||(t.add(s),e.addEventListener(s,Hf))}}function br(n,e,t){t==null?n.removeAttribute(e):n.setAttribute(e,t)}function Lf(n,e,t,i){i==null?n.removeAttributeNS(e,t):n.setAttributeNS(e,t,i)}function vc(n,e){e==null?n.removeAttribute("class"):n.className=e}function Bf(n,e,t,i){if(i)Array.isArray(t)?(n[`$$${e}`]=t[0],n[`$$${e}Data`]=t[1]):n[`$$${e}`]=t;else if(Array.isArray(t)){const r=t[0];n.addEventListener(e,t[0]=s=>r.call(n,t[1],s))}else n.addEventListener(e,t)}function If(n,e,t={}){const i=Object.keys(e||{}),r=Object.keys(t);let s,o;for(s=0,o=r.length;s<o;s++){const l=r[s];!l||l==="undefined"||e[l]||(Al(n,l,!1),delete t[l])}for(s=0,o=i.length;s<o;s++){const l=i[s],a=!!e[l];!l||l==="undefined"||t[l]===a||!a||(Al(n,l,!0),t[l]=a)}return t}function Rf(n,e,t){if(!e)return t?br(n,"style"):e;const i=n.style;if(typeof e=="string")return i.cssText=e;typeof t=="string"&&(i.cssText=t=void 0),t||(t={}),e||(e={});let r,s;for(s in t)e[s]==null&&i.removeProperty(s),delete t[s];for(s in e)r=e[s],r!==t[s]&&(i.setProperty(s,r),t[s]=r);return t}function $f(n,e={},t,i){const r={};return i||nn(()=>r.children=Nn(n,e.children,r.children)),nn(()=>e.ref&&e.ref(n)),nn(()=>Vf(n,e,t,!0,r,!0)),r}function ts(n,e,t){return $t(()=>n(e,t))}function se(n,e,t,i){if(t!==void 0&&!i&&(i=[]),typeof e!="function")return Nn(n,e,i,t);nn(r=>Nn(n,e(),r,t),i)}function Vf(n,e,t,i,r={},s=!1){e||(e={});for(const o in r)if(!(o in e)){if(o==="children")continue;r[o]=Cl(n,o,null,r[o],t,s)}for(const o in e){if(o==="children"){i||Nn(n,e.children);continue}const l=e[o];r[o]=Cl(n,o,l,r[o],t,s)}}function Ff(n){return n.toLowerCase().replace(/-([a-z])/g,(e,t)=>t.toUpperCase())}function Al(n,e,t){const i=e.trim().split(/\s+/);for(let r=0,s=i.length;r<s;r++)n.classList.toggle(i[r],t)}function Cl(n,e,t,i,r,s){let o,l,a,c,h;if(e==="style")return Rf(n,t,i);if(e==="classList")return If(n,t,i);if(t===i)return i;if(e==="ref")s||t(n);else if(e.slice(0,3)==="on:"){const u=e.slice(3);i&&n.removeEventListener(u,i),t&&n.addEventListener(u,t)}else if(e.slice(0,10)==="oncapture:"){const u=e.slice(10);i&&n.removeEventListener(u,i,!0),t&&n.addEventListener(u,t,!0)}else if(e.slice(0,2)==="on"){const u=e.slice(2).toLowerCase(),f=Nf.has(u);if(!f&&i){const d=Array.isArray(i)?i[0]:i;n.removeEventListener(u,d)}(f||t)&&(Bf(n,u,t,f),f&&Pf([u]))}else if(e.slice(0,5)==="attr:")br(n,e.slice(5),t);else if((h=e.slice(0,5)==="prop:")||(a=Af.has(e))||!r&&((c=Of(e,n.tagName))||(l=Tf.has(e)))||(o=n.nodeName.includes("-")))h&&(e=e.slice(5),l=!0),e==="class"||e==="className"?vc(n,t):o&&!l&&!a?n[Ff(e)]=t:n[c||e]=t;else{const u=r&&e.indexOf(":")>-1&&Ef[e.split(":")[0]];u?Lf(n,u,e,t):br(n,Cf[e]||e,t)}return t}function Hf(n){const e=`$$${n.type}`;let t=n.composedPath&&n.composedPath()[0]||n.target;for(n.target!==t&&Object.defineProperty(n,"target",{configurable:!0,value:t}),Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return t||document}});t;){const i=t[e];if(i&&!t.disabled){const r=t[`${e}Data`];if(r!==void 0?i.call(t,r,n):i.call(t,n),n.cancelBubble)return}t=t._$host||t.parentNode||t.host}}function Nn(n,e,t,i,r){for(;typeof t=="function";)t=t();if(e===t)return t;const s=typeof e,o=i!==void 0;if(n=o&&t[0]&&t[0].parentNode||n,s==="string"||s==="number")if(s==="number"&&(e=e.toString()),o){let l=t[0];l&&l.nodeType===3?l.data=e:l=document.createTextNode(e),t=gn(n,t,i,l)}else t!==""&&typeof t=="string"?t=n.firstChild.data=e:t=n.textContent=e;else if(e==null||s==="boolean")t=gn(n,t,i);else{if(s==="function")return nn(()=>{let l=e();for(;typeof l=="function";)l=l();t=Nn(n,l,t,i)}),()=>t;if(Array.isArray(e)){const l=[],a=t&&Array.isArray(t);if(js(l,e,t,r))return nn(()=>t=Nn(n,l,t,i,!0)),()=>t;if(l.length===0){if(t=gn(n,t,i),o)return t}else a?t.length===0?Ml(n,l,i):Df(n,t,l):(t&&gn(n),Ml(n,l));t=l}else if(e.nodeType){if(Array.isArray(t)){if(o)return t=gn(n,t,i,e);gn(n,t,null,e)}else t==null||t===""||!n.firstChild?n.appendChild(e):n.replaceChild(e,n.firstChild);t=e}else console.warn("Unrecognized value. Skipped inserting",e)}return t}function js(n,e,t,i){let r=!1;for(let s=0,o=e.length;s<o;s++){let l=e[s],a=t&&t[s],c;if(!(l==null||l===!0||l===!1))if((c=typeof l)=="object"&&l.nodeType)n.push(l);else if(Array.isArray(l))r=js(n,l,a)||r;else if(c==="function")if(i){for(;typeof l=="function";)l=l();r=js(n,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||r}else n.push(l),r=!0;else{const h=String(l);a&&a.nodeType===3&&a.data===h?n.push(a):n.push(document.createTextNode(h))}}return r}function Ml(n,e,t=null){for(let i=0,r=e.length;i<r;i++)n.insertBefore(e[i],t)}function gn(n,e,t,i){if(t===void 0)return n.textContent="";const r=i||document.createTextNode("");if(e.length){let s=!1;for(let o=e.length-1;o>=0;o--){const l=e[o];if(r!==l){const a=l.parentNode===n;!s&&!o?a?n.replaceChild(r,l):n.insertBefore(r,t):a&&l.remove()}else s=!0}}else n.insertBefore(r,t);return[r]}function kc(n,e,t){t||(t=50);const i=new IntersectionObserver(r=>{r[0]?.isIntersecting&&(e(),i.disconnect())},{rootMargin:`${t}px`});i.observe(n)}const zf=dn("<div>");function Wf(n){return(()=>{const e=zf();return ts(t=>{kc(t,()=>{const i=Desmos.GraphingCalculator(t,{graphpaper:n.graphpaper??!0});Vo(()=>{n.state()&&i.setState(n.state())})})},e),$f(e,n,!1,!1),e})()}function jf(...n){}function Ni(n,e,t,i){return{reason:n,start:e,end:t,type:"general",unit:i}}function Uf(n){return{success:!0,data:n}}function Zf(n){return{success:!1,data:n}}function oe(n){return{reason:n,internal:!0}}function ns(n,e){if(n==null)throw oe(e??"unexpected undefined");return n}function qf(n,e,t,i){return{start:n,end:e,str:t,type:i}}function Kf(n){let e=0;return{done:()=>e>=n.length,pos:()=>e,match:(t,i)=>{if(Array.isArray(t)){for(const r of t)if(n.slice(e).startsWith(r))return i||(e+=r.length),r}else if(t instanceof RegExp){const r=n.slice(e).match(t)?.[0];if(r)return i||(e+=r.length),r}else if(t instanceof Function){const r=t(n.slice(e)),s=n.slice(e,e+r);return i||(e+=r),s}else if(n.slice(e).startsWith(t))return i||(e+=t.length),t},next:t=>(e+=t,n.slice(e-t,e)),rest:()=>n.slice(e)}}function Ho(n,e,t){const i=Kf(n),r=[],s=(o,l)=>r.push(qf(i.pos()-o.length,i.pos(),o,l));for(;!i.done();){const o=i.match(/^\s*\n\s*\n\s*/);if(o){s(o,"whitespace");continue}if(i.match(/^\s+/))continue;const a=i.match(/^"[^"]*"/);if(a){s(a,"note");continue}const c=i.match([";",":","..","@"]);if(c){s(c);continue}const h=i.match(["(",")","[","]","{","}"]);if(h){s(h);continue}let u=i.match(/^[0-9]*\.[0-9]+/);if(u||(u=i.match(/^[0-9]+(\.(?!\.))?/)),u){s(u,"number");continue}const f=i.match(["->","+","-","*","/",">=","<=",">","<","==","!","^",".x",".y",".","=",","]);if(f){s(f,"op");continue}const d=i.match(/^\w+/);if(d){s(d,"ident");continue}const p=i.next(1);t.push(Ni(`did not expect '${p}'`,i.pos()-1,i.pos(),e))}return r}function Xe(n,e,t){return{type:"error",reason:n,start:e,end:t}}let Gf=0;function B(){return++Gf}function dt(n){const e=n.type;return e=="number"||e=="point"||e=="list"||e=="block"||e=="identifier"||e=="fncall"||e=="binop"||e=="unop"||e=="range"||e=="listcomp"||e=="match"||e=="note"||e=="macrocall"?Uf(n):Zf(void 0)}function Pt(n){return Array.isArray(n)?n.map(e=>Pt(e)).flat():typeof n=="object"?n.type=="error"?[n]:Pt(Object.values(n)):[]}function Yt(n,e,t){function i(r,s){if(Array.isArray(r))return r.map(o=>i(o,s));if(r&&typeof r=="object"&&typeof r.id=="number"){const o=r,l=t(o,s);Object.entries(o).forEach(([a,c])=>[a,i(c,l)])}}i(n,e)}async function xc(n,e,t){async function i(r,s){if(Array.isArray(r))return await Promise.all(r.map(o=>i(o,s)));if(r&&typeof r=="object"&&typeof r.id=="number"){const o=r,l=await t(o,s);await Promise.all(Object.entries(o).map(([a,c])=>i(c,l)))}}await i(n,e)}function Jf(n){let e=0;return{next:t=>{if(!(e>=n.length)){if(!t)for(;n[e]&&n[e].type=="whitespace";)e++;return e++,n[e-1]}},peek:t=>{let i=e;if(!t)for(;n[i]&&n[i].type=="whitespace";)i++;return n[i]},done:t=>{let i=e;for(;i<n.length;){if(n[i].type!="whitespace"||t)return!1;i++}return!0},prev:t=>{if(t){e--;return}do e--;while(n[e].type!="whitespace")},prevPeek:t=>{let i=e;if(t)return i--,n[i];do i--;while(n[i].type=="whitespace");return n[i]},stringpos:()=>n[e]?.start??n[n.length-1].start??0,stringposend:(t,i)=>{let r=Math.abs(t??0);const s=Math.sign(t??0);let o=0;for(;r>0;)o+=s,(n[e+o]?.type!="whitespace"||i)&&r--;return n[e+o]?.end??n[n.length-1].end??0},getpos:()=>e,setpos:t=>e=t}}function zo(n,e,t,i){const r=Jf(n),s=new Set,l={tokens:r,node:(c,h)=>{const u=r.stringpos(),f=r.getpos();try{const d=c({expectToken(g,y,b){const v=r.next();if(!v)throw Xe(b??`unexpected end of input: ${y}`??`unexpected end of input: expected '${g}'`,r.stringpos(),r.stringpos());if(v.str!=g)throw Xe(y??`expected '${g}', got '${v.str}'`,r.stringpos()-v.str.length-1,r.stringpos())},expectOneOfTheseTokens(g,y,b){const v=r.next();if(!v)throw Xe(b??`unexpected end of input: ${y}`??`unexpected end of input: expected one of ${g.map(A=>`'${A}'`).join(", ")}`,r.stringpos(),r.stringpos());for(const A of g)if(v.str==A)return v;throw Xe(y??`expected one of ${g.map(A=>`'${A}'`).join(", ")}, got '${v.str}'`,r.stringpos()-v.str.length,r.stringpos())},expectTokenType(g,y,b){const v=r.next();if(!v)throw Xe(b??`unexpected end of input: ${y}`??`unexpected end of input: expected a/an '${g}' token`,r.stringpos(),r.stringpos());if(v.type!=g)throw Xe(y??`expected a '${g}' token; got '${v.str}' a '${v.type}' token`,r.stringpos()-v.str.length,r.stringpos());return v},expectExpression(g){return bs(l,g??0)},expectJson(g){return Nl(l,g)},isNextToken(g){return r.peek()?.str==g},isNextTokenType(g){return r.peek()?.type==g},consumeTokenIfExists(g){return r.peek()?.str==g?(r.next(),!0):!1},expectExpressionOrStatement(g,y){const b=r.getpos(),v=Ol(l);return v.type!="error"?v:(r.setpos(b),bs(l,0))},expectAny(g){const y=r.getpos(),b=Ol(l);if(b.type!="error")return b;r.setpos(y);const v=Nl(l);return b.type!="error"?b:(r.setpos(y),bs(l,g??0))},error(g){return Xe(g)},tokenError(g){const y=r.stringpos(),b=r.stringposend();return s.has(y)&&r.next(),s.add(y),{...Xe(g),id:B(),start:y,end:b}},peek(g){const y=r.peek(g);if(!y)throw Xe("unexpected end of input");return y},maybeNext(g){return r.next(g)},maybePeek(){return r.peek()},isEnd(){return r.done()},getpos(){return r.getpos()},setpos(g){r.setpos(g)},markNoReturn(){h=!1},highlightLastToken:g=>{const y=r.prevPeek();if(!y)throw Xe("cannot highlight undefined");i?.push({start:y.start,end:y.end,type:g})},softError:(g,y,b)=>{t.push({reason:g,start:y,end:b,type:"general",unit:e})},clearErrorsFrom:(g,y)=>{for(let b=0;b<t.length;b++)(g>t[b].start||y<t[b].end)&&(t.splice(b,1),b--)}}),p=r.stringposend(-1);return d.type=="error"&&h&&r.setpos(f),{id:B(),start:u,end:p,...d}}catch(d){h&&r.setpos(f);const p=d;return p.start===void 0&&delete p.start,p.end===void 0&&delete p.end,{unitName:e,id:B(),start:u,end:r.stringpos(),...p}}}};return Wo(l,!0)}function Sc(n){return n.node(e=>{const t=[];e.expectToken("{");let i=!1,r;for(;!e.isNextToken("}");){if(r=e.expectExpression(1),!e.isNextToken(":")){i=!0;break}e.expectToken(":");const o=e.expectExpression(1);t.push([r,o]),e.isNextToken("}")||e.expectToken(",")}let s;return i&&(s=r),e.consumeTokenIfExists(","),e.expectToken("}"),{branches:t,fallback:s,type:"match"}})}function Wo(n,e){return n.node(t=>{const i=[];for(e||t.expectToken("{");!e&&!t.isNextToken("}")&&!t.isEnd()||e&&!t.isEnd();){i.push(t.expectExpressionOrStatement());const r=i[i.length-1];(!e&&!t.isNextToken("}")||e&&!t.isEnd())&&(r.type=="note"||r.type=="linebreak"?t.consumeTokenIfExists(";"):r.type=="assignment"||dt(r).success?(n.tokens.stringpos(),t.isNextToken(";")||i.push(n.node(s=>{for(;!s.isNextToken(";")&&!s.isEnd();)s.maybeNext();return{reason:"expected a ';' here",type:"error"}})),t.expectToken(";")):t.consumeTokenIfExists(";"))}return t.consumeTokenIfExists(";"),e||t.expectToken("}"),{body:i,type:"block",isRoot:e}})}function wr(n){return n.node(e=>{const t=e.consumeTokenIfExists("-")?-1:1,i=e.expectTokenType("number");return e.highlightLastToken("number"),{number:Number(i.str)*t,type:"number"}})}function jo(n){return n.node(e=>{const t=[];let i=!0;for(;i||e.isNextToken(".")||e.isNextToken(".x")||e.isNextToken(".y");){if(!i)if(e.isNextToken(".x")||e.isNextToken(".y")){const r=e.expectTokenType("op");e.highlightLastToken("keyword"),t.push(r.str[1]);continue}else e.expectToken(".");i=!1,t.push(e.expectTokenType("ident").str),(e.isNextToken(".")||e.isNextToken(".x")||e.isNextToken(".y"))&&e.highlightLastToken("variable")}return{type:"identifier",segments:t}})}function Yf(n,e){const t=[e];if(n.isNextToken("]"))return n.maybeNext(),{elements:[e],type:"list"};if(n.isNextToken("..")){n.maybeNext();const r=n.expectExpression(1);return n.expectToken("]"),{type:"range",lhs:e,rhs:r}}n.expectToken(",");const i=n.expectExpression(1);if(n.isNextToken("..")){n.maybeNext();const r=n.expectExpression(1);return n.expectToken("]"),{type:"range",lhs:e,rhs:r,step:i}}for(t.push(i);!(n.isNextToken("]")||(n.expectToken(","),n.isNextToken("]")));)t.push(n.expectExpression(1));return n.expectToken("]"),{elements:t,type:"list"}}function Xf(n,e){const t=[];for(;!n.isNextToken("]");){const i=n.expectTokenType("ident").str;n.highlightLastToken("variable"),n.expectToken("=");const r=n.expectExpression(1);if(t.push([i,r]),n.isNextToken("]"))break;n.expectToken(",")}return n.expectToken("]"),{type:"listcomp",params:t,body:e}}function Qf(n){return n.node(e=>{if(e.expectToken("["),e.isNextToken("]")){e.maybeNext(),e.expectToken("as","empty lists must have type annotations"),e.highlightLastToken("keyword");const i=e.expectOneOfTheseTokens(["point","number","polygon","color","boolean"],"invalid type: valid list type annotation types are 'point', 'number', 'polygon', 'color', or 'boolean'");return e.highlightLastToken("type"),e.expectToken("["),e.expectToken("]"),{elements:[],type:"list",typeAnnotation:i.str}}const t=e.expectExpression(1);return e.isNextToken(",")||e.isNextToken("]")||e.isNextToken("..")?Yf(e,t):(e.expectToken("for"),e.highlightLastToken("keyword"),Xf(e,t))})}function Uo(n){return n.node(e=>{const t=e.expectTokenType("note");return e.highlightLastToken("string"),{type:"note",content:t.str.slice(1,-1)}})}function ed(n){return n.node(e=>{e.expectToken("(");const t=e.expectExpression(1);if(e.isNextToken(")"))return e.maybeNext(),t;if(t.type==="binop"&&t.op==="->"){e.expectToken(",");const r={type:"binop",lhs:t,rhs:e.expectExpression(0),op:","};return e.expectToken(")"),r}e.expectToken(",","expected ',' (if a point) or ')' (if a paraenthesized expression)");const i=e.expectExpression();return e.expectToken(")"),{type:"point",x:t,y:i}})}function td(n){return n.node(e=>{const t=jo(n);if(t.type!="identifier")return e.error("expected an identifier");e.expectToken("(");const i=[];for(;!e.isEnd()&&!(e.isNextToken(")")||(i.push(e.expectExpression(1)),e.isNextToken(")")));)e.expectToken(",");return e.expectToken(")"),{type:"fncall",name:t,params:i}})}function nd(n){return n.node(e=>{const t=jo(n);if(t.type!="identifier")return e.error("expected an identifier");e.expectToken("!"),e.expectToken("(");const i=[];for(;!(e.isNextToken(")")||(i.push(e.expectAny(1)),e.isNextToken(")")));)e.expectToken(",");return e.expectToken(")"),{type:"macrocall",name:t,params:i}})}function id(n){return n.node(e=>(e.expectToken("-"),{type:"unop",op:"-",operand:e.expectExpression(6)}))}function rd(n,e,t){switch(t.type){case"note":return Uo(n);case"number":return wr(n);case"ident":{const i=e.getpos(),r=td(n);if(Pt(r).length==0)return r;e.setpos(i);const s=nd(n);return Pt(s).length==0?s:(e.setpos(i),jo(n))}default:switch(t.str){case"-":{const i=e.getpos(),r=wr(n);return Pt(r).length===0?r:(e.setpos(i),id(n))}case"[":return Qf(n);case"(":return ed(n);case"{":{const i=e.getpos(),r=Wo(n);return Pt(r).length==0?r:(e.setpos(i),Sc(n))}}throw e.tokenError(`unexpected token '${t.str}'`)}}const Tc={"^":5,"*":4,"/":4,"+":3,"-":3,">=":6,"<=":6,"==":6,">":6,"<":6,"->":2,"[":8,",":1},sd={"^":!0};function od(n){return sd[n.str]??!1}function ys(n){return Tc[n]??0}function Ac(n){return Tc[n.str]??0}function ld(n,e){return n.node(t=>{const i=t.expectTokenType("op"),r=t.expectExpression(Ac(i)-(od(i)?1:0));return{type:"binop",lhs:e,start:e.start,rhs:r,op:i.str}})}function ad(n,e,t){if(t.str=="[")return n.node(i=>{i.maybeNext();const r=i.expectExpression();return i.expectToken("]"),{type:"binop",lhs:e,start:e.start,rhs:r,op:"["}});switch(t.type){case"op":return ld(n,e);default:return}}function bs(n,e){return n.node(t=>{const i=t.peek();let r=rd(n,t,i);for(;;){if(r.type=="error")return r;const s=t.maybePeek();if(!s||Ac(s)<=e)break;const o=ad(n,r,s);if(!o)break;r=o}return r})}function cd(n){return n.node(e=>{const t=e.expectTokenType("ident").str;if(e.highlightLastToken("variable"),e.isNextToken("."))return e.error("Variables being assigned to cannot contain '.' characters!");e.expectToken("=");const i=e.expectExpression();if(i.type=="error")for(;!e.isNextToken(";")&&!e.isNextToken("}")&&!e.isEnd();)e.maybeNext();return{lhs:t,rhs:i,type:"assignment"}})}function hd(n){return n.node(e=>{if(e.expectToken("import"),e.highlightLastToken("keyword"),e.consumeTokenIfExists("script")){e.highlightLastToken("keyword");const s=e.expectTokenType("note").str.slice(1,-1);return e.highlightLastToken("string"),{type:"import-script",src:s}}const i=e.expectTokenType("note").str.slice(1,-1);e.highlightLastToken("string");let r;return e.isNextToken("as")&&(e.maybeNext(),e.highlightLastToken("keyword"),r=e.expectTokenType("ident").str,e.highlightLastToken("namespace")),{type:"import",src:i,alias:r}})}function ud(n){return n.node(e=>{e.expectToken("fn"),e.highlightLastToken("keyword");const t=e.expectTokenType("ident").str;e.highlightLastToken("function"),e.expectToken("(");const i=[];for(;!e.isNextToken(")");)i.push(e.expectTokenType("ident").str),e.highlightLastToken("variable"),e.isNextToken(")")?e.consumeTokenIfExists(","):e.expectToken(",");e.expectToken(")");const r=e.getpos();let s=Wo(n);return s.type=="error"&&(e.setpos(r),s=Sc(n)),s.type=="error"&&e.error("expected a function body surrounded by '{}' brackets or a match expression"),{type:"fndef",params:i,body:s,name:t}})}function fd(n){return n.node(e=>{e.expectToken("ns"),e.highlightLastToken("keyword");const t=e.expectTokenType("ident").str;e.highlightLastToken("namespace");let i;e.isNextToken("@")&&(i=e.expectJson());const r=e.expectExpression();return r.type!="block"&&e.error("expected a block of expressions or statements"),{type:"namespace",body:r,name:t,settings:i}})}function dd(n){return n.node(e=>{e.expectToken("show"),e.highlightLastToken("keyword");const t=e.expectExpressionOrStatement();return{type:"show",settings:e.expectJson(!0),body:t}})}function pd(n){return n.node(e=>{const t=e.expectOneOfTheseTokens(["settings","ticker"]);e.highlightLastToken("keyword");const i=e.expectJson();return{type:"settings",settingsType:t.str,content:i}})}function Ol(n){return n.node(e=>{const t=e.peek(!0);if(t.type=="whitespace")return e.maybeNext(!0),{type:"linebreak"};switch(t.str){case"import":return hd(n);case"fn":return ud(n);case"ns":return fd(n);case"show":return dd(n);case"settings":case"ticker":return pd(n);default:switch(t.type){case"ident":return cd(n);case"note":return Uo(n);default:return e.error("expected a statement")}}})}function Nl(n,e){return n.node(t=>{e?(t.expectToken("@"),t.highlightLastToken("keyword")):t.isNextToken("@")&&(t.maybeNext(),t.highlightLastToken("keyword"));const i=t.peek();switch(i.type){case"number":return wr(n);case"note":return Uo(n);case"ident":switch(i.str){case"null":return t.maybeNext(),t.highlightLastToken("macro"),{type:"json-null"};case"true":return t.maybeNext(),t.highlightLastToken("macro"),{type:"json-boolean",data:!0};case"false":return t.maybeNext(),t.highlightLastToken("macro"),{type:"json-boolean",data:!1};case"ds":{t.maybeNext(),t.highlightLastToken("keyword"),t.expectToken("(");const r=t.expectExpression();return t.expectToken(")"),{type:"json-inner-expr",expr:r}}}default:if(i.str=="{"){t.expectToken("{");const r=[];let s=!0;for(;!(t.isNextToken("}")||(s||t.expectToken(","),t.isNextToken("}")));){s=!1;const o=t.expectTokenType("ident").str;t.highlightLastToken("variable"),t.expectToken(":");const l=t.expectJson();r.push([o,l])}return t.expectToken("}"),{type:"json-object",data:r}}if(i.str=="["){t.expectToken("[");const r=[];for(;!(t.isNextToken("]")||(r.push(t.expectJson()),t.isNextToken("]")));)t.expectToken(",");return t.expectToken("]"),{type:"json-array",elements:r}}return i.str=="-"?wr(n):t.error("expected a desmoscript json expression")}})}function ue(n){return"".padStart(n," ")}function ws(n){return n.split(`
`).reduce((e,t)=>Math.max(e,t.length),0)}function md(n,e){if(!(Pt(n).length>0))return L(n,e)}function L(n,e){let t;e?t=e:t={indent:0,tabSize:2,maxlen:80,bindingPower:0};const i=r=>({...t,splitByLine:void 0,dontIndentFirst:void 0,...r});switch(n.type){case"assignment":return`${n.lhs} = ${L(n.rhs,i({indent:t.indent}))}`;case"binop":{if(t.splitByLine===void 0){let s=L(n,i({splitByLine:!1}));return s.length>t.maxlen&&(s=L(n,i({splitByLine:!0,bindingPower:ys(n.op)}))),s}const r=ys(n.op);if(t.splitByLine){if(r!=t.bindingPower)return L(n,i({splitByLine:!1,bindingPower:t.bindingPower,indent:t.indent+t.tabSize}));const s=L(n.lhs,i({bindingPower:r,splitByLine:!0})),o=L(n.rhs,i({bindingPower:r,splitByLine:!0})),l=n.op=="["?`${s}[
${o}
]`:`${s}
${ue(t.indent)}${n.op} ${o}`;return r<t.bindingPower?`(${l})`:l}else{const s=L(n.lhs,i({bindingPower:r})),o=L(n.rhs,i({bindingPower:r})),l=n.op=="["?`${s}[${o}]`:`${s} ${n.op} ${o}`;return r<t.bindingPower?`(${l})`:l}}case"block":{const r=n.isRoot?0:t.tabSize;return`${t.dontIndentFirst,""}${n.isRoot?"":"{"}${n.isRoot?"":`
`}${n.body.map((s,o)=>`${ue(t.indent+r)}${L(s,i({indent:t.indent+t.tabSize+r}))}`+(s.type!="note"&&dt(s).success&&o!=n.body.length-1||s.type=="assignment"?";":"")+`
`).join("")}${ue(t.indent)}${n.isRoot?"":"}"}`}case"error":return`##ERROR: ${n.reason}##`;case"fncall":{const r=L(n.name),s=n.params.map(l=>L(l,i({indent:t.indent+t.tabSize}))),o=`${r}(${s.join(", ")})`;return ws(o)>t.maxlen?`${r}(
${s.join(`,
${ue(t.indent+t.tabSize)}`)}
${ue(t.indent)})`:o}case"fndef":{const r=n.params.join(", "),s=i({indent:t.indent-t.tabSize,dontIndentFirst:!0}),o=`fn ${n.name}(${r}) ${L(n.body,s)}`;return r.length>t.maxlen?`fn ${n.name}(
${n.params.join(`,
${ue(t.indent+t.tabSize)}`)}
) ${L(n.body,s)}`:o}case"identifier":return n.segments.join(".");case"import":return`import "${n.src}"`+(n.alias?` as ${n.alias}`:"");case"import-script":return`import script "${n.src}"`;case"json-array":{const r=i({indent:t.indent+t.tabSize}),s=n.elements.map(l=>L(l,r)),o=`[${s.join(", ")}]`;return o.length>t.maxlen?`[
${s.join(`,
${ue(t.indent)}`)}
${ue(t.indent-t.tabSize)}]`:o}case"json-boolean":return n.data?"true":"false";case"json-inner-expr":return`ds(${L(n.expr,i({indent:t.indent+t.tabSize}))})`;case"json-null":return"null";case"json-object":{const r=i({indent:t.indent+t.tabSize}),s=n.data.map(([l,a])=>`${l}: ${L(a,r)}`),o=`@{ ${s.join(", ")} }`;return o.length>t.maxlen?`@{${s.map(l=>`
${ue(t.indent)}${l}`).join(",")}
${ue(t.indent-t.tabSize)}}`:o}case"linebreak":return"";case"list":{const r=n.typeAnnotation?` as ${n.typeAnnotation}[]`:"",s=n.elements.map(l=>L(l,i({indent:t.indent+t.tabSize}))),o=`[${s.join(", ")}]`+r;return o.length>t.maxlen?`[${s.map(l=>`
${ue(t.indent)}${l}`).join(",")}
${ue(t.indent-t.tabSize)}]`+r:o}case"listcomp":{const r=L(n.body,i({indent:t.indent+t.tabSize})),s=n.params.map(([l,a])=>`${l}=${L(a,i({indent:t.indent+t.tabSize}))}`),o=`[${r} for ${s.join(", ")}]`;return ws(o)>t.maxlen?`[${r} for${s.map(l=>`
${ue(t.indent)}${l}`).join(",")}
${ue(t.indent-t.tabSize)}]`:o}case"macrocall":{const r=L(n.name),s=n.params.map(l=>L(l,i({indent:t.indent+t.tabSize}))),o=`${r}!(${s.join(", ")})`;return ws(o)>t.maxlen?`${r}!(
${s.join(`,
${ue(t.indent+t.tabSize)}`)}
${ue(t.indent)})`:o}case"match":{const r=i({indent:t.indent+t.tabSize}),s=n.branches.map(([a,c])=>`${L(a,r)}: ${L(c,r)}`),o=n.fallback?L(n.fallback,r):"",l=`{ ${[...s,o].filter(a=>a).join(", ")} }`;return l.length>t.maxlen?`{${[...s,o].filter(a=>a).map(a=>`
${ue(t.indent)}${a}`).join(",")}
${ue(t.indent-t.tabSize)}}`:l}case"namespace":return`ns ${n.name} ${n.settings?L(n.settings,i({dontIndentFirst:!0}))+" ":""}${L(n.body,i({indent:t.indent-t.tabSize,dontIndentFirst:!0}))}`;case"note":return`"${n.content}"`;case"number":return n.number.toString();case"point":{const r=i({indent:t.indent+t.tabSize}),s=L(n.x,r),o=L(n.y,r),l=`(${s}, ${o})`;return l.length>t.maxlen?`(
${ue(t.indent+t.tabSize)}${s},
${ue(t.indent+t.tabSize)}${o}
)`:l}case"range":{const r=i({indent:t.indent+t.tabSize}),s=L(n.lhs,r),o=L(n.rhs,r);return n.step?`[${s},${L(n.step,r)}..${o}]`:`[${s}..${o}]`}case"show":return`show ${L(n.body,t)} ${L(n.settings,t)}`;case"unop":{const r=i({indent:t.indent+t.tabSize,bindingPower:ys(n.op)});return n.op.startsWith(".")?`${L(n.operand,r)}${n.op}`:`${n.op}${L(n.operand,r)}`}case"settings":{const r=i({indent:t.indent+t.tabSize});return`${n.settingsType} ${L(n.content,r)}`}default:return`Unable to format node of type ${n.type}. Stringified node: ${JSON.stringify(n)}`}}function gd(n,e){function t(i){return Array.isArray(i)?i.map(r=>t(r)):i&&typeof i=="object"&&typeof i.id=="number"?i!==n?e(i):Object.fromEntries(Object.entries(i).map(([s,o])=>[s,t(o)])):i}return t(n)}function vn(n,e,t,i,r,s,o){const l={elements:new Map,imports:[],parent:n,name:e,importScripts:[]};return n&&me(n,e,{type:"scope",scope:l,id:B(),unitName:t.unit,start:i,end:r,isWithinFunction:s,ignoreTypecheckAndCodegen:o},t.errors),l}function me(n,e,t,i){const r=n.elements.get(e);if(r&&r.type!="builtin-variable"){let s=0,o=0;r.type!="builtin-function"&&r.type!="macro"&&(s=r.start,o=r.end);const l={reason:"namespace collision",type:"namespace-collision",start:s,end:o,startB:t.type!="macro"?t?.start:void 0,endB:t.type!="macro"?t?.end:void 0,unitB:t.unitName,unit:r.unitName};i.push(l)}n.elements.delete(e),n.elements.set(e,t)}function vr(n,e,t){const i=(o,l,a)=>vr(o,{parentNode:n,scope:l??e.scope,isValueBlock:a??!0},t),r=()=>e.parentNode?.type=="show"?e.parentNode.settings.id:void 0;let s;switch(n.type){case"fndef":{const o=vn(e.scope,B().toString(),t,n.start,n.end,!0);o.name=n.name,me(e.scope,n.name,{type:"function",node:n.id,start:n.start,end:n.end,unitName:t.unit,display:r(),id:B()},t.errors);for(const l of n.params)me(o,l,{type:"builtin-variable",unitName:t.unit,id:B()},t.errors);return{...n,innerScope:o,enclosingScope:e.scope,body:i(n.body,o)}}case"namespace":{const o=vn(e.scope,n.name,t,n.start,n.end);return{...n,innerScope:o,enclosingScope:e.scope,body:i(n.body,o,!1),settings:n.settings?i(n.settings,e.scope):void 0}}case"listcomp":{const o=vn(e.scope,"listcomp"+B().toString(),t,n.start,n.end);for(const[l,a]of n.params)me(o,l,{type:"builtin-variable",unitName:t.unit,id:B()},t.errors);s={...n,innerScope:o,enclosingScope:e.scope,body:i(n.body,o),params:n.params.map(l=>[l[0],i(l[1],e.scope)])};break}case"block":{const o=e.parentNode?.type=="fndef"||e.parentNode?.type=="namespace"||n.isRoot?e.scope:vn(e.scope,"block"+B().toString(),t,n.start,n.end);s={...n,innerScope:o,enclosingScope:e.scope,body:n.body.map(l=>i(l,o))};break}case"assignment":me(e.scope,n.lhs,{type:"variable",node:n.id,start:n.start,end:n.end,unitName:t.unit,display:r(),id:B()},t.errors);break;case"note":if(e.parentNode?.type==="json-object"||e.parentNode?.type==="json-array")break;me(e.scope,B().toString(),{type:"note",text:n.content,start:n.start,end:n.end,unitName:t.unit,id:B()},t.errors);break;case"import":{const o=t.resolveImport(n.src,t.unit);if(o===void 0){t.errors.push(Ni(`failed to import '${n.src}'`,n.start,n.end,t.unit));break}n.type=="import"&&n.alias?me(e.scope,n.alias,{type:"import",compilationUnitPath:o,start:n.start,end:n.end,unitName:t.unit,id:B()},t.errors):e.scope.imports.push({compilationUnitPath:o,start:n.start,end:n.end});break}case"import-script":{const o=t.getAbsolutePath(t.unit,n.src);if(!o){t.errors.push({type:"general",start:n.start,end:n.end,reason:`Import script '${o}' does not exist.`,unit:t.unit});break}const l=t.importScripts.get(o);l||t.errors.push({type:"general",start:n.start,end:n.end,reason:`Import script '${o}' does not exist.`,unit:t.unit}),l?.run({scope:e.scope,addMacro(a){me(e.scope,a.name,{type:"macro",macroOperation:a.fn,id:B(),unitName:t.unit},t.errors)}});break}case"settings":me(e.scope,B().toString(),{type:"settings",settings:n.content.id,start:n.start,settingsType:n.settingsType,end:n.end,unitName:t.unit,id:B()},t.errors);break;case"macrocall":{const o=vn(e.scope,"macro"+B().toString(),t,n.start,n.end,void 0,!0);n.result&&!(n.result instanceof Promise)?s={innerScope:o,...n,enclosingScope:e.scope,params:n.params,name:i(n.name),result:vr(n.result,{parentNode:e.parentNode,scope:n.useInnerScope?o:e.scope},t)}:s={innerScope:o,...n,enclosingScope:e.scope,params:n.params,name:i(n.name),result:n.result}}}return dt(n).success&&n.type!="note"&&(n.type!="macrocall"||n.result&&!(n.result instanceof Promise)&&dt(n.result).success)&&(e.parentNode?.type=="block"&&(n!=e.parentNode.body[e.parentNode.body.length-1]||!e.isValueBlock||e.parentNode?.isRoot)||e.parentNode?.type=="show")&&me(e.scope,B().toString(),{type:"expression",start:n.start,end:n.end,unitName:t.unit,id:B(),expr:n.id,display:r()},t.errors),s||gd({...n,enclosingScope:e.scope},o=>n.type==="macrocall"?o:i(o))}function Cc(n,e){return n?[...Cc(n.parent),...e??[n.name]]:e??[]}function Ue(n,e,t,i,r){if(r?.has(n.name))return{result:"not-found"};const s=[];let o=e;for(;o;)s.push(o),o=o.parent;for(const l of s){let a=l;for(let c=0;c<t.length;c++){const h=t[c],u=a.elements.get(h);if(u){if(c==t.length-1)return{result:"found",identifier:u};if(u.type=="scope")a=u.scope;else if(u.type=="import"){const f=i.compilationUnits.get(u.compilationUnitPath);if(!f)throw oe(`expected a valid absolute import path; got '${u.compilationUnitPath}'`);a=f.scopeTree}else{if(c==t.length-2&&u.type=="variable"&&(t[t.length-1]=="x"||t[t.length-1]=="y"))return{result:"point-member-access",identifier:u,memberAccess:t[t.length-1]};break}}else{for(const f of a.imports){const d=i.compilationUnits.get(f.compilationUnitPath);if(r?.add(f.compilationUnitPath),!d)throw oe(`expected a valid absolute import path; got '${f.compilationUnitPath}'`);const p=Ue(d,d.scopeTree,t.slice(c),i,r??new Set(n.name));if(p.result!="not-found")return p}break}}}return{result:"not-found"}}function Mc(n,e,t,i,r){Array.from(t.entries()).reverse();const s=[];for(const[o,l]of Array.from(t.entries()).reverse())if(s.push({start:l.node.start??0,end:l.node.end??0,unit:l.nodeUnit}),r.add(l.content.id),i.id==l.content.id)break;return s.reverse(),is([{type:"circular-dependency",start:i.start??0,end:i.end??0,unit:i.unitName,path:s,reason:"circular dependency: "}])}function ii(n,e,t){return is([{type:"not-found",start:n.start,end:n.end,unit:e,reason:t}])}function q(n,e,t){return is([{type:"wrong-type",start:n.start,end:n.end,unit:e,reason:t}])}function yd(n,e,t,i){return is([{type:"bad-macro",start:n.start,end:n.end,unit:t,reason:i,why:e.map(r=>({...r,type:"general",unit:r.unitName}))}])}function is(n){return{type:"error",why:n}}function Oc(n){return n.replace("-"," ")}function bd(n,e){return n.split(`
`).map(t=>{const i=t.match(/^ */)?.[0].length??0,r=[];let s="";const o=t.split(" ");let l=0;for(const a of o)s+=a,s.length>e||l==o.length-1?(r.push(s),s=""):s+=" ",l++;return r.join(`
`.padEnd(i+1," "))}).join(`
`)}function rr(n,e){const t="".padEnd(e," ");return t+n.replace(/\n/g,`
`+t)}function wd(n,e,t){for(;e>=0;){if(n[e]==`
`&&t--,t==0)return e;e--}return 0}function vd(n,e,t){for(;e<n.length;){if(n[e]==`
`&&t--,t==0)return e;e++}return n.length}function El(n,e,t){t||(t=2);const i=n.sourceCode.get(e.unit);i.linesAndCols[e.start];const r=wd(i.src,e.start,t-1),s=vd(i.src,e.end,t);let o=i.linesAndCols[r][0];const l=Math.floor(Math.log10(o+2))+1;return`
${i.src.slice(r,e.start)}${n.format(i.src.slice(e.start,e.end),{type:"error"})}${i.src.slice(e.end,s)}`.replace(/\n/g,c=>`
`+n.format((o++).toString().padEnd(l," ")+"| ",{type:"gutter"}))}function Nc(n,e){const t=n.sourceCode.get(e.unit);jf(e,e.start);const[i,r]=t.linesAndCols[e.start??0],s=bd(`Error in ${n.io.relativePath(n.entry,e.unit)}:${i}:${r} ${n.format(`(${e.unit}:${i}:${r})`,{type:"deemphasize"})}`,n.maxWidth)+(n.hideSourceCode?"":El(n,e,n.sourceCodeErrorContext??2))+`
`+n.format(e.reason,{type:"message"});return e.type=="bad-fncall"||e.type=="bad-macro"?s+`

`+e.why.map(o=>rr(Nc({...n,hideSourceCode:!1},o),2)).join(`
  `):e.type=="circular-dependency"?s+[...e.path,e.path[0]].map(({start:o,end:l,unit:a})=>{const c=n.sourceCode.get(a);return c.linesAndCols[o],c.src.slice(o,l)}).join(" -> ")+`

`+rr(e.path.map(({start:o,end:l,unit:a})=>{const c=n.sourceCode.get(a),[h,u]=c.linesAndCols[o];return`${n.format(`At ${a}:${h}:${u}`,{type:"deemphasize"})}${rr(El(n,{start:o,end:l,unit:a},n.sourceCodeErrorContext??2),2)}`}).join(`
`),2):s}function Ei(n,e,t){const i=t(n,e);if(i)return i;let r;if(n.type=="list"?e.type=="list"?r=t(n.element,e.element):r=t(n.element,e):e.type=="list"&&(r=t(n,e.element)),r)return{type:"list",element:r}}function kd(n,e){return Ei(n,e,(t,i)=>{if(t.type=="number"&&i.type=="number")return{type:"number"};if(t.type=="point"&&i.type=="point")return{type:"point"}})}function xd(n,e){return Ei(n,e,(t,i)=>{if(t.type=="number"&&i.type=="number")return{type:"number"};if(t.type=="point"&&i.type=="point")return{type:"point"};if(t.type=="number"&&i.type=="point")return{type:"point"};if(t.type=="point"&&i.type=="number")return{type:"point"}})}function Sd(n,e){return Ei(n,e,(t,i)=>{if(t.type=="number"&&i.type=="number")return{type:"number"}})}function Td(n,e){return Ei(n,e,(t,i)=>{if(t.type=="number"&&i.type=="number")return{type:"boolean"}})}function Ad(n,e){return Ei(n,e,(t,i)=>{if((t.type=="number"||t.type=="boolean")&&(i.type=="number"||i.type=="boolean"))return{type:"boolean"}})}function Cd(n,e){if(n.type=="list"){if(e.type=="number")return n.element;if(e.type=="list"&&(e.element.type=="number"||e.element.type=="boolean"))return n}}function Vt(n){const e=n.filter(i=>i.type=="error"),t={type:"error",why:e.map(i=>i.why).flat()};if(e.length!=0)return t}function Md(n,e,t,i){return t.type===i.type&&(t.type!=="list"||t.element.type===i.element.type)?{type:"action"}:q(n,e.unitName,`variable on the left-hand side of this action is a ${de(t)}, but the right hand side is a ${de(i)}`)}function Od(n,e){const t=G(n.lhs,e),i=G(n.rhs,e),r=Vt([t,i]);if(r)return r;let s;switch(n.op){case"+":case"-":s=kd(t,i);break;case"*":case"/":s=xd(t,i);break;case"^":case"%":s=Sd(t,i);break;case"<":case"<=":case"==":case">=":case">":s=Td(t,i);break;case"&&":case"||":s=Ad(t,i);break;case"[":s=Cd(t,i);break;case"->":s=Md(n,e,t,i);break;case",":s=t.type==="action"&&i.type==="action"?{type:"action"}:void 0}return s||q(n,e.unitName,`cannot use operator '${n.op}' on types '${de(t)}' and '${de(i)}'`)}function Zo(n){return new TextDecoder().decode(n)}function Nd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ed(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){if(this instanceof i){var r=[null];r.push.apply(r,arguments);var s=Function.bind.apply(e,r);return new s}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}const Dd={},_d=Object.freeze(Object.defineProperty({__proto__:null,default:Dd},Symbol.toStringTag,{value:"Module"})),Pd=Ed(_d);var qo=typeof Map=="function"&&Map.prototype,vs=Object.getOwnPropertyDescriptor&&qo?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,kr=qo&&vs&&typeof vs.get=="function"?vs.get:null,Dl=qo&&Map.prototype.forEach,Ko=typeof Set=="function"&&Set.prototype,ks=Object.getOwnPropertyDescriptor&&Ko?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,xr=Ko&&ks&&typeof ks.get=="function"?ks.get:null,_l=Ko&&Set.prototype.forEach,Ld=typeof WeakMap=="function"&&WeakMap.prototype,ri=Ld?WeakMap.prototype.has:null,Bd=typeof WeakSet=="function"&&WeakSet.prototype,si=Bd?WeakSet.prototype.has:null,Id=typeof WeakRef=="function"&&WeakRef.prototype,Pl=Id?WeakRef.prototype.deref:null,Rd=Boolean.prototype.valueOf,$d=Object.prototype.toString,Vd=Function.prototype.toString,Fd=String.prototype.match,Go=String.prototype.slice,Lt=String.prototype.replace,Hd=String.prototype.toUpperCase,Ll=String.prototype.toLowerCase,Ec=RegExp.prototype.test,Bl=Array.prototype.concat,it=Array.prototype.join,zd=Array.prototype.slice,Il=Math.floor,Us=typeof BigInt=="function"?BigInt.prototype.valueOf:null,xs=Object.getOwnPropertySymbols,Zs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,En=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Oe=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===En||"symbol")?Symbol.toStringTag:null,Dc=Object.prototype.propertyIsEnumerable,Rl=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function $l(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||Ec.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var i=n<0?-Il(-n):Il(n);if(i!==n){var r=String(i),s=Go.call(e,r.length+1);return Lt.call(r,t,"$&_")+"."+Lt.call(Lt.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Lt.call(e,t,"$&_")}var qs=Pd,Vl=qs.custom,Fl=Lc(Vl)?Vl:null,_c=function n(e,t,i,r){var s=t||{};if(Ot(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ot(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=Ot(s,"customInspect")?s.customInspect:!0;if(typeof o!="boolean"&&o!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ot(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ot(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Ic(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var a=String(e);return l?$l(e,a):a}if(typeof e=="bigint"){var c=String(e)+"n";return l?$l(e,c):c}var h=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=h&&h>0&&typeof e=="object")return Ks(e)?"[Array]":"[Object]";var u=op(s,i);if(typeof r>"u")r=[];else if(Bc(r,e)>=0)return"[Circular]";function f(ae,Re,ze){if(Re&&(r=zd.call(r),r.push(Re)),ze){var De={depth:s.depth};return Ot(s,"quoteStyle")&&(De.quoteStyle=s.quoteStyle),n(ae,De,i+1,r)}return n(ae,s,i+1,r)}if(typeof e=="function"&&!Hl(e)){var d=Yd(e),p=Ri(e,f);return"[Function"+(d?": "+d:" (anonymous)")+"]"+(p.length>0?" { "+it.call(p,", ")+" }":"")}if(Lc(e)){var g=En?Lt.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):Zs.call(e);return typeof e=="object"&&!En?jn(g):g}if(ip(e)){for(var y="<"+Ll.call(String(e.nodeName)),b=e.attributes||[],v=0;v<b.length;v++)y+=" "+b[v].name+"="+Pc(Wd(b[v].value),"double",s);return y+=">",e.childNodes&&e.childNodes.length&&(y+="..."),y+="</"+Ll.call(String(e.nodeName))+">",y}if(Ks(e)){if(e.length===0)return"[]";var A=Ri(e,f);return u&&!sp(A)?"["+Gs(A,u)+"]":"[ "+it.call(A,", ")+" ]"}if(Ud(e)){var k=Ri(e,f);return!("cause"in Error.prototype)&&"cause"in e&&!Dc.call(e,"cause")?"{ ["+String(e)+"] "+it.call(Bl.call("[cause]: "+f(e.cause),k),", ")+" }":k.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+it.call(k,", ")+" }"}if(typeof e=="object"&&o){if(Fl&&typeof e[Fl]=="function"&&qs)return qs(e,{depth:h-i});if(o!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(Xd(e)){var E=[];return Dl&&Dl.call(e,function(ae,Re){E.push(f(Re,e,!0)+" => "+f(ae,e))}),zl("Map",kr.call(e),E,u)}if(tp(e)){var N=[];return _l&&_l.call(e,function(ae){N.push(f(ae,e))}),zl("Set",xr.call(e),N,u)}if(Qd(e))return Ss("WeakMap");if(np(e))return Ss("WeakSet");if(ep(e))return Ss("WeakRef");if(qd(e))return jn(f(Number(e)));if(Gd(e))return jn(f(Us.call(e)));if(Kd(e))return jn(Rd.call(e));if(Zd(e))return jn(f(String(e)));if(!jd(e)&&!Hl(e)){var z=Ri(e,f),re=Rl?Rl(e)===Object.prototype:e instanceof Object||e.constructor===Object,F=e instanceof Object?"":"null prototype",V=!re&&Oe&&Object(e)===e&&Oe in e?Go.call(Zt(e),8,-1):F?"Object":"",K=re||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",he=K+(V||F?"["+it.call(Bl.call([],V||[],F||[]),": ")+"] ":"");return z.length===0?he+"{}":u?he+"{"+Gs(z,u)+"}":he+"{ "+it.call(z,", ")+" }"}return String(e)};function Pc(n,e,t){var i=(t.quoteStyle||e)==="double"?'"':"'";return i+n+i}function Wd(n){return Lt.call(String(n),/"/g,"&quot;")}function Ks(n){return Zt(n)==="[object Array]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function jd(n){return Zt(n)==="[object Date]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function Hl(n){return Zt(n)==="[object RegExp]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function Ud(n){return Zt(n)==="[object Error]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function Zd(n){return Zt(n)==="[object String]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function qd(n){return Zt(n)==="[object Number]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function Kd(n){return Zt(n)==="[object Boolean]"&&(!Oe||!(typeof n=="object"&&Oe in n))}function Lc(n){if(En)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!Zs)return!1;try{return Zs.call(n),!0}catch{}return!1}function Gd(n){if(!n||typeof n!="object"||!Us)return!1;try{return Us.call(n),!0}catch{}return!1}var Jd=Object.prototype.hasOwnProperty||function(n){return n in this};function Ot(n,e){return Jd.call(n,e)}function Zt(n){return $d.call(n)}function Yd(n){if(n.name)return n.name;var e=Fd.call(Vd.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function Bc(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,i=n.length;t<i;t++)if(n[t]===e)return t;return-1}function Xd(n){if(!kr||!n||typeof n!="object")return!1;try{kr.call(n);try{xr.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function Qd(n){if(!ri||!n||typeof n!="object")return!1;try{ri.call(n,ri);try{si.call(n,si)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function ep(n){if(!Pl||!n||typeof n!="object")return!1;try{return Pl.call(n),!0}catch{}return!1}function tp(n){if(!xr||!n||typeof n!="object")return!1;try{xr.call(n);try{kr.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function np(n){if(!si||!n||typeof n!="object")return!1;try{si.call(n,si);try{ri.call(n,ri)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function ip(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function Ic(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,i="... "+t+" more character"+(t>1?"s":"");return Ic(Go.call(n,0,e.maxStringLength),e)+i}var r=Lt.call(Lt.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,rp);return Pc(r,"single",e)}function rp(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Hd.call(e.toString(16))}function jn(n){return"Object("+n+")"}function Ss(n){return n+" { ? }"}function zl(n,e,t,i){var r=i?Gs(t,i):it.call(t,", ");return n+" ("+e+") {"+r+"}"}function sp(n){for(var e=0;e<n.length;e++)if(Bc(n[e],`
`)>=0)return!1;return!0}function op(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=it.call(Array(n.indent+1)," ");else return null;return{base:t,prev:it.call(Array(e+1),t)}}function Gs(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+it.call(n,","+t)+`
`+e.prev}function Ri(n,e){var t=Ks(n),i=[];if(t){i.length=n.length;for(var r=0;r<n.length;r++)i[r]=Ot(n,r)?e(n[r],n):""}var s=typeof xs=="function"?xs(n):[],o;if(En){o={};for(var l=0;l<s.length;l++)o["$"+s[l]]=s[l]}for(var a in n)Ot(n,a)&&(t&&String(Number(a))===a&&a<n.length||En&&o["$"+a]instanceof Symbol||(Ec.call(/[^\w$]/,a)?i.push(e(a,n)+": "+e(n[a],n)):i.push(a+": "+e(n[a],n))));if(typeof xs=="function")for(var c=0;c<s.length;c++)Dc.call(n,s[c])&&i.push("["+e(s[c])+"]: "+e(n[s[c]],n));return i}const Rc=Nd(_c),lp=uf({__proto__:null,default:Rc},[_c]);function Jt(n,e,t){if(t.type===e)return t;throw q(t,n,`Expected a '${e}' node, but got a '${t.type}' node.`)}function yn(n,e,t){return typeof n=="string"?{reason:n,type:"general",unit:t,start:e.start,end:e.end}:n}function Un(n,e){function t(i){return Array.isArray(i)?i.map(r=>t(r)):i&&typeof i=="object"&&typeof i.id=="number"?i!==n?e(i):Object.fromEntries(Object.entries(i).map(([s,o])=>[s,t(o)])):i}return{...t(n),id:B()}}function ap(n,e,t){const i=s=>{const o=`_macro${B()}`;t.sourceCode.set(o,{src:s,linesAndCols:Yo(s)});const l=Ho(s,o,[]);return zo(l,o,[])};function r(s){return t.io.resolvePath(t.io.dirname(t.unit),s)}return{assertNodeType:(s,o)=>Jt(t.unit,s,o),node:s=>({...s,id:B(),start:e.start,end:e.end}),parse:i,parseExpr:s=>{const o=i(s);if(o.type=="error")return o;if(o.type!="block"||o.body.length==0)throw yn("no expression found",e,t.unit);if(o.body.length>1)throw yn("multiple expressions found; expected only one",e,t.unit);const l=dt(o.body[o.body.length-1]);if(!l.success)throw yn("expected an expression, got a non-expression",e,t.unit);return l.data},fatalError(s){throw n.push(yn(s,e,t.unit)),""},recoverableError(s){n.push(yn(s,e,t.unit))},fmt(s,o){return L(s,o)},debug(...s){n.push(yn(`Debug output from macro:
`+s.map(o=>(Rc??lp)(o)).join(`
`),e,t.unit))},readFile:s=>{const o=r(s);return t.watchFiles.add(o),t.io.readFile(o)},readStringFile:async s=>{const o=r(s);return t.watchFiles.add(o),Zo(await t.io.readFile(o))}}}const cp=["x","y","t","index","theta"];function hp(n){if(n.type=="regular")return`(${n.params.map(e=>e.map((t,i)=>n.requiredCount!==void 0&&i>=n.requiredCount?`[${de(t)}]`:de(t)).join(" | ")).join(", ")}) -> ${de(n.returns)}`;{const e=n.validTypes.map(t=>de(t)).join(" | ");return`(${n.minArgs?`${new Array(n.minArgs).fill(e).join(", ")}, `:""}...${n.validTypes.length>1?"(":""}${e}${n.validTypes.length>1?")":""}[]) -> ${de(n.returns)}`}}function up(n){return n.map(e=>hp(e)).join(`
`)}const Wl=(n,e)=>[{type:"regular",params:[[{type:"list",element:n}]],returns:e??n},{type:"variadic",validTypes:[n],returns:e??n},{type:"variadic",validTypes:[n,{type:"list",element:n}],returns:{type:"list",element:e??n}}],$i=n=>[{type:"regular",params:new Array(n).fill(0).map(e=>[{type:"number"}]),returns:{type:"number"}},{type:"regular",params:new Array(n).fill(0).map(e=>[{type:"number"},{type:"list",element:{type:"number"}}]),returns:Q({type:"number"})}],Q=n=>({type:"list",element:n}),fp=[{type:"regular",params:[[{type:"distribution"}]],returns:{type:"distribution"}},{type:"regular",params:[[Q({type:"distribution"})]],returns:Q({type:"distribution"})}],Zn=[{type:"number"},{type:"polygon"},{type:"color"},{type:"point"}],bn=[{type:"number"},Q({type:"number"})],dp=[...["min","max","stdev","mean","median"].map(n=>[n,[...Wl({type:"number"}),...fp]]),["normaldist",[{type:"regular",params:[bn,bn],returns:{type:"distribution"},requiredCount:0}]],["uniformdist",[{type:"regular",params:[bn,bn],returns:{type:"distribution"},requiredCount:0}]],["binomialdist",[{type:"regular",params:[bn,bn],returns:{type:"distribution"},requiredCount:1}]],...["sin","cos","tan","csc","sec","cot","arcsin","arccos","arccsc","arcsec","arccot","sinh","cosh","tanh","csch","sech","coth","floor","ceil","round"].map(n=>[n,$i(1)]),["arctan",[...$i(1),...$i(2)]],["mod",$i(2)],["join",Zn.map(n=>({type:"variadic",minArgs:2,validTypes:[n,Q(n)],returns:Q(n)}))],["sort",Zn.map(n=>({type:"regular",params:[[Q(n)],[Q({type:"number"})]],returns:Q(n),requiredCount:1}))],["unique",Zn.map(n=>({type:"regular",params:[[Q(n)]],returns:Q(n)}))],["polygon",[...Wl({type:"point"},{type:"polygon"}),{type:"regular",params:[[Q({type:"number"})],[Q({type:"number"})]],returns:{type:"polygon"}}]],["distance",[{type:"regular",params:[[{type:"point"}],[{type:"point"}]],returns:{type:"number"}},{type:"regular",params:[[{type:"point"},Q({type:"point"})],[{type:"point"},Q({type:"point"})]],returns:Q({type:"number"})}]],...["rgb","hsv"].map(n=>[n,[{type:"regular",params:new Array(3).fill(0).map(e=>[{type:"number"}]),returns:{type:"color"}},{type:"regular",params:new Array(3).fill(0).map(e=>[{type:"number"},Q({type:"number"})]),returns:Q({type:"color"})}]]),["random",[...Zn.map(n=>[{type:"regular",params:[[Q(n)]],returns:n},{type:"regular",params:[[Q(n)],[{type:"number"}],[{type:"number"}]],returns:Q(n),requiredCount:2}]).flat(1),{type:"regular",params:[],returns:{type:"number"}},{type:"regular",params:[[{type:"number"}],[{type:"number"}]],returns:Q({type:"number"})}]],["shuffle",Zn.map(n=>[{type:"regular",params:[[Q(n)],[{type:"number"}]],returns:Q(n),requiredCount:1}]).flat(1)]];function pp(n,e){for(const[t,i]of dp)me(n,t,{type:"builtin-function",typeSignature:i,id:B(),definedByDesmos:!0,unitName:""},e.errors);for(const t of cp)me(n,t,{type:"builtin-variable",id:B(),definedByDesmos:!0,unitName:"",typeSignature:{type:"number"}},e.errors);me(n,"with",{type:"macro",id:B(),useInnerScope:!0,unitName:"",macroOperation:async(t,i)=>{const r=i.assertNodeType("block",t.params[1]);for(const s of r.body){const o=i.assertNodeType("assignment",s);o&&t.innerScope.elements.set(o.lhs,{type:"builtin-variable",id:B(),unitName:""})}return i.node({type:"list",elements:t.params})},customTypecheck(t,i){const r=Jt("","list",t.result).elements,s=r[0],o=Jt("","block",r[1]),l=new Map;for(const a of o.body){const c=Jt("","assignment",a),h=t.innerScope.elements.get(c.lhs);l.set(h.id,G(c.rhs,i))}return G(s,Sr(i,l))},customCodegen(t,i){const r=Jt("","list",t.result).elements,s=r[0],o=Jt("","block",r[1]);return`\\left(${i.codegen(s)}\\operatorname{with}${o.body.map(l=>{const a=Jt("","assignment",l);return`${i.getNameForIdentifier([a.lhs],t.innerScope)}=${i.codegen(a.rhs)}`}).join(",")}\\right)`}},e.errors);for(const t of["sum","prod"])me(n,t,{type:"macro",id:B(),useInnerScope:!0,unitName:"",macroOperation:async(i,r)=>(i.innerScope.elements.set(i.params[0].segments[0],{type:"builtin-variable",id:B(),unitName:""}),r.node({type:"list",elements:i.params})),customTypecheck(i,r){const s=i.result.elements,o=s[0].segments[0],l=i.innerScope.elements.get(o),a=new Map;return a.set(l.id,G(s[1],r)),G(s[3],Sr(r,a))},customCodegen(i,r){const s=i.result.elements,o=r.codegen(s[0]),l=r.codegen(s[1]),a=r.codegen(s[2]),c=r.codegen(s[3]);return`\\${t}_{${o}=${l}}^{${a}}\\left(${c}\\right)`}},e.errors);me(n,"five",{type:"macro",id:B(),unitName:"",macroOperation:async(t,i)=>i.parseExpr("1 + 696969   42042042 + 1 + 1")},e.errors),me(n,"loadcsv",{type:"macro",id:B(),unitName:"",macroOperation:async(t,i)=>{const r=t.params[0];t.params.length!=1&&i.fatalError("expected exactly 1 parameter representing the csv file name"),r.type!="note"&&i.fatalError("expected a string");const s=await i.readStringFile(r.content);return i.parseExpr(`[${s}]`)}},e.errors),me(n,"loop",{type:"macro",id:B(),unitName:"",macroOperation:async(t,i)=>{t.params.length!=4&&(i.debug("nodeparams",t.params),i.fatalError("Expected exactly 3 parameters."));const r=t.params[0],s=t.params[1];(r.type!="identifier"||r.segments.length!=1)&&i.fatalError("Expected parameter 1 to be an identifier with 1 segment."),(s.type!="number"||s.number!=Math.round(s.number))&&i.fatalError("Expected parameter 3 to be an integer.");const o=r.segments[0],l=s.number;t.params[2].type!="block"&&i.fatalError("expected parameter 3 to be a block"),t.params[3].type!="block"&&i.fatalError("expected parameter 4 to be a block");function a(u,f){const d=p=>a(p,f);return u.type=="identifier"?Un({...u,segments:[u.segments[0]=="prev"?f:u.segments[0],...u.segments.slice(1)]},d):Un(u,d)}function c(u){return Un(u,c)}const h=u=>u==-1?"init":`iter${u}`;return i.node({type:"namespace",name:o,body:i.node({type:"block",body:[i.node({type:"namespace",name:"init",body:c(t.params[2])}),...new Array(Math.max(l-1,0)).fill(0).map((u,f)=>i.node({type:"namespace",name:`iter${f}`,body:a(t.params[3],h(f-1))})),...a(t.params[3],h(l-2)).body]})})}},e.errors),me(n,"subst",{type:"macro",id:B(),unitName:"",macroOperation:async(t,i)=>{const r=t.params;r.length<2&&i.fatalError("Expected at least two arguments: a macro name, zero or more macro parameters, and a macro body expression");const s=r[0],o=new Map;let l=0;for(const a of r.slice(0,-1))(a.type!="identifier"||a.segments.length!=1)&&i.fatalError("Expected a variable name for every argument except the last."),l>0&&a.type=="identifier"&&o.set(a.segments[0],l-1),l++;return me(t.enclosingScope,s.segments[0],{type:"macro",id:B(),unitName:"",macroOperation:async(a,c)=>{const h=a.params;function u(d){if(d.type=="identifier"&&d.segments.length==1){const p=o.get(d.segments[0]);if(p!==void 0)return Un(h[p],u)}return Un(d,u)}return u(r[r.length-1])}},e.errors),i.node({type:"number",number:0})}},e.errors)}function jl(n,e){for(const t of e){if(n.type=="list"&&t.type=="list"){if(n.element.type==t.element.type)return!0;continue}if(n.type==t.type)return!0}return!1}function mp(n,e,t,i){e:for(const r of t.typeSignature)if(r.type=="variadic"){if(e.length>=(r.minArgs??0)&&e.every(s=>jl(s,r.validTypes)))return r.returns}else{if(e.length>r.params.length||e.length<(r.requiredCount??r.params.length))continue;for(let s=0;s<e.length;s++)if(!jl(e[s],r.params[s]))continue e;return r.returns}return q(n,i.unitName,`invalid function parameters; valid overloads are:
`+rr(up(t.typeSignature),2)+`
parameters supplied were:
`+e.map(r=>de(r)).join(`
`))}function de(n){return n.type=="list"?`${de(n.element)}[]`:n.type}function an(n,e,t){const i=n.astNodes.get(e);if(!i)throw oe("ast node map lookup failed");if(i.type!=t)throw oe(`ast node map lookup failed: expected a node of type '${t}' but got a '${i.type}' node`);return i}function $c(n,e){const t=n.astNodes.get(e);if(!t)throw oe("ast node map lookup failed");const i=dt(t);if(!i.success)throw oe("ast node map lookup failed: expected an expression but got a non-expression");return i.data}function gp(n,e){const t=G(n.x,e),i=G(n.y,e),r=Vt([t,i]);return r||(t.type!="number"&&(t.type!="list"||t.element.type!="number")?q(n.x,e.unitName,"expected a number or a list of numbers"):i.type!="number"&&(t.type!="list"||t.element.type!="number")?q(n.y,e.unitName,"expected a number or a list of numbers"):t.type==="list"||i.type==="list"?{type:"list",element:{type:"point"}}:{type:"point"})}function Sr(n,e){const t=new Map(n.knownTypes);for(const[i,r]of e.entries())t.set(i,r);return{...n,knownTypes:t}}function yp(n,e){const t=new Map,i=n.params.map(l=>[l[0],G(l[1],e),l[1]]),r=Vt([...i.map(l=>l[1])]);if(r)return r;for(const[l,a,c]of i){if(a.type!="list")return q(c,e.unitName,`list comprehension parameters must be lists, but '${l}', an expression of type '${de(a)}', was received instead`);const h=n.innerScope.elements.get(l);t.set(h.id,a.element)}const s=G(n.body,Sr(e,t)),o=Vt([s]);return o||(s.type=="list"?q(n.body,e.unitName,"list comprehension body cannot be a list, as desmos does not support nested lists"):{type:"list",element:s})}function bp(n,e){const t=n.enclosingScope,i=Ue(e.units.get(e.unitName),t,n.segments,{compilationUnits:e.units});if(i.result=="point-member-access")return{type:"number"};if(i.result=="not-found")return ii(n,e.unitName,`identifier '${n.segments.join(".")}' does not exist`);if(e.knownCircularDependencies.has(i.identifier.id))return{type:"error",why:[]};if(i.identifier.type=="variable"){if(e.dependencyChain.has(i.identifier.id))return Mc(n,e.units,e.dependencyChain,i.identifier,e.knownCircularDependencies);const r=an(e,i.identifier.node,"assignment"),s=new Map(e.dependencyChain);return s.set(i.identifier.id,{content:i.identifier,node:n,nodeUnit:e.unitName}),G(r.rhs,{...e,dependencyChain:s})}else if(i.identifier.type=="builtin-variable"){if(i.identifier.computedTypeSignature)return i.identifier.computedTypeSignature(n,e);if(i.identifier.typeSignature)return i.identifier.typeSignature;const r=e.knownTypes.get(i.identifier.id);if(!r)throw oe(`builtin variables should have their types provided! builtin variable was ${n.segments.join(".")}`);return r}else return q(n,e.unitName,`expected an identifier representing a variable but found a/an ${Oc(i.identifier.type)} instead`)}function wp(n,e){if(n.elements.length==0){if(!n.typeAnnotation)throw oe("Expected a type annotation, as this is an empty list! This should be caught during parsing!");return{type:"list",element:{type:n.typeAnnotation}}}const t=n.elements.map(s=>G(s,e)),i=Vt(t);if(i)return i;const r=t[0];if(r.type=="list")return q(n.elements[0],e.unitName,"desmoscript does not support lists of lists");for(const s of n.elements.slice(1)){const o=G(s,e);if(o.type!=r.type)return q(s,e.unitName,`based on its first element, this is a list of ${r.type}s, but this element is of type '${de(o)}'`)}return{type:"list",element:r}}function vp(n,e){const i=n.innerScope.elements.get(e);if(!i)throw oe(`expected '${e}' to be defined in this inner scope`);if(i.type!="builtin-variable")throw oe(`expected '${e}' to be a builtin variable`);return i}function kp(n,e){const t=Ue(e.units.get(e.unitName),n.enclosingScope,n.name.segments,{compilationUnits:e.units});if(t.result!="found")return ii(n.name,e.unitName,`could not find a function with the name '${n.name.segments.join(".")}'`);const i=t.identifier,r=[];for(const s of n.params)r.push(G(s,e));if(i.type=="function"){if(e.dependencyChain.has(i.id))return Mc(n,e.units,e.dependencyChain,i,e.knownCircularDependencies);const s=an(e,i.node,"fndef"),o=s.params;if(o.length!=n.params.length)return q(n,e.unitName,`wrong number of parameters: function '${n.name.segments.join(".")}' takes ${o.length} parameters, but it was given ${n.params.length} parameters here`);const l=new Map;for(let h=0;h<o.length;h++){const u=vp(s,o[h]).id;l.set(u,r[h])}const a=new Map(e.dependencyChain);a.set(i.id,{content:i,node:s,nodeUnit:e.unitName});const c=G(s.body,Sr({...e,dependencyChain:a},l));return c.type=="error"?{type:"error",why:[{type:"bad-fncall",reason:`cannot call '${n.name.segments.join(".")}' due to bad parameters because:`,start:n.start,end:n.end,why:c.why,unit:e.unitName}]}:c}else return i.type=="builtin-function"?mp(n,r,i,e):q(n.name,e.unitName,`expected this name to refer to a function; got a/an ${Oc(i.type)} instead`)}function xp(n,e){const t=n.body[n.body.length-1];if(!t)return q(n,e.unitName,"a block must contain at least one expression for it to be a valid expression (i.e. something that resolves to a value)");const i=dt(t);if(!i.success)return q(t,e.unitName,"this statement is the last one within a block expression and therefore must also be an expression (something that resolves to a value)");const r=i.data;return G(r,e)}function Sp(n,e){const t=n.branches.map(a=>[a[0],a[1],G(a[0],e),G(a[1],e)]),i=n.fallback?G(n.fallback,e):void 0,r=t[0]?.[3]??i??{type:"number"},s=[],o=(a,c)=>{c.type!=r.type&&s.push(q(a,e.unitName,`all match branches must resolve to the same type; expected a ${de(r)} based on the first branch but got a ${de(c)}`))};for(const[a,c,h,u]of t)h.type!="boolean"&&s.push(q(a,e.unitName,`expected a boolean, got a ${de(h)}`)),o(c,u);n.fallback&&i&&o(n.fallback,i);const l=Vt([t.map(a=>[a[2],a[3]]),i??[]].flat(2));return l||r}function Tp(n,e){const t=G(n.lhs,e),i=G(n.rhs,e),r=n.step?G(n.step,e):void 0,s=Vt([t,i].concat(r?[r]:[]));if(s)return s;for(const[o,l]of[[n.lhs,t],[n.rhs,i]].concat(r&&n.step?[[n.step,r]]:[]))if(l.type!="number")return q(o,e.unitName,`range arguments must be numbers but a ${de(l)} was received instead`);return{type:"list",element:{type:"number"}}}function Ap(n,e){const t=G(n.operand,e);if(t.type=="error")return t;switch(n.op){case"!":return t.type!="boolean"?q(n.operand,e.unitName,`expected a boolean; got a ${de(t)}`):{type:"boolean"};case"-":return["number","point"].indexOf(t.type=="list"?t.element.type:t.type)==-1?q(n.operand,e.unitName,`cannot negate a ${de(t)}`):t;case".x":case".y":return t.type!="point"?q(n.operand,e.unitName,`cannot access the ${n.op[1]} component of a ${de(t)} or anything else that isn't a point`):{type:"number"}}}function Cp(n,e){const t=Ue(e.units.get(e.unitName),n.enclosingScope,n.name.segments,{compilationUnits:e.units});if(t.result==="found"&&t.identifier.type==="macro"&&t.identifier.customTypecheck)try{return t.identifier.customTypecheck(n,e)}catch{return q(n,e.unitName,"Custom typecheck encountered an exception.")}const i=n.result;if(!i)return q(n,e.unitName,"unresolved macro!");if(i instanceof Promise)return q(n,e.unitName,"unawaited macro!");const r=Pt(i);if(r.length>0)return yd(n,r,e.unitName,"error in macro body");const s=dt(i);return s.success?G(s.data,e):q(n,e.unitName,`expected this macro to resolve to an expression, but received '${L(i,{indent:2,tabSize:2,maxlen:80,bindingPower:0})}' instead`)}function G(n,e){switch(n.type){case"binop":return Od(n,e);case"block":return xp(n,e);case"error":return{type:"error",why:[{type:"wrong-type",start:n.start,end:n.end,unit:n.unitName,reason:n.reason}]};case"fncall":return kp(n,e);case"identifier":return bp(n,e);case"list":return wp(n,e);case"listcomp":return yp(n,e);case"macrocall":return Cp(n,e);case"match":return Sp(n,e);case"note":return q(n,e.unitName,"a note cannot be used in this context");case"number":return{type:"number"};case"range":return Tp(n,e);case"unop":return Ap(n,e);case"point":return gp(n,e)}}function Tr(n,e,t){t||(t=[]);for(const[i,r]of n.elements)switch(r.type){case"function":break;case"variable":{const s=an(e,r.node,"assignment");t.push(G(s.rhs,e));break}case"expression":t.push(G($c(e,r.expr),e));break;case"scope":!r.isWithinFunction&&!r.ignoreTypecheckAndCodegen&&Tr(r.scope,e,t);break;case"import":Tr(ns(e.units.get(r.compilationUnitPath),`'${r.compilationUnitPath}' not found in typecheckScopeTree`).scopeTree,{...e,unitName:r.compilationUnitPath},t);break}return Vt(t)}var j;(function(n){n.assertEqual=r=>r;function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const s={};for(const o of r)s[o]=o;return s},n.getValidEnumValues=r=>{const s=n.objectKeys(r).filter(l=>typeof r[r[l]]!="number"),o={};for(const l of s)o[l]=r[l];return n.objectValues(o)},n.objectValues=r=>n.objectKeys(r).map(function(s){return r[s]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const s=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&s.push(o);return s},n.find=(r,s)=>{for(const o of r)if(s(o))return o},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function i(r,s=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}n.joinValues=i,n.jsonStringifyReplacer=(r,s)=>typeof s=="bigint"?s.toString():s})(j||(j={}));const C=j.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Dt=n=>{switch(typeof n){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(n)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(n)?C.array:n===null?C.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?C.promise:typeof Map<"u"&&n instanceof Map?C.map:typeof Set<"u"&&n instanceof Set?C.set:typeof Date<"u"&&n instanceof Date?C.date:C.object;default:return C.unknown}},S=j.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Mp=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class kt extends Error{constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(s){return s.message},i={_errors:[]},r=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)i._errors.push(t(o));else{let l=i,a=0;for(;a<o.path.length;){const c=o.path[a];a===o.path.length-1?(l[c]=l[c]||{_errors:[]},l[c]._errors.push(t(o))):l[c]=l[c]||{_errors:[]},l=l[c],a++}}};return r(this),i}toString(){return this.message}get message(){return JSON.stringify(this.issues,j.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},i=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):i.push(e(r));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}kt.create=n=>new kt(n);const ci=(n,e)=>{let t;switch(n.code){case S.invalid_type:n.received===C.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case S.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,j.jsonStringifyReplacer)}`;break;case S.unrecognized_keys:t=`Unrecognized key(s) in object: ${j.joinValues(n.keys,", ")}`;break;case S.invalid_union:t="Invalid input";break;case S.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${j.joinValues(n.options)}`;break;case S.invalid_enum_value:t=`Invalid enum value. Expected ${j.joinValues(n.options)}, received '${n.received}'`;break;case S.invalid_arguments:t="Invalid function arguments";break;case S.invalid_return_type:t="Invalid function return type";break;case S.invalid_date:t="Invalid date";break;case S.invalid_string:typeof n.validation=="object"?"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:j.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case S.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(n.minimum)}`:t="Invalid input";break;case S.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(n.maximum)}`:t="Invalid input";break;case S.custom:t="Invalid input";break;case S.invalid_intersection_types:t="Intersection results could not be merged";break;case S.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case S.not_finite:t="Number must be finite";break;default:t=e.defaultError,j.assertNever(n)}return{message:t}};let Vc=ci;function Op(n){Vc=n}function Ar(){return Vc}const Cr=n=>{const{data:e,path:t,errorMaps:i,issueData:r}=n,s=[...t,...r.path||[]],o={...r,path:s};let l="";const a=i.filter(c=>!!c).slice().reverse();for(const c of a)l=c(o,{data:e,defaultError:l}).message;return{...r,path:s,message:r.message||l}},Np=[];function O(n,e){const t=Cr({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Ar(),ci].filter(i=>!!i)});n.common.issues.push(t)}class Pe{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const i=[];for(const r of t){if(r.status==="aborted")return _;r.status==="dirty"&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,t){const i=[];for(const r of t)i.push({key:await r.key,value:await r.value});return Pe.mergeObjectSync(e,i)}static mergeObjectSync(e,t){const i={};for(const r of t){const{key:s,value:o}=r;if(s.status==="aborted"||o.status==="aborted")return _;s.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),(typeof o.value<"u"||r.alwaysSet)&&(i[s.value]=o.value)}return{status:e.value,value:i}}}const _=Object.freeze({status:"aborted"}),Fc=n=>({status:"dirty",value:n}),Ne=n=>({status:"valid",value:n}),Js=n=>n.status==="aborted",Ys=n=>n.status==="dirty",Mr=n=>n.status==="valid",Or=n=>typeof Promise!==void 0&&n instanceof Promise;var H;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(H||(H={}));class pt{constructor(e,t,i,r){this.parent=e,this.data=t,this._path=i,this._key=r}get path(){return this._path.concat(this._key)}}const Ul=(n,e)=>{if(Mr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,error:new kt(n.common.issues)}};function $(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:i,description:r}=n;if(e&&(t||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,l)=>o.code!=="invalid_type"?{message:l.defaultError}:typeof l.data>"u"?{message:i??l.defaultError}:{message:t??l.defaultError},description:r}}class I{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Dt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Dt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Pe,ctx:{common:e.parent.common,data:e.data,parsedType:Dt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Or(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){var i;const r={common:{issues:[],async:(i=t?.async)!==null&&i!==void 0?i:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Dt(e)},s=this._parseSync({data:e,path:r.path,parent:r});return Ul(r,s)}async parseAsync(e,t){const i=await this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error}async safeParseAsync(e,t){const i={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Dt(e)},r=this._parse({data:e,path:i.path,parent:i}),s=await(Or(r)?r:Promise.resolve(r));return Ul(i,s)}refine(e,t){const i=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,s)=>{const o=e(r),l=()=>s.addIssue({code:S.custom,...i(r)});return typeof Promise<"u"&&o instanceof Promise?o.then(a=>a?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(e,t){return this._refinement((i,r)=>e(i)?!0:(r.addIssue(typeof t=="function"?t(i,r):t),!1))}_refinement(e){return new Ke({schema:this,typeName:D.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ht.create(this)}nullable(){return un.create(this)}nullish(){return this.optional().nullable()}array(){return qe.create(this)}promise(){return _n.create(this)}or(e){return pi.create([this,e])}and(e){return mi.create(this,e)}transform(e){return new Ke({schema:this,typeName:D.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new vi({innerType:this,defaultValue:t,typeName:D.ZodDefault})}brand(){return new zc({typeName:D.ZodBranded,type:this,...$(void 0)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Pr({innerType:this,defaultValue:t,typeName:D.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return _i.create(this,e)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ep=/^c[^\s-]{8,}$/i,Dp=/^([a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[a-f0-9]{4}-[a-f0-9]{12}|00000000-0000-0000-0000-000000000000)$/i,_p=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,Pp=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}:\\d{2})|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}:\\d{2})|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");class Tt extends I{constructor(){super(...arguments),this._regex=(e,t,i)=>this.refinement(r=>e.test(r),{validation:t,code:S.invalid_string,...H.errToObj(i)}),this.nonempty=e=>this.min(1,H.errToObj(e)),this.trim=()=>new Tt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){const s=this._getOrReturnCtx(e);return O(s,{code:S.invalid_type,expected:C.string,received:s.parsedType}),_}const i=new Pe;let r;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),O(r,{code:S.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),i.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),O(r,{code:S.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),i.dirty());else if(s.kind==="length"){const o=e.data.length>s.value,l=e.data.length<s.value;(o||l)&&(r=this._getOrReturnCtx(e,r),o?O(r,{code:S.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):l&&O(r,{code:S.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),i.dirty())}else if(s.kind==="email")_p.test(e.data)||(r=this._getOrReturnCtx(e,r),O(r,{validation:"email",code:S.invalid_string,message:s.message}),i.dirty());else if(s.kind==="uuid")Dp.test(e.data)||(r=this._getOrReturnCtx(e,r),O(r,{validation:"uuid",code:S.invalid_string,message:s.message}),i.dirty());else if(s.kind==="cuid")Ep.test(e.data)||(r=this._getOrReturnCtx(e,r),O(r,{validation:"cuid",code:S.invalid_string,message:s.message}),i.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),O(r,{validation:"url",code:S.invalid_string,message:s.message}),i.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),O(r,{validation:"regex",code:S.invalid_string,message:s.message}),i.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),O(r,{code:S.invalid_string,validation:{startsWith:s.value},message:s.message}),i.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),O(r,{code:S.invalid_string,validation:{endsWith:s.value},message:s.message}),i.dirty()):s.kind==="datetime"?Pp(s).test(e.data)||(r=this._getOrReturnCtx(e,r),O(r,{code:S.invalid_string,validation:"datetime",message:s.message}),i.dirty()):j.assertNever(s);return{status:i.value,value:e.data}}_addCheck(e){return new Tt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...H.errToObj(e)})}url(e){return this._addCheck({kind:"url",...H.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...H.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...H.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,...H.errToObj(e?.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...H.errToObj(t)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...H.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...H.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...H.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...H.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...H.errToObj(t)})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Tt.create=n=>{var e;return new Tt({checks:[],typeName:D.ZodString,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...$(n)})};function Lp(n,e){const t=(n.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,r=t>i?t:i,s=parseInt(n.toFixed(r).replace(".","")),o=parseInt(e.toFixed(r).replace(".",""));return s%o/Math.pow(10,r)}class Ft extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){const s=this._getOrReturnCtx(e);return O(s,{code:S.invalid_type,expected:C.number,received:s.parsedType}),_}let i;const r=new Pe;for(const s of this._def.checks)s.kind==="int"?j.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),O(i,{code:S.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(i=this._getOrReturnCtx(e,i),O(i,{code:S.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(i=this._getOrReturnCtx(e,i),O(i,{code:S.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Lp(e.data,s.value)!==0&&(i=this._getOrReturnCtx(e,i),O(i,{code:S.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),O(i,{code:S.not_finite,message:s.message}),r.dirty()):j.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,H.toString(t))}gt(e,t){return this.setLimit("min",e,!1,H.toString(t))}lte(e,t){return this.setLimit("max",e,!0,H.toString(t))}lt(e,t){return this.setLimit("max",e,!1,H.toString(t))}setLimit(e,t,i,r){return new Ft({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:H.toString(r)}]})}_addCheck(e){return new Ft({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:H.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:H.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:H.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:H.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:H.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:H.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:H.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int")}}Ft.create=n=>new Ft({checks:[],typeName:D.ZodNumber,coerce:n?.coerce||!1,...$(n)});class hi extends I{_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==C.bigint){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.bigint,received:i.parsedType}),_}return Ne(e.data)}}hi.create=n=>{var e;return new hi({typeName:D.ZodBigInt,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...$(n)})};class ui extends I{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.boolean,received:i.parsedType}),_}return Ne(e.data)}}ui.create=n=>new ui({typeName:D.ZodBoolean,coerce:n?.coerce||!1,...$(n)});class cn extends I{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){const s=this._getOrReturnCtx(e);return O(s,{code:S.invalid_type,expected:C.date,received:s.parsedType}),_}if(isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return O(s,{code:S.invalid_date}),_}const i=new Pe;let r;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),O(r,{code:S.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),i.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),O(r,{code:S.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),i.dirty()):j.assertNever(s);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new cn({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:H.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:H.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}cn.create=n=>new cn({checks:[],coerce:n?.coerce||!1,typeName:D.ZodDate,...$(n)});class Nr extends I{_parse(e){if(this._getType(e)!==C.symbol){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.symbol,received:i.parsedType}),_}return Ne(e.data)}}Nr.create=n=>new Nr({typeName:D.ZodSymbol,...$(n)});class fi extends I{_parse(e){if(this._getType(e)!==C.undefined){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.undefined,received:i.parsedType}),_}return Ne(e.data)}}fi.create=n=>new fi({typeName:D.ZodUndefined,...$(n)});class di extends I{_parse(e){if(this._getType(e)!==C.null){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.null,received:i.parsedType}),_}return Ne(e.data)}}di.create=n=>new di({typeName:D.ZodNull,...$(n)});class Dn extends I{constructor(){super(...arguments),this._any=!0}_parse(e){return Ne(e.data)}}Dn.create=n=>new Dn({typeName:D.ZodAny,...$(n)});class rn extends I{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ne(e.data)}}rn.create=n=>new rn({typeName:D.ZodUnknown,...$(n)});class At extends I{_parse(e){const t=this._getOrReturnCtx(e);return O(t,{code:S.invalid_type,expected:C.never,received:t.parsedType}),_}}At.create=n=>new At({typeName:D.ZodNever,...$(n)});class Er extends I{_parse(e){if(this._getType(e)!==C.undefined){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.void,received:i.parsedType}),_}return Ne(e.data)}}Er.create=n=>new Er({typeName:D.ZodVoid,...$(n)});class qe extends I{_parse(e){const{ctx:t,status:i}=this._processInputParams(e),r=this._def;if(t.parsedType!==C.array)return O(t,{code:S.invalid_type,expected:C.array,received:t.parsedType}),_;if(r.exactLength!==null){const o=t.data.length>r.exactLength.value,l=t.data.length<r.exactLength.value;(o||l)&&(O(t,{code:o?S.too_big:S.too_small,minimum:l?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(O(t,{code:S.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(O(t,{code:S.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),t.common.async)return Promise.all(t.data.map((o,l)=>r.type._parseAsync(new pt(t,o,t.path,l)))).then(o=>Pe.mergeArray(i,o));const s=t.data.map((o,l)=>r.type._parseSync(new pt(t,o,t.path,l)));return Pe.mergeArray(i,s)}get element(){return this._def.type}min(e,t){return new qe({...this._def,minLength:{value:e,message:H.toString(t)}})}max(e,t){return new qe({...this._def,maxLength:{value:e,message:H.toString(t)}})}length(e,t){return new qe({...this._def,exactLength:{value:e,message:H.toString(t)}})}nonempty(e){return this.min(1,e)}}qe.create=(n,e)=>new qe({type:n,minLength:null,maxLength:null,exactLength:null,typeName:D.ZodArray,...$(e)});var Dr;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Dr||(Dr={}));const Zl=n=>e=>new ee({...n,shape:()=>({...n.shape(),...e})});function kn(n){if(n instanceof ee){const e={};for(const t in n.shape){const i=n.shape[t];e[t]=ht.create(kn(i))}return new ee({...n._def,shape:()=>e})}else return n instanceof qe?qe.create(kn(n.element)):n instanceof ht?ht.create(kn(n.unwrap())):n instanceof un?un.create(kn(n.unwrap())):n instanceof mt?mt.create(n.items.map(e=>kn(e))):n}class ee extends I{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=Zl(this._def),this.extend=Zl(this._def)}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=j.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==C.object){const c=this._getOrReturnCtx(e);return O(c,{code:S.invalid_type,expected:C.object,received:c.parsedType}),_}const{status:i,ctx:r}=this._processInputParams(e),{shape:s,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof At&&this._def.unknownKeys==="strip"))for(const c in r.data)o.includes(c)||l.push(c);const a=[];for(const c of o){const h=s[c],u=r.data[c];a.push({key:{status:"valid",value:c},value:h._parse(new pt(r,u,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof At){const c=this._def.unknownKeys;if(c==="passthrough")for(const h of l)a.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(c==="strict")l.length>0&&(O(r,{code:S.unrecognized_keys,keys:l}),i.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const h of l){const u=r.data[h];a.push({key:{status:"valid",value:h},value:c._parse(new pt(r,u,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const h of a){const u=await h.key;c.push({key:u,value:await h.value,alwaysSet:h.alwaysSet})}return c}).then(c=>Pe.mergeObjectSync(i,c)):Pe.mergeObjectSync(i,a)}get shape(){return this._def.shape()}strict(e){return H.errToObj,new ee({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,i)=>{var r,s,o,l;const a=(o=(s=(r=this._def).errorMap)===null||s===void 0?void 0:s.call(r,t,i).message)!==null&&o!==void 0?o:i.defaultError;return t.code==="unrecognized_keys"?{message:(l=H.errToObj(e).message)!==null&&l!==void 0?l:a}:{message:a}}}:{}})}strip(){return new ee({...this._def,unknownKeys:"strip"})}passthrough(){return new ee({...this._def,unknownKeys:"passthrough"})}setKey(e,t){return this.augment({[e]:t})}merge(e){return new ee({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>Dr.mergeShapes(this._def.shape(),e._def.shape()),typeName:D.ZodObject})}catchall(e){return new ee({...this._def,catchall:e})}pick(e){const t={};return j.objectKeys(e).map(i=>{this.shape[i]&&(t[i]=this.shape[i])}),new ee({...this._def,shape:()=>t})}omit(e){const t={};return j.objectKeys(this.shape).map(i=>{j.objectKeys(e).indexOf(i)===-1&&(t[i]=this.shape[i])}),new ee({...this._def,shape:()=>t})}deepPartial(){return kn(this)}partial(e){const t={};if(e)return j.objectKeys(this.shape).map(i=>{j.objectKeys(e).indexOf(i)===-1?t[i]=this.shape[i]:t[i]=this.shape[i].optional()}),new ee({...this._def,shape:()=>t});for(const i in this.shape){const r=this.shape[i];t[i]=r.optional()}return new ee({...this._def,shape:()=>t})}required(e){const t={};if(e)j.objectKeys(this.shape).map(i=>{if(j.objectKeys(e).indexOf(i)===-1)t[i]=this.shape[i];else{let s=this.shape[i];for(;s instanceof ht;)s=s._def.innerType;t[i]=s}});else for(const i in this.shape){let s=this.shape[i];for(;s instanceof ht;)s=s._def.innerType;t[i]=s}return new ee({...this._def,shape:()=>t})}keyof(){return Hc(j.objectKeys(this.shape))}}ee.create=(n,e)=>new ee({shape:()=>n,unknownKeys:"strip",catchall:At.create(),typeName:D.ZodObject,...$(e)});ee.strictCreate=(n,e)=>new ee({shape:()=>n,unknownKeys:"strict",catchall:At.create(),typeName:D.ZodObject,...$(e)});ee.lazycreate=(n,e)=>new ee({shape:n,unknownKeys:"strip",catchall:At.create(),typeName:D.ZodObject,...$(e)});class pi extends I{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.options;function r(s){for(const l of s)if(l.result.status==="valid")return l.result;for(const l of s)if(l.result.status==="dirty")return t.common.issues.push(...l.ctx.common.issues),l.result;const o=s.map(l=>new kt(l.ctx.common.issues));return O(t,{code:S.invalid_union,unionErrors:o}),_}if(t.common.async)return Promise.all(i.map(async s=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(r);{let s;const o=[];for(const a of i){const c={...t,common:{...t.common,issues:[]},parent:null},h=a._parseSync({data:t.data,path:t.path,parent:c});if(h.status==="valid")return h;h.status==="dirty"&&!s&&(s={result:h,ctx:c}),c.common.issues.length&&o.push(c.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;const l=o.map(a=>new kt(a));return O(t,{code:S.invalid_union,unionErrors:l}),_}}get options(){return this._def.options}}pi.create=(n,e)=>new pi({options:n,typeName:D.ZodUnion,...$(e)});const sr=n=>n instanceof yi?sr(n.schema):n instanceof Ke?sr(n.innerType()):n instanceof bi?[n.value]:n instanceof Di?n.options:n instanceof wi?Object.keys(n.enum):n instanceof vi?sr(n._def.innerType):n instanceof fi?[void 0]:n instanceof di?[null]:null;class rs extends I{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.object)return O(t,{code:S.invalid_type,expected:C.object,received:t.parsedType}),_;const i=this.discriminator,r=t.data[i],s=this.optionsMap.get(r);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(O(t,{code:S.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),_)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){const r=new Map;for(const s of t){const o=sr(s.shape[e]);if(!o)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const l of o){if(r.has(l))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(l)}`);r.set(l,s)}}return new rs({typeName:D.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...$(i)})}}function Xs(n,e){const t=Dt(n),i=Dt(e);if(n===e)return{valid:!0,data:n};if(t===C.object&&i===C.object){const r=j.objectKeys(e),s=j.objectKeys(n).filter(l=>r.indexOf(l)!==-1),o={...n,...e};for(const l of s){const a=Xs(n[l],e[l]);if(!a.valid)return{valid:!1};o[l]=a.data}return{valid:!0,data:o}}else if(t===C.array&&i===C.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let s=0;s<n.length;s++){const o=n[s],l=e[s],a=Xs(o,l);if(!a.valid)return{valid:!1};r.push(a.data)}return{valid:!0,data:r}}else return t===C.date&&i===C.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class mi extends I{_parse(e){const{status:t,ctx:i}=this._processInputParams(e),r=(s,o)=>{if(Js(s)||Js(o))return _;const l=Xs(s.value,o.value);return l.valid?((Ys(s)||Ys(o))&&t.dirty(),{status:t.value,value:l.data}):(O(i,{code:S.invalid_intersection_types}),_)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([s,o])=>r(s,o)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}mi.create=(n,e,t)=>new mi({left:n,right:e,typeName:D.ZodIntersection,...$(t)});class mt extends I{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==C.array)return O(i,{code:S.invalid_type,expected:C.array,received:i.parsedType}),_;if(i.data.length<this._def.items.length)return O(i,{code:S.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),_;!this._def.rest&&i.data.length>this._def.items.length&&(O(i,{code:S.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=i.data.map((o,l)=>{const a=this._def.items[l]||this._def.rest;return a?a._parse(new pt(i,o,i.path,l)):null}).filter(o=>!!o);return i.common.async?Promise.all(s).then(o=>Pe.mergeArray(t,o)):Pe.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new mt({...this._def,rest:e})}}mt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new mt({items:n,typeName:D.ZodTuple,rest:null,...$(e)})};class gi extends I{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==C.object)return O(i,{code:S.invalid_type,expected:C.object,received:i.parsedType}),_;const r=[],s=this._def.keyType,o=this._def.valueType;for(const l in i.data)r.push({key:s._parse(new pt(i,l,i.path,l)),value:o._parse(new pt(i,i.data[l],i.path,l))});return i.common.async?Pe.mergeObjectAsync(t,r):Pe.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,i){return t instanceof I?new gi({keyType:e,valueType:t,typeName:D.ZodRecord,...$(i)}):new gi({keyType:Tt.create(),valueType:e,typeName:D.ZodRecord,...$(t)})}}class _r extends I{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==C.map)return O(i,{code:S.invalid_type,expected:C.map,received:i.parsedType}),_;const r=this._def.keyType,s=this._def.valueType,o=[...i.data.entries()].map(([l,a],c)=>({key:r._parse(new pt(i,l,i.path,[c,"key"])),value:s._parse(new pt(i,a,i.path,[c,"value"]))}));if(i.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const a of o){const c=await a.key,h=await a.value;if(c.status==="aborted"||h.status==="aborted")return _;(c.status==="dirty"||h.status==="dirty")&&t.dirty(),l.set(c.value,h.value)}return{status:t.value,value:l}})}else{const l=new Map;for(const a of o){const c=a.key,h=a.value;if(c.status==="aborted"||h.status==="aborted")return _;(c.status==="dirty"||h.status==="dirty")&&t.dirty(),l.set(c.value,h.value)}return{status:t.value,value:l}}}}_r.create=(n,e,t)=>new _r({valueType:e,keyType:n,typeName:D.ZodMap,...$(t)});class hn extends I{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==C.set)return O(i,{code:S.invalid_type,expected:C.set,received:i.parsedType}),_;const r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(O(i,{code:S.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(O(i,{code:S.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const s=this._def.valueType;function o(a){const c=new Set;for(const h of a){if(h.status==="aborted")return _;h.status==="dirty"&&t.dirty(),c.add(h.value)}return{status:t.value,value:c}}const l=[...i.data.values()].map((a,c)=>s._parse(new pt(i,a,i.path,c)));return i.common.async?Promise.all(l).then(a=>o(a)):o(l)}min(e,t){return new hn({...this._def,minSize:{value:e,message:H.toString(t)}})}max(e,t){return new hn({...this._def,maxSize:{value:e,message:H.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}hn.create=(n,e)=>new hn({valueType:n,minSize:null,maxSize:null,typeName:D.ZodSet,...$(e)});class Tn extends I{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.function)return O(t,{code:S.invalid_type,expected:C.function,received:t.parsedType}),_;function i(l,a){return Cr({data:l,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ar(),ci].filter(c=>!!c),issueData:{code:S.invalid_arguments,argumentsError:a}})}function r(l,a){return Cr({data:l,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ar(),ci].filter(c=>!!c),issueData:{code:S.invalid_return_type,returnTypeError:a}})}const s={errorMap:t.common.contextualErrorMap},o=t.data;return this._def.returns instanceof _n?Ne(async(...l)=>{const a=new kt([]),c=await this._def.args.parseAsync(l,s).catch(f=>{throw a.addIssue(i(l,f)),a}),h=await o(...c);return await this._def.returns._def.type.parseAsync(h,s).catch(f=>{throw a.addIssue(r(h,f)),a})}):Ne((...l)=>{const a=this._def.args.safeParse(l,s);if(!a.success)throw new kt([i(l,a.error)]);const c=o(...a.data),h=this._def.returns.safeParse(c,s);if(!h.success)throw new kt([r(c,h.error)]);return h.data})}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Tn({...this._def,args:mt.create(e).rest(rn.create())})}returns(e){return new Tn({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new Tn({args:e||mt.create([]).rest(rn.create()),returns:t||rn.create(),typeName:D.ZodFunction,...$(i)})}}class yi extends I{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}yi.create=(n,e)=>new yi({getter:n,typeName:D.ZodLazy,...$(e)});class bi extends I{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return O(t,{code:S.invalid_literal,expected:this._def.value}),_}return{status:"valid",value:e.data}}get value(){return this._def.value}}bi.create=(n,e)=>new bi({value:n,typeName:D.ZodLiteral,...$(e)});function Hc(n,e){return new Di({values:n,typeName:D.ZodEnum,...$(e)})}class Di extends I{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),i=this._def.values;return O(t,{expected:j.joinValues(i),received:t.parsedType,code:S.invalid_type}),_}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),i=this._def.values;return O(t,{received:t.data,code:S.invalid_enum_value,options:i}),_}return Ne(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}}Di.create=Hc;class wi extends I{_parse(e){const t=j.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==C.string&&i.parsedType!==C.number){const r=j.objectValues(t);return O(i,{expected:j.joinValues(r),received:i.parsedType,code:S.invalid_type}),_}if(t.indexOf(e.data)===-1){const r=j.objectValues(t);return O(i,{received:i.data,code:S.invalid_enum_value,options:r}),_}return Ne(e.data)}get enum(){return this._def.values}}wi.create=(n,e)=>new wi({values:n,typeName:D.ZodNativeEnum,...$(e)});class _n extends I{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.promise&&t.common.async===!1)return O(t,{code:S.invalid_type,expected:C.promise,received:t.parsedType}),_;const i=t.parsedType===C.promise?t.data:Promise.resolve(t.data);return Ne(i.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}_n.create=(n,e)=>new _n({type:n,typeName:D.ZodPromise,...$(e)});class Ke extends I{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===D.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:i}=this._processInputParams(e),r=this._def.effect||null;if(r.type==="preprocess"){const o=r.transform(i.data);return i.common.async?Promise.resolve(o).then(l=>this._def.schema._parseAsync({data:l,path:i.path,parent:i})):this._def.schema._parseSync({data:o,path:i.path,parent:i})}const s={addIssue:o=>{O(i,o),o.fatal?t.abort():t.dirty()},get path(){return i.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="refinement"){const o=l=>{const a=r.refinement(l,s);if(i.common.async)return Promise.resolve(a);if(a instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(i.common.async===!1){const l=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return l.status==="aborted"?_:(l.status==="dirty"&&t.dirty(),o(l.value),{status:t.value,value:l.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(l=>l.status==="aborted"?_:(l.status==="dirty"&&t.dirty(),o(l.value).then(()=>({status:t.value,value:l.value}))))}if(r.type==="transform")if(i.common.async===!1){const o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Mr(o))return o;const l=r.transform(o.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:l}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>Mr(o)?Promise.resolve(r.transform(o.value,s)).then(l=>({status:t.value,value:l})):o);j.assertNever(r)}}Ke.create=(n,e,t)=>new Ke({schema:n,typeName:D.ZodEffects,effect:e,...$(t)});Ke.createWithPreprocess=(n,e,t)=>new Ke({schema:e,effect:{type:"preprocess",transform:n},typeName:D.ZodEffects,...$(t)});class ht extends I{_parse(e){return this._getType(e)===C.undefined?Ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ht.create=(n,e)=>new ht({innerType:n,typeName:D.ZodOptional,...$(e)});class un extends I{_parse(e){return this._getType(e)===C.null?Ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}un.create=(n,e)=>new un({innerType:n,typeName:D.ZodNullable,...$(e)});class vi extends I{_parse(e){const{ctx:t}=this._processInputParams(e);let i=t.data;return t.parsedType===C.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}vi.create=(n,e)=>new vi({innerType:n,typeName:D.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$(e)});class Pr extends I{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.innerType._parse({data:t.data,path:t.path,parent:t});return Or(i)?i.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.defaultValue()})):{status:"valid",value:i.status==="valid"?i.value:this._def.defaultValue()}}removeDefault(){return this._def.innerType}}Pr.create=(n,e)=>new Pr({innerType:n,typeName:D.ZodCatch,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$(e)});class Lr extends I{_parse(e){if(this._getType(e)!==C.nan){const i=this._getOrReturnCtx(e);return O(i,{code:S.invalid_type,expected:C.nan,received:i.parsedType}),_}return{status:"valid",value:e.data}}}Lr.create=n=>new Lr({typeName:D.ZodNaN,...$(n)});const Bp=Symbol("zod_brand");class zc extends I{_parse(e){const{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class _i extends I{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?_:s.status==="dirty"?(t.dirty(),Fc(s.value)):this._def.out._parseAsync({data:s.value,path:i.path,parent:i})})();{const r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?_:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(e,t){return new _i({in:e,out:t,typeName:D.ZodPipeline})}}const Wc=(n,e={},t)=>n?Dn.create().superRefine((i,r)=>{if(!n(i)){const s=typeof e=="function"?e(i):e,o=typeof s=="string"?{message:s}:s;r.addIssue({code:"custom",...o,fatal:t})}}):Dn.create(),Ip={object:ee.lazycreate};var D;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline"})(D||(D={}));const Rp=(n,e={message:`Input not instance of ${n.name}`})=>Wc(t=>t instanceof n,e,!0),jc=Tt.create,Uc=Ft.create,$p=Lr.create,Vp=hi.create,Zc=ui.create,Fp=cn.create,Hp=Nr.create,zp=fi.create,Wp=di.create,jp=Dn.create,Up=rn.create,Zp=At.create,qp=Er.create,Kp=qe.create,Gp=ee.create,Jp=ee.strictCreate,Yp=pi.create,Xp=rs.create,Qp=mi.create,em=mt.create,tm=gi.create,nm=_r.create,im=hn.create,rm=Tn.create,sm=yi.create,om=bi.create,lm=Di.create,am=wi.create,cm=_n.create,ql=Ke.create,hm=ht.create,um=un.create,fm=Ke.createWithPreprocess,dm=_i.create,pm=()=>jc().optional(),mm=()=>Uc().optional(),gm=()=>Zc().optional(),ym={string:n=>Tt.create({...n,coerce:!0}),number:n=>Ft.create({...n,coerce:!0}),boolean:n=>ui.create({...n,coerce:!0}),bigint:n=>hi.create({...n,coerce:!0}),date:n=>cn.create({...n,coerce:!0})},bm=_;var m=Object.freeze({__proto__:null,defaultErrorMap:ci,setErrorMap:Op,getErrorMap:Ar,makeIssue:Cr,EMPTY_PATH:Np,addIssueToContext:O,ParseStatus:Pe,INVALID:_,DIRTY:Fc,OK:Ne,isAborted:Js,isDirty:Ys,isValid:Mr,isAsync:Or,get util(){return j},ZodParsedType:C,getParsedType:Dt,ZodType:I,ZodString:Tt,ZodNumber:Ft,ZodBigInt:hi,ZodBoolean:ui,ZodDate:cn,ZodSymbol:Nr,ZodUndefined:fi,ZodNull:di,ZodAny:Dn,ZodUnknown:rn,ZodNever:At,ZodVoid:Er,ZodArray:qe,get objectUtil(){return Dr},ZodObject:ee,ZodUnion:pi,ZodDiscriminatedUnion:rs,ZodIntersection:mi,ZodTuple:mt,ZodRecord:gi,ZodMap:_r,ZodSet:hn,ZodFunction:Tn,ZodLazy:yi,ZodLiteral:bi,ZodEnum:Di,ZodNativeEnum:wi,ZodPromise:_n,ZodEffects:Ke,ZodTransformer:Ke,ZodOptional:ht,ZodNullable:un,ZodDefault:vi,ZodCatch:Pr,ZodNaN:Lr,BRAND:Bp,ZodBranded:zc,ZodPipeline:_i,custom:Wc,Schema:I,ZodSchema:I,late:Ip,get ZodFirstPartyTypeKind(){return D},coerce:ym,any:jp,array:Kp,bigint:Vp,boolean:Zc,date:Fp,discriminatedUnion:Xp,effect:ql,enum:lm,function:rm,instanceof:Rp,intersection:Qp,lazy:sm,literal:om,map:nm,nan:$p,nativeEnum:am,never:Zp,null:Wp,nullable:um,number:Uc,object:Gp,oboolean:gm,onumber:mm,optional:hm,ostring:pm,pipeline:dm,preprocess:fm,promise:cm,record:tm,set:im,strictObject:Jp,string:jc,symbol:Hp,transformer:ql,tuple:em,undefined:zp,union:Yp,unknown:Up,void:qp,NEVER:bm,ZodIssueCode:S,quotelessJson:Mp,ZodError:kt});const qc=m.object({id:m.string(),secret:m.boolean().optional()}),Kc=m.intersection(qc,m.object({folderId:m.string().optional()})),wm=m.union([m.literal("SOLID"),m.literal("DASHED"),m.literal("DOTTED")],{}),vm=m.union([m.literal("POINT"),m.literal("OPEN"),m.literal("CROSS")],{}),km=m.union([m.literal("NONE"),m.literal("X"),m.literal("Y"),m.literal("XY"),m.literal("AUTO")],{}),xm=m.union([m.literal("SMALL"),m.literal("MEDIUM"),m.literal("LARGE"),m.string()],{}),Sm=m.union([m.literal("default"),m.literal("center"),m.literal("center_auto"),m.literal("auto_center"),m.literal("above"),m.literal("above_left"),m.literal("above_right"),m.literal("above_auto"),m.literal("below"),m.literal("below_left"),m.literal("below_right"),m.literal("below_auto"),m.literal("left"),m.literal("auto_left"),m.literal("right"),m.literal("auto_right")],{}),Ts=m.object({min:m.string(),max:m.string()}),Gc=m.object({enabled:m.boolean().optional(),description:m.string().optional(),latex:m.string().optional()}),Tm=m.object({type:m.literal("expression"),showLabel:m.boolean().optional(),fill:m.boolean().optional(),fillOpacity:m.string().optional(),label:m.string().optional(),labelSize:xm.optional(),labelOrientation:Sm.optional(),labelAngle:m.string().optional(),suppressTextOutline:m.boolean().optional(),interactiveLabel:m.boolean().optional(),editableLabelMode:m.union([m.literal("MATH"),m.literal("TEXT")]).optional(),residualVariable:m.string().optional(),regressionParameters:m.record(m.string(),m.number()).optional(),isLogModeRegression:m.boolean().optional(),displayEvaluationAsFraction:m.boolean().optional(),slider:m.object({hardMin:m.boolean().optional(),hardMax:m.boolean().optional(),animationPeriod:m.number().optional(),loopMode:m.union([m.literal("LOOP_FORWARD_REVERSE"),m.literal("LOOP_FORWARD"),m.literal("PLAY_ONCE"),m.literal("PLAY_INDEFINITELY")]).optional(),playDirection:m.union([m.literal(-1),m.literal(1)]).optional(),isPlaying:m.boolean().optional(),min:m.string().optional(),max:m.string().optional(),step:m.string().optional()}).optional(),polarDomain:Ts.optional(),parametricDomain:Ts.optional(),domain:Ts.optional(),cdf:m.object({show:m.boolean(),min:m.string().optional(),max:m.string().optional()}).optional(),vizProps:m.object({breadth:m.string().optional(),axisOffset:m.string().optional(),alignedAxis:m.union([m.literal("x"),m.literal("y")]).optional(),showBoxplotOutliers:m.boolean().optional(),dotplotXMode:m.union([m.literal("exact"),m.literal("binned")]).optional(),binAlignment:m.union([m.literal("left"),m.literal("center")]).optional(),histogramMode:m.union([m.literal("count"),m.literal("relative"),m.literal("density")]).optional()}).optional(),clickableInfo:Gc.optional()}),Jc=m.object({color:m.string(),latex:m.string().optional(),hidden:m.boolean().optional(),points:m.boolean().optional(),lines:m.boolean().optional(),dragMode:km.optional(),lineStyle:wm.optional(),pointStyle:vm.optional(),colorLatex:m.string().optional(),lineOpacity:m.string().optional(),lineWidth:m.string().optional(),pointSize:m.string().optional(),pointOpacity:m.string().optional()}),Yc=Tm.merge(Jc),Am=m.object({type:m.literal("image"),image_url:m.string(),name:m.string().optional(),width:m.string().optional(),height:m.string().optional(),hidden:m.boolean().optional(),center:m.string().optional(),angle:m.string().optional(),opacity:m.string().optional(),foreground:m.boolean().optional(),draggable:m.boolean().optional(),clickableInfo:m.intersection(Gc,m.object({hoveredImage:m.string().optional(),depressedImage:m.string().optional()}))}),Cm=m.intersection(m.object({id:m.string(),values:m.array(m.string())}),Jc),Mm=m.intersection(Kc,m.object({type:m.literal("table"),columns:m.array(Cm)})),Om=m.intersection(qc,m.object({type:m.literal("folder"),hidden:m.boolean().optional(),collapsed:m.boolean().optional(),title:m.string().optional()})),Nm=m.intersection(Kc,m.object({type:m.literal("text"),text:m.string().optional()})),Kl=m.union([m.literal("NONE"),m.literal("POSITIVE"),m.literal("BOTH")],{}),Xc=m.object({viewport:m.object({xmin:m.number(),ymin:m.number(),xmax:m.number(),ymax:m.number()}).strict(),xAxisMinorSubdivisions:m.number().optional(),yAxisMinorSubdivisions:m.number().optional(),degreeMode:m.boolean().optional(),showGrid:m.boolean().optional(),showXAxis:m.boolean().optional(),showYAxis:m.boolean().optional(),xAxisNumbers:m.boolean().optional(),yAxisNumbers:m.boolean().optional(),polarNumbers:m.boolean().optional(),xAxisStep:m.number().optional(),yAxisStep:m.number().optional(),xAxisArrowMode:Kl.optional(),yAxisArrowMode:Kl.optional(),xAxisLabel:m.string().optional(),yAxisLabel:m.string().optional(),squareAxes:m.boolean().optional(),restrictGridToFirstQuadrant:m.boolean().optional(),polarMode:m.boolean().optional(),userLockedViewport:m.boolean().optional()}).strict(),Em=m.union([Yc,Am,Mm,Nm]),Qc=m.object({handlerLatex:m.string().optional(),minStepLatex:m.string().optional(),open:m.boolean().optional(),playing:m.boolean().optional()}),Dm=m.union([Em,Om],{});m.object({version:m.literal(9),randomSeed:m.string().optional(),graph:Xc,expressions:m.object({list:m.array(Dm),ticker:m.optional(Qc)})});function As(n){return n.length<=1?n:`${n[0]}_{${n.slice(1)}}`}function _m(n){return n===""?"":n[0].toUpperCase()+n.slice(1)}function sn(n,e,t){const i=Ue(t.units.get(t.currentUnit),e,n,{compilationUnits:t.units});if(i.result!="found"){if(i.result=="point-member-access")return`${sn(n.slice(0,-1),e,t)}.${n[n.length-1]}`;throw oe("TODO"+n.join("."))}const r=Cc(e).reverse();if(i.identifier.type=="function")r.splice(0,0,an(t,i.identifier.node,"fndef").name);else if(i.identifier.type=="variable")r.splice(0,0,an(t,i.identifier.node,"assignment").lhs);else if(i.identifier.type=="builtin-function"){if(i.identifier.definedByDesmos)return`\\operatorname{${n[n.length-1]}}`;r.splice(0,0,n[n.length-1])}else if(i.identifier.type=="builtin-variable"){if(i.identifier.definedByDesmos)return n[n.length-1];r.splice(0,0,n[n.length-1])}r.push(t.currentUnit.split("/").reverse()[0].replace(".desmo",""));const s=t.identifierNames.get(i.identifier.id);if(s)return As(s);let o="";const l=()=>{t.existingNames.add(o),t.identifierNames.set(i.identifier.id,o)};for(const h of r)if(o=_m(h)+o,!t.existingNames.has(o))return l(),As(o);let a=o,c=2;for(;;){if(o=a+c,!t.existingNames.has(o))return l(),As(o);c++}}function oi(n,e){const t=i=>oi(i,e);switch(n.type){case"binop":const i=t(n.lhs),r=t(n.rhs);switch(n.op){case"+":case"-":case"*":return`\\left(${i}${n.op}${r}\\right)`;case"/":return`\\frac{${i}}{${r}}`;case"^":return`${i}^{${r}}`;case"%":return`\\operatorname{mod}\\left(${i},${r}\\right)`;case"<":case">":case"==":return`${i}${n.op=="=="?"=":n.op}${r}`;case">=":return`${i}\\ge ${r}`;case"<=":return`${i}\\le ${r}`;case"[":return`\\left(${i}\\right)\\left[${r}\\right]`;case",":return`\\left(${i},${r}\\right)`;case"->":return`${i}\\to ${r}`;default:throw oe(`UNIMPLEMENTED BINARY OP: ${n.op}`)}case"block":const s=n.body[n.body.length-1];if(!s)throw oe("NO EMPTY BLOCKS IN CODEGEN!");const o=dt(s);if(!o.success)throw oe("EMPTY BLOCKS MUST END IN EXPRESSIONS IN CODEGEN");return e.alreadyGeneratedBlockFinalExpressionIDs.add(s.id),t(o.data);case"error":return"ERROR";case"fncall":return`${t(n.name)}\\left(${n.params.map(h=>t(h)).join(",")}\\right)`;case"identifier":return sn(n.segments,n.enclosingScope,e);case"list":return`\\left[${n.elements.map(h=>t(h)).join(",")}\\right]`;case"listcomp":return`\\left[${t(n.body)}\\operatorname{for}${n.params.map(([h,u])=>`${sn([h],n.innerScope,e)}=${t(u)}`).join(",")}\\right]`;case"macrocall":const l=n.result;if(!l||l instanceof Promise)throw oe("UNRESOLVED MACRO");const a=Ue(e.units.get(e.currentUnit),n.enclosingScope,n.name.segments,{compilationUnits:e.units});if(a.result==="found"&&a.identifier.type==="macro"){const h=a.identifier;if(h.customCodegen)try{return h.customCodegen(n,{codegen(u){return t(u)},getNameForIdentifier(u,f){return sn(u,f,e)}})}catch{return"customcodegenfailed!"}}const c=dt(l);return c.success&&c.data.type!="note"?t(c.data):"ERROR";case"match":return`\\left\\{${n.branches.map(([h,u])=>`${t(h)}:${t(u)}`).join(",")}${n.fallback?`,${t(n.fallback)}`:""}\\right\\}`;case"note":throw oe("NO NOTES IN CODEGEN");case"number":return n.number.toString();case"point":return`\\left(${t(n.x)},${t(n.y)}\\right)`;case"range":return n.step?`\\left[${t(n.lhs)},${t(n.step)}...${t(n.rhs)}\\right]`:`\\left[${t(n.lhs)}...${t(n.rhs)}\\right]`;case"unop":if(n.op=="!")throw oe("UNIMPLEMENTED UNARY OP: !");if(n.op==".x"||n.op==".y")return`\\left(${t(n.operand)}\\right)${n.op}`;if(n.op=="-")return`-\\left(${t(n.operand)}\\right)`}throw oe("UNREACHABLE")}function Br(n,e){switch(n.type){case"number":return n.number;case"note":return n.content;case"json-array":return n.elements.map(t=>Br(t,e));case"json-boolean":return n.data;case"json-object":return Object.fromEntries(n.data.map(([t,i])=>[t,Br(i,e)]));case"json-null":return null;case"json-inner-expr":return oi(n.expr,e);case"error":throw oe("ERROR NODE IN JSON")}}function Pm(){return{version:9,graph:{viewport:{xmin:-10,ymin:-10,xmax:10,ymax:10}},expressions:{list:[]}}}function Gl(n,e){const t=n.astNodes.get(e);if(!t)throw oe("expected a node to exist");if(t.type=="json-array"||t.type=="json-boolean"||t.type=="json-object"||t.type=="number"||t.type=="note"||t.type=="json-inner-expr"||t.type=="json-null")return t;throw oe("expected a json expression")}function eh(n,e){n.options.allInOneFolderID!==void 0&&(n.folderState={id:n.options.allInOneFolderID,name:""});const t=()=>{n.options.allInOneFolderID===void 0&&n.folderState&&n.state.expressions.list.push({id:n.folderState.id,title:n.folderState.name,type:"folder"})},i=o=>{const l=Yc.partial().safeParse(Br(o,n));return l.success?l.data:(n.errors.push({type:"bad-json",node:o,start:o.start,end:o.end,unit:n.currentUnit,reason:""}),{})},r=o=>o?i(Gl(n,o)):{},s=o=>{n.options.annotateExpressionsWithEquivalentDesmoscript&&n.state.expressions.list.push({id:B().toString(),type:"text",text:L(o,{indent:2,tabSize:2,maxlen:80,bindingPower:0}),folderId:n.folderState?.id})};for(const o of e.imports)Qs({...n,currentUnit:o.compilationUnitPath});for(const[o,l]of e.elements.entries())switch(l.type){case"variable":const a=an(n,l.node,"assignment");s(a),n.state.expressions.list.push({id:B().toString(),type:"expression",color:"black",latex:`${sn([o],e,n)}=${oi(a.rhs,n)}`,folderId:n.folderState?.id,...r(l.display)});break;case"function":const c=an(n,l.node,"fndef");s(c),n.state.expressions.list.push({latex:`${sn([o],e,n)}\\left(${c.params.map(p=>sn([p],c.innerScope,n))}\\right)=${oi(c.body,n)}`,id:B().toString(),type:"expression",color:"black",folderId:n.folderState?.id,...r(l.display)});break;case"scope":if(l.scope.elements.size==0||l.ignoreTypecheckAndCodegen)break;const h=n.folderState,u={id:B().toString(),name:(h?.name??"")+(h?`/${l.scope.name}`:`${l.scope.name}`)};n.folderState=u,t(),eh(n,l.scope),n.folderState=h;break;case"note":n.state.expressions.list.push({type:"text",text:l.text,id:B().toString(),folderId:n.folderState?.id});break;case"import":{Qs({...n,currentUnit:l.compilationUnitPath});break}case"settings":const f=Br(Gl(n,l.settings),n);switch(l.settingsType){case"settings":const p=Xc.safeParse(f);if(p.success)n.state.graph=p.data;else throw q(f,n.currentUnit,"failed to set settings for the following reasons: "+p.error.format()._errors.join(`
`));case"ticker":const g=Qc.safeParse(f);if(g.success)n.state.expressions.ticker=g.data;else throw q(f,n.currentUnit,"failed to set ticker for the following reasons: "+g.error.format()._errors.join(`
`))}break;case"expression":const d=$c(n,l.expr);if(s(d),n.alreadyGeneratedBlockFinalExpressionIDs.has(d.id))break;n.state.expressions.list.push({type:"expression",id:B().toString(),folderId:n.folderState?.id,latex:oi(d,n),color:"black",...r(l.display)})}}function Qs(n){n.alreadyCompiledUnits.has(n.currentUnit)||(n.alreadyCompiledUnits.add(n.currentUnit),eh(n,ns(n.units.get(n.currentUnit),`${n.currentUnit} not found in generateCodeForCompilationUnit`).scopeTree))}function Lm(n){Qs(n),n.options.allInOneFolderID&&n.state.expressions.list.splice(0,0,{type:"folder",id:n.options.allInOneFolderID,title:"Desmoscript Compiler Output"})}const Bm=new Function("src","return import(src);");async function Jo(n,e,t,i){const r=i.io.resolvePath(i.io.dirname(e),n);if(!i.imports.has(r))try{const s=await i.getFile(r);i.watchFiles.add(r),i.sourceCode.set(r,{src:s,linesAndCols:Yo(s)});const o=[],l=i.lexAndParse(r,s,i.errors,o);i.highlightsMap?.set(r,o),i.imports.set(r,{name:r,src:s,ast:l}),await xc(l,void 0,async a=>{if(a.type=="import")await Jo(a.src,r,a,i);else if(a.type=="import-script"&&!i.importScripts.has(a.src)){const c=i.io.resolvePath(i.io.dirname(e),a.src),h=await i.getFile(c);i.watchFiles.add(c);try{const u=await Bm(`data:text/javascript,${encodeURIComponent(h)}`);i.importScripts.set(c,{run:u.default})}catch(u){i.errors.push({type:"general",start:a.start,end:a.end,unit:r,reason:`failed to load '${a.src}': ${u}'`})}}})}catch{i.errors.push(Ni(`failed to import '${n}' (full path: ${r})`,t?.start??0,t?.end??0,e))}}function Im(n,e){const t=[];let i=!1;return Yt(n,void 0,r=>{if(r.type!="macrocall")return;const s=r.enclosingScope,o=Ue(e.units.get(e.unit),s,r.name.segments,{compilationUnits:e.units}),l=r;if(o.result=="not-found"){t.push(ii(l,e.unit,`the macro '${r.name.segments.join(".")}' does not exist`).why[0]);return}else if(o.result=="point-member-access"){t.push(ii(l,e.unit,"expected a macro; got a number").why[0]);return}if(o.identifier.type!="macro"){t.push(ii(l,e.unit,`expected a macro; got a '${o.identifier.type}'`).why[0]);return}l.result||(i=!0,l.useInnerScope=o.identifier.useInnerScope,l.result=o.identifier.macroOperation(l,ap(e.errors,l,e)))}),i}async function Rm(n,e){await xc(n,void 0,async(t,i)=>{if(t.type!="macrocall")return t;if(!(t.result instanceof Promise))return i;try{t.result=await t.result}catch(r){r!=""&&(t.result={start:t.start,end:t.end,id:B(),type:"error",reason:"error during macro evaluation: "+r?.toString(),unitName:e.unit})}return t.result=vr(t.result,{parentNode:i,scope:t.useInnerScope?t.innerScope:t.enclosingScope},{...e,errors:e.errors,importScripts:e.importScripts,getAbsolutePath:e.getAbsolutePath}),i})}function th(n,e,t,i){const r=Ho(e,n,t);return zo(r,n,t,i)}function ss(n,e,t,i,r,s,o,l){const a=o.resolvePath(o.dirname(e),n);if(t.has(a))return a;const c=r.get(a);if(!c)return i.push(Ni("BAD IMPORT",0,0,n)),"";t.add(a);const u={resolveImport:(p,g)=>ss(p,g,t,i,r,s,o,l),unit:a,errors:i,importScripts:l,getAbsolutePath:(p,g)=>o.resolvePath(o.dirname(p),g)},f=vn(void 0,"",u,0,c.src.length);pp(f,u);const d=vr(c.ast,{scope:f,isValueBlock:!1},u);return s.set(a,{scopeTree:d.enclosingScope,name:a,src:c.src,linesAndCols:Yo(c.src),ast:d}),a}async function nh(n,e,t,i,r,s,o,l,a){for(let c=0;c<100;c++){let h=!1;const u=[];for(const f of n.values()){const d={unit:f.name,units:n,resolveImport:(p,g)=>ss(p,g,e,t,i,n,s,l),sourceCode:r,errors:t,io:s,watchFiles:o,importScripts:l,getAbsolutePath:a};h||=Im(f.ast,d),u.push(Rm(f.ast,d))}if(await Promise.all(u),!h)break;c==100&&t.push(Ni("maximum macro instantiation depth exceeded",0,0,""))}}function $m(n,e){Yt(n,void 0,(t,i)=>{e.set(t.id,t)})}function Vm(n,e){$m(n.ast,e)}function ih(n){const e=new Map;for(const t of n.values())Vm(t,e);return e}async function rh(n,e){const t=new Map,i=new Map,r=new Map,s=[],o=new Map,l=new Set;if(await Jo(n,n,void 0,{imports:t,sourceCode:r,lexAndParse:th,errors:s,getFile:async g=>e.unsavedFiles.has(g)?e.unsavedFiles.get(g):Zo(await e.io.readFile(g)),io:e.io,watchFiles:e.watchFiles,importScripts:i}),s.length>0)return{type:"error",errors:s,sourceCode:r};if(ss(n,n,l,s,t,o,e.io,i),s.length>0)return{type:"error",errors:s,sourceCode:r};const a=(g,y)=>e.io.resolvePath(e.io.dirname(g),y);await nh(o,l,s,t,r,e.io,e.watchFiles,i,a);const c=ih(o),h=e.io.resolvePath(e.io.dirname(n),n),u=ns(o.get(h),`${h} not found in compileDesmoscript`),f=Tr(u.scopeTree,{units:o,unitName:h,astNodes:c,dependencyChain:new Map,knownTypes:new Map,knownCircularDependencies:new Set})??{why:[]};s.push(...f.why);const d=[],p=Pm();return Lm({units:o,currentUnit:e.io.resolvePath(n),identifierNames:new Map,existingNames:new Set,astNodes:c,state:p,alreadyCompiledUnits:new Set,alreadyGeneratedBlockFinalExpressionIDs:new Set,errors:d,options:e.options}),{type:"success",errors:[...s,...d],state:p,sourceCode:r}}function Fm(n,e){function t(i,r){if(i===void 0)return i===r;if(typeof i!=typeof r)return!1;if(typeof i=="number"||typeof i=="string"||typeof i=="boolean")return i==r;if(Array.isArray(i)){if(!Array.isArray(r)||i.length!=r.length)return!1;const s=[];for(let o=0;o<i.length;o++){const l=t(i[o],r[o]);if(l===!1)return!1;Array.isArray(l)&&s.push(...l)}return s}if(typeof i=="object"&&typeof i.id=="number"){const s=[],o=i;if(typeof r!="object"||typeof r.id!="number")return[{nodeA:o}];const l=r;for(const a of Object.keys(i)){if(a=="id"||a=="start"||a=="end"||a=="enclosingScope"||a=="innerScope"||a=="result"&&o.type=="macrocall")continue;const c=t(i[a],r[a]);if(c===!1)return[{nodeA:o,nodeB:l}];Array.isArray(c)&&s.push(...c)}return s}return!1}return t(n,e)}function sh(n,e){for(const[t,i]of n.elements)if(i.type=="scope"&&e>=i.start&&e<=i.end)return sh(i.scope,e);return n}function Hm(n){const e=new Map,t=new Set;async function i(s){if(r)return r;const o=new Map,l=new Map,a=new Map,c=[],h=new Map,u=new Set,f=new Map;await Jo(s,s,void 0,{imports:o,sourceCode:a,lexAndParse:th,errors:c,getFile:async b=>e.has(b)?e.get(b):Zo(await n.readFile(b)),highlightsMap:f,io:n,watchFiles:t,importScripts:l}),ss(s,s,u,c,o,h,n,l),await nh(h,u,c,o,a,n,t,l,(b,v)=>n.resolvePath(n.dirname(b),v));const p=ih(h),g=n.resolvePath(s),y=ns(h.get(g),`${g} not found in compileDesmoscriptForLanguageSupport (available are ${JSON.stringify(Array.from(h.keys()))}) (sourcecode: ${JSON.stringify(Array.from(a.keys()))})`);return c.push(...Tr(y.scopeTree,{units:h,unitName:g,astNodes:p,dependencyChain:new Map,knownTypes:new Map,knownCircularDependencies:new Set})?.why??[]),r={errors:c,compilationUnits:h,sourceCode:a,highlightsMap:f},r}let r;return{getOpenFilePaths:()=>Array.from(t),compile:(s,o)=>rh(s,{...o,io:n}),updateFile(s,o){r=void 0,e.set(s,o)},async highlightSyntax(s){console.log("GOT HERE!",s);const o=await i(s),l=o.sourceCode.get(s);if(console.log("highlightSyntax",s,o),!l)return[];const a=[],c=(f,d,p,g)=>{if(d==p)return;const y=f.split(`
`);for(const b of y){let v=d+b.length;a.push({start:d,end:v,type:g,token:b}),d=v+1}};if(!o.highlightsMap)return a;const h=o.highlightsMap.get(s);if(h)for(const f of h)a.push({start:f.start,end:f.end,type:f.type,token:l.src.slice(f.start,f.end)});if(!o.compilationUnits)return a;const u=o.compilationUnits.get(s);return u&&Yt(u.ast,void 0,f=>{if(o.compilationUnits&&f.type=="identifier"){const d=Ue(u,f.enclosingScope,f.segments,{compilationUnits:o.compilationUnits});if(d.result!="found")return;c(f.segments[f.segments.length-1],f.start+f.segments.slice(0,-1).join(".").length+(f.segments.length>1?1:0),f.end,{variable:"variable",function:"function",scope:"namespace","builtin-variable":"variable","builtin-function":"function",note:"string",macro:"macro",expression:"variable",import:"namespace",settings:"variable"}[d.identifier.type]);return}}),a},async getDefinitions(s){const o=await i(s);if(!o.compilationUnits)return[];const l=o.compilationUnits.get(s);if(!l)return[];const a=[];return Yt(l.ast,void 0,c=>{if(!o.compilationUnits)return[];if(c.type=="identifier"){const h=Ue(l,c.enclosingScope,c.segments,{compilationUnits:o.compilationUnits});if(h.result!="found")return[];if(h.identifier.type!="function"&&h.identifier.type!="variable")return[];a.push({name:c.segments.join("."),start:c.start,end:c.end,definitionFile:h.identifier.unitName,definitionStart:h.identifier.start,definitionEnd:h.identifier.end})}return[]}),a},async goToDefinition(s,o){const l=await i(s);if(!l.compilationUnits)return;const a=l.compilationUnits.get(s);if(!a)return;let c;if(Yt(a.ast,void 0,u=>{l.compilationUnits&&u.type=="identifier"&&o>=u.start&&o<=u.end&&(c=u)}),!c)return;const h=Ue(a,c.enclosingScope,c.segments,{compilationUnits:l.compilationUnits});if(h.result=="found"&&!(h.identifier.type!="function"&&h.identifier.type!="variable"))return{start:h.identifier.start,end:h.identifier.end,unit:h.identifier.unitName}},async getErrors(s){const o=await i(s),l=[],a=(c,h,u)=>{l.push({start:c,end:h,reason:u})};for(const c of o.errors)if(c.unit==s&&(a(c.start,c.end,Nc({format:(h,u)=>h,entry:s,sourceCode:o.sourceCode,maxWidth:80,hideSourceCode:!0,io:n},c)),c.type=="circular-dependency"))for(const h of c.path)a(h.start,h.end,"this is part of a circular dependency chain");return l},async formatFile(s){const o=await i(s);if(!o.compilationUnits)return;const l=o.compilationUnits.get(s);if(!l)return;const a=md(l.ast);if(!a)return;const c=Ho(a,l.name,[]),h=zo(c,l.name,[]);if(!(Fm(l.ast,h).length>0))return a},async getColors(s){const o=await i(s);if(!o.compilationUnits)return[];const l=o.compilationUnits.get(s);if(!l)return[];const a=l.ast,c=[];return Yt(a,void 0,h=>{h.type=="fncall"&&h.name.segments[0]=="rgb"&&h.params[0]?.type=="number"&&h.params[1]?.type=="number"&&h.params[2]?.type=="number"&&c.push({start:h.start,end:h.end,color:[h.params[0].number,h.params[1].number,h.params[2].number]})}),c},async getAutocomplete(s,o){const l=await i(s);if(!l.compilationUnits)return[];const a=l.compilationUnits.get(s);if(!a)return[];const c=[],h=sh(a.scopeTree,o);let u="",f=o-1;for(;a.src[f]&&a.src[f].match(/[a-zA-Z_0-9\.]/g);)u=a.src[f]+u,f--;for(f=o;a.src[f]&&a.src[f].match(/[a-zA-Z_0-9\.]/g);)u+=a.src[f],f++;const d=u.split("."),p=d.slice(0,-1),g=d[d.length-1];let y;if(p.length!=0){const b=Ue(a,h,p,{compilationUnits:l.compilationUnits});if(b.result!="found")return[];if(b.identifier.type!="scope")return[];y=b.identifier.scope}else y=h;for(const[b,v]of y.elements)if(b.startsWith(g)){const A=b;let k="variable";switch(v.type){case"function":case"builtin-function":k="function";case"macro":k="macro";case"scope":k="scope"}c.push({completedText:A,type:k})}return c},async onHover(s,o){const l=await i(s);if(!l.compilationUnits)return;const a=l.compilationUnits.get(s);if(!a)return;let c;if(Yt(a.ast,void 0,h=>{o>=h.start&&o<=h.end&&h.type=="macrocall"&&(c=h)}),!!c&&c.type=="macrocall"&&c.result&&!(c.result instanceof Promise))return`Evaluates to:
${L(c.result)}`}}}function Yo(n){const e=[];let t=1,i=1;for(const r of n)e.push([t,i]),r==`
`?(t++,i=1):i++;return e}class U{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){let r=[];return this.decompose(0,e,r,2),i.length&&i.decompose(0,i.length,r,3),this.decompose(t,this.length,r,1),st.from(r,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let i=[];return this.decompose(e,t,i,0),st.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),r=new li(this),s=new li(e);for(let o=t,l=t;;){if(r.next(o),s.next(o),o=0,r.lineBreak!=s.lineBreak||r.done!=s.done||r.value!=s.value)return!1;if(l+=r.value.length,r.done||l>=i)return!0}}iter(e=1){return new li(this,e)}iterRange(e,t=this.length){return new oh(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let r=this.line(e).from;i=this.iterRange(r,Math.max(r,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new lh(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?U.empty:e.length<=32?new ce(e):st.from(ce.split(e,[]))}}class ce extends U{constructor(e,t=zm(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.text[s],l=r+o.length;if((t?i:l)>=e)return new Wm(r,l,i,o);r=l+1,i++}}decompose(e,t,i,r){let s=e<=0&&t>=this.length?this:new ce(Jl(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(r&1){let o=i.pop(),l=or(s.text,o.text.slice(),0,s.length);if(l.length<=32)i.push(new ce(l,o.length+s.length));else{let a=l.length>>1;i.push(new ce(l.slice(0,a)),new ce(l.slice(a)))}}else i.push(s)}replace(e,t,i){if(!(i instanceof ce))return super.replace(e,t,i);let r=or(this.text,or(i.text,Jl(this.text,0,e)),t),s=this.length+i.length-(t-e);return r.length<=32?new ce(r,s):st.from(ce.split(r,[]),s)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<=t&&o<this.text.length;o++){let l=this.text[o],a=s+l.length;s>e&&o&&(r+=i),e<a&&t>s&&(r+=l.slice(Math.max(0,e-s),t-s)),s=a+1}return r}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],r=-1;for(let s of e)i.push(s),r+=s.length+1,i.length==32&&(t.push(new ce(i,r)),i=[],r=-1);return r>-1&&t.push(new ce(i,r)),t}}class st extends U{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,r){for(let s=0;;s++){let o=this.children[s],l=r+o.length,a=i+o.lines-1;if((t?a:l)>=e)return o.lineInner(e,t,i,r);r=l+1,i=a+1}}decompose(e,t,i,r){for(let s=0,o=0;o<=t&&s<this.children.length;s++){let l=this.children[s],a=o+l.length;if(e<=a&&t>=o){let c=r&((o<=e?1:0)|(a>=t?2:0));o>=e&&a<=t&&!c?i.push(l):l.decompose(e-o,t-o,i,c)}o=a+1}}replace(e,t,i){if(i.lines<this.lines)for(let r=0,s=0;r<this.children.length;r++){let o=this.children[r],l=s+o.length;if(e>=s&&t<=l){let a=o.replace(e-s,t-s,i),c=this.lines-o.lines+a.lines;if(a.lines<c>>5-1&&a.lines>c>>5+1){let h=this.children.slice();return h[r]=a,new st(h,this.length-(t-e)+i.length)}return super.replace(s,l,a)}s=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){let r="";for(let s=0,o=0;s<this.children.length&&o<=t;s++){let l=this.children[s],a=o+l.length;o>e&&s&&(r+=i),e<a&&t>o&&(r+=l.sliceString(e-o,t-o,i)),o=a+1}return r}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof st))return 0;let i=0,[r,s,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;r+=t,s+=t){if(r==o||s==l)return i;let a=this.children[r],c=e.children[s];if(a!=c)return i+a.scanIdentical(c,t);i+=a.length+1}}static from(e,t=e.reduce((i,r)=>i+r.length+1,-1)){let i=0;for(let d of e)i+=d.lines;if(i<32){let d=[];for(let p of e)p.flatten(d);return new ce(d,t)}let r=Math.max(32,i>>5),s=r<<1,o=r>>1,l=[],a=0,c=-1,h=[];function u(d){let p;if(d.lines>s&&d instanceof st)for(let g of d.children)u(g);else d.lines>o&&(a>o||!a)?(f(),l.push(d)):d instanceof ce&&a&&(p=h[h.length-1])instanceof ce&&d.lines+p.lines<=32?(a+=d.lines,c+=d.length+1,h[h.length-1]=new ce(p.text.concat(d.text),p.length+1+d.length)):(a+d.lines>r&&f(),a+=d.lines,c+=d.length+1,h.push(d))}function f(){a!=0&&(l.push(h.length==1?h[0]:st.from(h,c)),c=-1,a=h.length=0)}for(let d of e)u(d);return f(),l.length==1?l[0]:new st(l,t)}}U.empty=new ce([""],0);function zm(n){let e=-1;for(let t of n)e+=t.length+1;return e}function or(n,e,t=0,i=1e9){for(let r=0,s=0,o=!0;s<n.length&&r<=i;s++){let l=n[s],a=r+l.length;a>=t&&(a>i&&(l=l.slice(0,i-r)),r<t&&(l=l.slice(t-r)),o?(e[e.length-1]+=l,o=!1):e.push(l)),r=a+1}return e}function Jl(n,e,t){return or(n,[""],e,t)}class li{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof ce?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,r=this.nodes[i],s=this.offsets[i],o=s>>1,l=r instanceof ce?r.text.length:r.children.length;if(o==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((s&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(r instanceof ce){let a=r.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=r.children[o+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof ce?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class oh{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new li(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:r}=this.cursor.next(e);return this.pos+=(r.length+e)*t,this.value=r.length<=i?r:t<0?r.slice(r.length-i):r.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class lh{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:r}=this.inner.next(e);return t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=r,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(U.prototype[Symbol.iterator]=function(){return this.iter()},li.prototype[Symbol.iterator]=oh.prototype[Symbol.iterator]=lh.prototype[Symbol.iterator]=function(){return this});class Wm{constructor(e,t,i,r){this.from=e,this.to=t,this.number=i,this.text=r}get length(){return this.to-this.from}}let An="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(n=>n?parseInt(n,36):1);for(let n=1;n<An.length;n++)An[n]+=An[n-1];function jm(n){for(let e=1;e<An.length;e+=2)if(An[e]>n)return An[e-1]<=n;return!1}function Yl(n){return n>=127462&&n<=127487}const Xl=8205;function He(n,e,t=!0,i=!0){return(t?ah:Um)(n,e,i)}function ah(n,e,t){if(e==n.length)return e;e&&ch(n.charCodeAt(e))&&hh(n.charCodeAt(e-1))&&e--;let i=lr(n,e);for(e+=eo(i);e<n.length;){let r=lr(n,e);if(i==Xl||r==Xl||t&&jm(r))e+=eo(r),i=r;else if(Yl(r)){let s=0,o=e-2;for(;o>=0&&Yl(lr(n,o));)s++,o-=2;if(s%2==0)break;e+=2}else break}return e}function Um(n,e,t){for(;e>0;){let i=ah(n,e-2,t);if(i<e)return i;e--}return 0}function ch(n){return n>=56320&&n<57344}function hh(n){return n>=55296&&n<56320}function lr(n,e){let t=n.charCodeAt(e);if(!hh(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return ch(i)?(t-55296<<10)+(i-56320)+65536:t}function eo(n){return n<65536?1:2}const to=/\r\n?|\n/;var Be=function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n}(Be||(Be={}));class xt{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,r=0;t<this.sections.length;){let s=this.sections[t++],o=this.sections[t++];o<0?(e(i,r,s),r+=s):r+=o,i+=s}}iterChangedRanges(e,t=!1){no(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];r<0?e.push(i,r):e.push(r,i)}return new xt(e)}composeDesc(e){return this.empty?e:e.empty?this:uh(this,e)}mapDesc(e,t=!1){return e.empty?this:io(this,e,t)}mapPos(e,t=-1,i=Be.Simple){let r=0,s=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],c=r+l;if(a<0){if(c>e)return s+(e-r);s+=l}else{if(i!=Be.Simple&&c>=e&&(i==Be.TrackDel&&r<e&&c>e||i==Be.TrackBefore&&r<e||i==Be.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!l)return e==r||t<0?s:s+a;s+=a}r=c}if(e>r)throw new RangeError(`Position ${e} is out of range for changeset of length ${r}`);return s}touchesRange(e,t=e){for(let i=0,r=0;i<this.sections.length&&r<=t;){let s=this.sections[i++],o=this.sections[i++],l=r+s;if(o>=0&&r<=t&&l>=e)return r<e&&l>t?"cover":!0;r=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],r=this.sections[t++];e+=(e?" ":"")+i+(r>=0?":"+r:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new xt(e)}static create(e){return new xt(e)}}class ge extends xt{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return no(this,(t,i,r,s,o)=>e=e.replace(r,r+(i-t),o),!1),e}mapDesc(e,t=!1){return io(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let r=0,s=0;r<t.length;r+=2){let o=t[r],l=t[r+1];if(l>=0){t[r]=l,t[r+1]=o;let a=r>>1;for(;i.length<a;)i.push(U.empty);i.push(o?e.slice(s,s+o):U.empty)}s+=o}return new ge(t,i)}compose(e){return this.empty?e:e.empty?this:uh(this,e,!0)}map(e,t=!1){return e.empty?this:io(this,e,t,!0)}iterChanges(e,t=!1){no(this,e,t)}get desc(){return xt.create(this.sections)}filter(e){let t=[],i=[],r=[],s=new ki(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&s.len==0;){if(s.done)break e;let h=Math.min(s.len,a-l);Te(r,h,-1);let u=s.ins==-1?-1:s.off==0?s.ins:0;Te(t,h,u),u>0&&Bt(i,t,s.text),s.forward(h),l+=h}let c=e[o++];for(;l<c;){if(s.done)break e;let h=Math.min(s.len,c-l);Te(t,h,-1),Te(r,h,s.ins==-1?-1:s.off==0?s.ins:0),s.forward(h),l+=h}}return{changes:new ge(t,i),filtered:xt.create(r)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],r=this.sections[t+1];r<0?e.push(i):r==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let r=[],s=[],o=0,l=null;function a(h=!1){if(!h&&!r.length)return;o<t&&Te(r,t-o,-1);let u=new ge(r,s);l=l?l.compose(u.map(l)):u,r=[],s=[],o=0}function c(h){if(Array.isArray(h))for(let u of h)c(u);else if(h instanceof ge){if(h.length!=t)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${t})`);a(),l=l?l.compose(h.map(l)):h}else{let{from:u,to:f=u,insert:d}=h;if(u>f||u<0||f>t)throw new RangeError(`Invalid change range ${u} to ${f} (in doc of length ${t})`);let p=d?typeof d=="string"?U.of(d.split(i||to)):d:U.empty,g=p.length;if(u==f&&g==0)return;u<o&&a(),u>o&&Te(r,u-o,-1),Te(r,f-u,g),Bt(s,r,p),o=f}}return c(e),a(!l),l}static empty(e){return new ge(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let r=0;r<e.length;r++){let s=e[r];if(typeof s=="number")t.push(s,-1);else{if(!Array.isArray(s)||typeof s[0]!="number"||s.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(s.length==1)t.push(s[0],0);else{for(;i.length<r;)i.push(U.empty);i[r]=U.of(s.slice(1)),t.push(s[0],i[r].length)}}}return new ge(t,i)}static createSet(e,t){return new ge(e,t)}}function Te(n,e,t,i=!1){if(e==0&&t<=0)return;let r=n.length-2;r>=0&&t<=0&&t==n[r+1]?n[r]+=e:e==0&&n[r]==0?n[r+1]+=t:i?(n[r]+=e,n[r+1]+=t):n.push(e,t)}function Bt(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(U.empty);n.push(t)}}function no(n,e,t){let i=n.inserted;for(let r=0,s=0,o=0;o<n.sections.length;){let l=n.sections[o++],a=n.sections[o++];if(a<0)r+=l,s+=l;else{let c=r,h=s,u=U.empty;for(;c+=l,h+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==n.sections.length||n.sections[o+1]<0);)l=n.sections[o++],a=n.sections[o++];e(r,c,s,h,u),r=c,s=h}}}function io(n,e,t,i=!1){let r=[],s=i?[]:null,o=new ki(n),l=new ki(e);for(let a=-1;;)if(o.ins==-1&&l.ins==-1){let c=Math.min(o.len,l.len);Te(r,c,-1),o.forward(c),l.forward(c)}else if(l.ins>=0&&(o.ins<0||a==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!t))){let c=l.len;for(Te(r,l.ins,-1);c;){let h=Math.min(o.len,c);o.ins>=0&&a<o.i&&o.len<=h&&(Te(r,0,o.ins),s&&Bt(s,r,o.text),a=o.i),o.forward(h),c-=h}l.next()}else if(o.ins>=0){let c=0,h=o.len;for(;h;)if(l.ins==-1){let u=Math.min(h,l.len);c+=u,h-=u,l.forward(u)}else if(l.ins==0&&l.len<h)h-=l.len,l.next();else break;Te(r,c,a<o.i?o.ins:0),s&&a<o.i&&Bt(s,r,o.text),a=o.i,o.forward(o.len-h)}else{if(o.done&&l.done)return s?ge.createSet(r,s):xt.create(r);throw new Error("Mismatched change set lengths")}}function uh(n,e,t=!1){let i=[],r=t?[]:null,s=new ki(n),o=new ki(e);for(let l=!1;;){if(s.done&&o.done)return r?ge.createSet(i,r):xt.create(i);if(s.ins==0)Te(i,s.len,0,l),s.next();else if(o.len==0&&!o.done)Te(i,0,o.ins,l),r&&Bt(r,i,o.text),o.next();else{if(s.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(s.len2,o.len),c=i.length;if(s.ins==-1){let h=o.ins==-1?-1:o.off?0:o.ins;Te(i,a,h,l),r&&h&&Bt(r,i,o.text)}else o.ins==-1?(Te(i,s.off?0:s.len,a,l),r&&Bt(r,i,s.textBit(a))):(Te(i,s.off?0:s.len,o.off?0:o.ins,l),r&&!o.off&&Bt(r,i,o.text));l=(s.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>c),s.forward2(a),o.forward(a)}}}}class ki{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?U.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?U.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class en{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,t=-1){let i,r;return this.empty?i=r=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),r=e.mapPos(this.to,-1)),i==this.from&&r==this.to?this:new en(i,r,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return x.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return x.range(this.anchor,i)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return x.range(e.anchor,e.head)}static create(e,t,i){return new en(e,t,i)}}class x{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:x.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new x([this.main],0)}addRange(e,t=!0){return x.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,x.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new x(e.ranges.map(t=>en.fromJSON(t)),e.main)}static single(e,t=e){return new x([x.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,r=0;r<e.length;r++){let s=e[r];if(s.empty?s.from<=i:s.from<i)return x.normalized(e.slice(),t);i=s.to}return new x(e,t)}static cursor(e,t=0,i,r){return en.create(e,e,(t==0?0:t<0?4:8)|(i==null?3:Math.min(2,i))|(r??33554431)<<5)}static range(e,t,i,r){let s=(i??33554431)<<5|(r==null?3:Math.min(2,r));return t<e?en.create(t,e,24|s):en.create(e,t,(t>e?4:0)|s)}static normalized(e,t=0){let i=e[t];e.sort((r,s)=>r.from-s.from),t=e.indexOf(i);for(let r=1;r<e.length;r++){let s=e[r],o=e[r-1];if(s.empty?s.from<=o.to:s.from<o.to){let l=o.from,a=Math.max(s.to,o.to);r<=t&&t--,e.splice(--r,2,s.anchor>s.head?x.range(a,l):x.range(l,a))}}return new x(e,t)}}function fh(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let Xo=0;class P{constructor(e,t,i,r,s){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=r,this.id=Xo++,this.default=e([]),this.extensions=typeof s=="function"?s(this):s}static define(e={}){return new P(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:Qo),!!e.static,e.enables)}of(e){return new ar([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ar(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ar(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function Qo(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class ar{constructor(e,t,i,r){this.dependencies=e,this.facet=t,this.type=i,this.value=r,this.id=Xo++}dynamicSlot(e){var t;let i=this.value,r=this.facet.compareInput,s=this.id,o=e[s]>>1,l=this.type==2,a=!1,c=!1,h=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?c=!0:((t=e[u.id])!==null&&t!==void 0?t:1)&1||h.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,f){if(a&&f.docChanged||c&&(f.docChanged||f.selection)||ro(u,h)){let d=i(u);if(l?!Ql(d,u.values[o],r):!r(d,u.values[o]))return u.values[o]=d,1}return 0},reconfigure:(u,f)=>{let d,p=f.config.address[s];if(p!=null){let g=Rr(f,p);if(this.dependencies.every(y=>y instanceof P?f.facet(y)===u.facet(y):y instanceof Mt?f.field(y,!1)==u.field(y,!1):!0)||(l?Ql(d=i(u),g,r):r(d=i(u),g)))return u.values[o]=g,0}else d=i(u);return u.values[o]=d,1}}}}function Ql(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function ro(n,e){let t=!1;for(let i of e)ai(n,i)&1&&(t=!0);return t}function Zm(n,e,t){let i=t.map(a=>n[a.id]),r=t.map(a=>a.type),s=i.filter(a=>!(a&1)),o=n[e.id]>>1;function l(a){let c=[];for(let h=0;h<i.length;h++){let u=Rr(a,i[h]);if(r[h]==2)for(let f of u)c.push(f);else c.push(u)}return e.combine(c)}return{create(a){for(let c of i)ai(a,c);return a.values[o]=l(a),1},update(a,c){if(!ro(a,s))return 0;let h=l(a);return e.compare(h,a.values[o])?0:(a.values[o]=h,1)},reconfigure(a,c){let h=ro(a,i),u=c.config.facets[e.id],f=c.facet(e);if(u&&!h&&Qo(t,u))return a.values[o]=f,0;let d=l(a);return e.compare(d,f)?(a.values[o]=f,0):(a.values[o]=d,1)}}}const ea=P.define({static:!0});class Mt{constructor(e,t,i,r,s){this.id=e,this.createF=t,this.updateF=i,this.compareF=r,this.spec=s,this.provides=void 0}static define(e){let t=new Mt(Xo++,e.create,e.update,e.compare||((i,r)=>i===r),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(ea).find(i=>i.field==this);return(t?.create||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,r)=>{let s=i.values[t],o=this.updateF(s,r);return this.compareF(s,o)?0:(i.values[t]=o,1)},reconfigure:(i,r)=>r.config.address[this.id]!=null?(i.values[t]=r.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,ea.of({field:this,create:e})]}get extension(){return this}}const Xt={lowest:4,low:3,default:2,high:1,highest:0};function qn(n){return e=>new dh(e,n)}const el={highest:qn(Xt.highest),high:qn(Xt.high),default:qn(Xt.default),low:qn(Xt.low),lowest:qn(Xt.lowest)};class dh{constructor(e,t){this.inner=e,this.prec=t}}class os{of(e){return new so(this,e)}reconfigure(e){return os.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class so{constructor(e,t){this.compartment=e,this.inner=t}}class Ir{constructor(e,t,i,r,s,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=r,this.staticValues=s,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let r=[],s=Object.create(null),o=new Map;for(let f of qm(e,t,o))f instanceof Mt?r.push(f):(s[f.facet.id]||(s[f.facet.id]=[])).push(f);let l=Object.create(null),a=[],c=[];for(let f of r)l[f.id]=c.length<<1,c.push(d=>f.slot(d));let h=i?.config.facets;for(let f in s){let d=s[f],p=d[0].facet,g=h&&h[f]||[];if(d.every(y=>y.type==0))if(l[p.id]=a.length<<1|1,Qo(g,d))a.push(i.facet(p));else{let y=p.combine(d.map(b=>b.value));a.push(i&&p.compare(y,i.facet(p))?i.facet(p):y)}else{for(let y of d)y.type==0?(l[y.id]=a.length<<1|1,a.push(y.value)):(l[y.id]=c.length<<1,c.push(b=>y.dynamicSlot(b)));l[p.id]=c.length<<1,c.push(y=>Zm(y,p,d))}}let u=c.map(f=>f(l));return new Ir(e,o,u,l,a,s)}}function qm(n,e,t){let i=[[],[],[],[],[]],r=new Map;function s(o,l){let a=r.get(o);if(a!=null){if(a<=l)return;let c=i[a].indexOf(o);c>-1&&i[a].splice(c,1),o instanceof so&&t.delete(o.compartment)}if(r.set(o,l),Array.isArray(o))for(let c of o)s(c,l);else if(o instanceof so){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(o.compartment)||o.inner;t.set(o.compartment,c),s(c,l)}else if(o instanceof dh)s(o.inner,o.prec);else if(o instanceof Mt)i[l].push(o),o.provides&&s(o.provides,l);else if(o instanceof ar)i[l].push(o),o.facet.extensions&&s(o.facet.extensions,Xt.default);else{let c=o.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);s(c,l)}}return s(n,Xt.default),i.reduce((o,l)=>o.concat(l))}function ai(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let r=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|r}function Rr(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const ph=P.define(),mh=P.define({combine:n=>n.some(e=>e),static:!0}),gh=P.define({combine:n=>n.length?n[0]:void 0,static:!0}),yh=P.define(),bh=P.define(),wh=P.define(),vh=P.define({combine:n=>n.length?n[0]:!1});class zn{constructor(e,t){this.type=e,this.value=t}static define(){return new Km}}class Km{of(e){return new zn(this,e)}}class Gm{constructor(e){this.map=e}of(e){return new te(this,e)}}class te{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new te(this.type,t)}is(e){return this.type==e}static define(e={}){return new Gm(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let r of e){let s=r.map(t);s&&i.push(s)}return i}}te.reconfigure=te.define();te.appendConfig=te.define();class Ae{constructor(e,t,i,r,s,o){this.startState=e,this.changes=t,this.selection=i,this.effects=r,this.annotations=s,this.scrollIntoView=o,this._doc=null,this._state=null,i&&fh(i,t.newLength),s.some(l=>l.type==Ae.time)||(this.annotations=s.concat(Ae.time.of(Date.now())))}static create(e,t,i,r,s,o){return new Ae(e,t,i,r,s,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Ae.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Ae.time=zn.define();Ae.userEvent=zn.define();Ae.addToHistory=zn.define();Ae.remote=zn.define();function Jm(n,e){let t=[];for(let i=0,r=0;;){let s,o;if(i<n.length&&(r==e.length||e[r]>=n[i]))s=n[i++],o=n[i++];else if(r<e.length)s=e[r++],o=e[r++];else return t;!t.length||t[t.length-1]<s?t.push(s,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function kh(n,e,t){var i;let r,s,o;return t?(r=e.changes,s=ge.empty(e.changes.length),o=n.changes.compose(e.changes)):(r=e.changes.map(n.changes),s=n.changes.mapDesc(e.changes,!0),o=n.changes.compose(r)),{changes:o,selection:e.selection?e.selection.map(s):(i=n.selection)===null||i===void 0?void 0:i.map(r),effects:te.mapEffects(n.effects,r).concat(te.mapEffects(e.effects,s)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function oo(n,e,t){let i=e.selection,r=Cn(e.annotations);return e.userEvent&&(r=r.concat(Ae.userEvent.of(e.userEvent))),{changes:e.changes instanceof ge?e.changes:ge.of(e.changes||[],t,n.facet(gh)),selection:i&&(i instanceof x?i:x.single(i.anchor,i.head)),effects:Cn(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function xh(n,e,t){let i=oo(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let s=1;s<e.length;s++){e[s].filter===!1&&(t=!1);let o=!!e[s].sequential;i=kh(i,oo(n,e[s],o?i.changes.newLength:n.doc.length),o)}let r=Ae.create(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Xm(t?Ym(r):r)}function Ym(n){let e=n.startState,t=!0;for(let r of e.facet(yh)){let s=r(n);if(s===!1){t=!1;break}Array.isArray(s)&&(t=t===!0?s:Jm(t,s))}if(t!==!0){let r,s;if(t===!1)s=n.changes.invertedDesc,r=ge.empty(e.doc.length);else{let o=n.changes.filter(t);r=o.changes,s=o.filtered.mapDesc(o.changes).invertedDesc}n=Ae.create(e,r,n.selection&&n.selection.map(s),te.mapEffects(n.effects,s),n.annotations,n.scrollIntoView)}let i=e.facet(bh);for(let r=i.length-1;r>=0;r--){let s=i[r](n);s instanceof Ae?n=s:Array.isArray(s)&&s.length==1&&s[0]instanceof Ae?n=s[0]:n=xh(e,Cn(s),!1)}return n}function Xm(n){let e=n.startState,t=e.facet(wh),i=n;for(let r=t.length-1;r>=0;r--){let s=t[r](n);s&&Object.keys(s).length&&(i=kh(i,oo(e,s,n.changes.newLength),!0))}return i==n?n:Ae.create(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const Qm=[];function Cn(n){return n==null?Qm:Array.isArray(n)?n:[n]}var wt=function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n}(wt||(wt={}));const eg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let lo;try{lo=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function tg(n){if(lo)return lo.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||eg.test(t)))return!0}return!1}function ng(n){return e=>{if(!/\S/.test(e))return wt.Space;if(tg(e))return wt.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return wt.Word;return wt.Other}}class Z{constructor(e,t,i,r,s,o){this.config=e,this.doc=t,this.selection=i,this.values=r,this.status=e.statusTemplate.slice(),this.computeSlot=s,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)ai(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return ai(this,i),Rr(this,i)}update(...e){return xh(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:r}=t;for(let o of e.effects)o.is(os.reconfigure)?(t&&(r=new Map,t.compartments.forEach((l,a)=>r.set(a,l)),t=null),r.set(o.value.compartment,o.value.extension)):o.is(te.reconfigure)?(t=null,i=o.value):o.is(te.appendConfig)&&(t=null,i=Cn(i).concat(o.value));let s;t?s=e.startState.values.slice():(t=Ir.resolve(i,r,this),s=new Z(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,a)=>a.reconfigure(l,this),null).values),new Z(t,e.newDoc,e.newSelection,s,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:x.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),r=this.changes(i.changes),s=[i.range],o=Cn(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),c=this.changes(a.changes),h=c.map(r);for(let f=0;f<l;f++)s[f]=s[f].map(h);let u=r.mapDesc(c,!0);s.push(a.range.map(u)),r=r.compose(h),o=te.mapEffects(o,h).concat(te.mapEffects(Cn(a.effects),u))}return{changes:r,selection:x.create(s,t.mainIndex),effects:o}}changes(e=[]){return e instanceof ge?e:ge.of(e,this.doc.length,this.facet(Z.lineSeparator))}toText(e){return U.of(e.split(this.facet(Z.lineSeparator)||to))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(ai(this,t),Rr(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let r=e[i];r instanceof Mt&&this.config.address[r.id]!=null&&(t[i]=r.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let r=[];if(i){for(let s in i)if(Object.prototype.hasOwnProperty.call(e,s)){let o=i[s],l=e[s];r.push(o.init(a=>o.spec.fromJSON(l,a)))}}return Z.create({doc:e.doc,selection:x.fromJSON(e.selection),extensions:t.extensions?r.concat([t.extensions]):r})}static create(e={}){let t=Ir.resolve(e.extensions||[],new Map),i=e.doc instanceof U?e.doc:U.of((e.doc||"").split(t.staticFacet(Z.lineSeparator)||to)),r=e.selection?e.selection instanceof x?e.selection:x.single(e.selection.anchor,e.selection.head):x.single(0);return fh(r,i.length),t.staticFacet(mh)||(r=r.asSingle()),new Z(t,i,r,t.dynamicSlots.map(()=>null),(s,o)=>o.create(s),null)}get tabSize(){return this.facet(Z.tabSize)}get lineBreak(){return this.facet(Z.lineSeparator)||`
`}get readOnly(){return this.facet(vh)}phrase(e,...t){for(let i of this.facet(Z.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(i,r)=>{if(r=="$")return"$";let s=+(r||1);return!s||s>t.length?i:t[s-1]})),e}languageDataAt(e,t,i=-1){let r=[];for(let s of this.facet(ph))for(let o of s(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&r.push(o[e]);return r}charCategorizer(e){return ng(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:r}=this.doc.lineAt(e),s=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=He(t,o,!1);if(s(t.slice(a,o))!=wt.Word)break;o=a}for(;l<r;){let a=He(t,l);if(s(t.slice(l,a))!=wt.Word)break;l=a}return o==l?null:x.range(o+i,l+i)}}Z.allowMultipleSelections=mh;Z.tabSize=P.define({combine:n=>n.length?n[0]:4});Z.lineSeparator=gh;Z.readOnly=vh;Z.phrases=P.define({compare(n,e){let t=Object.keys(n),i=Object.keys(e);return t.length==i.length&&t.every(r=>n[r]==e[r])}});Z.languageData=ph;Z.changeFilter=yh;Z.transactionFilter=bh;Z.transactionExtender=wh;os.reconfigure=te.define();function ig(n,e,t={}){let i={};for(let r of n)for(let s of Object.keys(r)){let o=r[s],l=i[s];if(l===void 0)i[s]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,s))i[s]=t[s](l,o);else throw new Error("Config merge conflict for field "+s)}for(let r in e)i[r]===void 0&&(i[r]=e[r]);return i}class Pn{eq(e){return this==e}range(e,t=e){return ao.create(e,t,this)}}Pn.prototype.startSide=Pn.prototype.endSide=0;Pn.prototype.point=!1;Pn.prototype.mapMode=Be.TrackDel;let ao=class Sh{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Sh(e,t,i)}};function co(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class tl{constructor(e,t,i,r){this.from=e,this.to=t,this.value=i,this.maxPoint=r}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,r=0){let s=i?this.to:this.from;for(let o=r,l=s.length;;){if(o==l)return o;let a=o+l>>1,c=s[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==o)return c>=0?o:l;c>=0?l=a:o=a+1}}between(e,t,i,r){for(let s=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,s);s<o;s++)if(r(this.from[s]+e,this.to[s]+e,this.value[s])===!1)return!1}map(e,t){let i=[],r=[],s=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let c=this.value[a],h=this.from[a]+e,u=this.to[a]+e,f,d;if(h==u){let p=t.mapPos(h,c.startSide,c.mapMode);if(p==null||(f=d=p,c.startSide!=c.endSide&&(d=t.mapPos(h,c.endSide),d<f)))continue}else if(f=t.mapPos(h,c.startSide),d=t.mapPos(u,c.endSide),f>d||f==d&&c.startSide>0&&c.endSide<=0)continue;(d-f||c.endSide-c.startSide)<0||(o<0&&(o=f),c.point&&(l=Math.max(l,d-f)),i.push(c),r.push(f-o),s.push(d-o))}return{mapped:i.length?new tl(r,s,i,l):null,pos:o}}}class le{constructor(e,t,i,r){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=r}static create(e,t,i,r){return new le(e,t,i,r)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:r=0,filterTo:s=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(i&&(t=t.slice().sort(co)),this.isEmpty)return t.length?le.of(t):this;let l=new Th(this,null,-1).goto(0),a=0,c=[],h=new xi;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let u=t[a++];h.addInner(u.from,u.to,u.value)||c.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!o||r>this.chunkEnd(l.chunkIndex)||s<this.chunkPos[l.chunkIndex])&&h.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||r>l.to||s<l.from||o(l.from,l.to,l.value))&&(h.addInner(l.from,l.to,l.value)||c.push(ao.create(l.from,l.to,l.value))),l.next());return h.finishInner(this.nextLayer.isEmpty&&!c.length?le.empty:this.nextLayer.update({add:c,filter:o,filterFrom:r,filterTo:s}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],r=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],c=e.touchesRange(l,l+a.length);if(c===!1)r=Math.max(r,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(c===!0){let{mapped:h,pos:u}=a.map(l,e);h&&(r=Math.max(r,h.maxPoint),t.push(h),i.push(u))}}let s=this.nextLayer.map(e);return t.length==0?s:new le(i,t,s||le.empty,r)}between(e,t,i){if(!this.isEmpty){for(let r=0;r<this.chunk.length;r++){let s=this.chunkPos[r],o=this.chunk[r];if(t>=s&&e<=s+o.length&&o.between(s,e-s,t-s,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return Si.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Si.from(e).goto(t)}static compare(e,t,i,r,s=-1){let o=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),l=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=s),a=ta(o,l,i),c=new Kn(o,a,s),h=new Kn(l,a,s);i.iterGaps((u,f,d)=>na(c,u,h,f,d,r)),i.empty&&i.length==0&&na(c,0,h,0,0,r)}static eq(e,t,i=0,r){r==null&&(r=1e9-1);let s=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0),o=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(s.length!=o.length)return!1;if(!s.length)return!0;let l=ta(s,o),a=new Kn(s,l,0).goto(i),c=new Kn(o,l,0).goto(i);for(;;){if(a.to!=c.to||!ho(a.active,c.active)||a.point&&(!c.point||!a.point.eq(c.point)))return!1;if(a.to>r)return!0;a.next(),c.next()}}static spans(e,t,i,r,s=-1){let o=new Kn(e,null,s).goto(t),l=t,a=o.openStart;for(;;){let c=Math.min(o.to,i);if(o.point){let h=o.activeForPoint(o.to),u=o.pointFrom<t?h.length+1:Math.min(h.length,a);r.point(l,c,o.point,h,u,o.pointRank),a=Math.min(o.openEnd(c),h.length)}else c>l&&(r.span(l,c,o.active,a),a=o.openEnd(c));if(o.to>i)return a+(o.point&&o.to>i?1:0);l=o.to,o.next()}}static of(e,t=!1){let i=new xi;for(let r of e instanceof ao?[e]:t?rg(e):e)i.add(r.from,r.to,r.value);return i.finish()}}le.empty=new le([],[],null,-1);function rg(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(co(e,i)>0)return n.slice().sort(co);e=i}return n}le.empty.nextLayer=le.empty;class xi{finishChunk(e){this.chunks.push(new tl(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new xi)).add(e,t,i)}addInner(e,t,i){let r=e-this.lastTo||i.startSide-this.last.endSide;if(r<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return r<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(le.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=le.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function ta(n,e,t){let i=new Map;for(let s of n)for(let o=0;o<s.chunk.length;o++)s.chunk[o].maxPoint<=0&&i.set(s.chunk[o],s.chunkPos[o]);let r=new Set;for(let s of e)for(let o=0;o<s.chunk.length;o++){let l=i.get(s.chunk[o]);l!=null&&(t?t.mapPos(l):l)==s.chunkPos[o]&&!t?.touchesRange(l,l+s.chunk[o].length)&&r.add(s.chunk[o])}return r}class Th{constructor(e,t,i,r=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=r}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let r=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(r)||this.layer.chunkEnd(this.chunkIndex)<e||r.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let r=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<r)&&this.setRangeIndex(r)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Si{constructor(e){this.heap=e}static from(e,t=null,i=-1){let r=[];for(let s=0;s<e.length;s++)for(let o=e[s];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&r.push(new Th(o,t,i,s));return r.length==1?r[0]:new Si(r)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)Cs(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)Cs(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Cs(this.heap,0)}}}function Cs(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let r=n[i];if(i+1<n.length&&r.compare(n[i+1])>=0&&(r=n[i+1],i++),t.compare(r)<0)break;n[i]=t,n[e]=r,e=i}}class Kn{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Si.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){Vi(this.active,e),Vi(this.activeTo,e),Vi(this.activeRank,e),this.minActive=ia(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:r,rank:s}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=s;)t++;Fi(this.active,t,i),Fi(this.activeTo,t,r),Fi(this.activeRank,t,s),e&&Fi(e,t,this.cursor.from),this.minActive=ia(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let r=this.minActive;if(r>-1&&(this.activeTo[r]-this.cursor.from||this.active[r].endSide-this.cursor.startSide)<0){if(this.activeTo[r]>e){this.to=this.activeTo[r],this.endSide=this.active[r].endSide;break}this.removeActive(r),i&&Vi(i,r)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let s=this.cursor.value;if(!s.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=s,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=s.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let r=i.length-1;r>=0&&i[r]<e;r--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function na(n,e,t,i,r,s){n.goto(e),t.goto(i);let o=i+r,l=i,a=i-e;for(;;){let c=n.to+a-t.to||n.endSide-t.endSide,h=c<0?n.to+a:t.to,u=Math.min(h,o);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&ho(n.activeForPoint(n.to),t.activeForPoint(t.to))||s.comparePoint(l,u,n.point,t.point):u>l&&!ho(n.active,t.active)&&s.compareRange(l,u,n.active,t.active),h>o)break;l=h,c<=0&&n.next(),c>=0&&t.next()}}function ho(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function Vi(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function Fi(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function ia(n,e){let t=-1,i=1e9;for(let r=0;r<e.length;r++)(e[r]-i||n[r].endSide-n[t].endSide)<0&&(t=r,i=e[r]);return t}function nl(n,e,t=n.length){let i=0;for(let r=0;r<t;)n.charCodeAt(r)==9?(i+=e-i%e,r++):(i++,r=He(n,r));return i}function sg(n,e,t,i){for(let r=0,s=0;;){if(s>=e)return r;if(r==n.length)break;s+=n.charCodeAt(r)==9?t-s%t:1,r=He(n,r)}return i===!0?-1:n.length}const uo="",ra=typeof Symbol>"u"?"__"+uo:Symbol.for(uo),fo=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),sa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Ht{constructor(e,t){this.rules=[];let{finish:i}=t||{};function r(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function s(o,l,a,c){let h=[],u=/^@(\w+)\b/.exec(o[0]),f=u&&u[1]=="keyframes";if(u&&l==null)return a.push(o[0]+";");for(let d in l){let p=l[d];if(/&/.test(d))s(d.split(/,\s*/).map(g=>o.map(y=>g.replace(/&/,y))).reduce((g,y)=>g.concat(y)),p,a);else if(p&&typeof p=="object"){if(!u)throw new RangeError("The value of a property ("+d+") should be a primitive value.");s(r(d),p,h,f)}else p!=null&&h.push(d.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+p+";")}(h.length||f)&&a.push((i&&!u&&!c?o.map(i):o).join(", ")+" {"+h.join(" ")+"}")}for(let o in e)s(r(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=sa[ra]||1;return sa[ra]=e+1,uo+e.toString(36)}static mount(e,t){(e[fo]||new og(e)).mount(Array.isArray(t)?t:[t])}}let oa=new Map;class og{constructor(e){let t=e.ownerDocument||e,i=t.defaultView;if(!e.head&&e.adoptedStyleSheets&&i.CSSStyleSheet){let r=oa.get(t);if(r)return e.adoptedStyleSheets=[r.sheet,...e.adoptedStyleSheets],e[fo]=r;this.sheet=new i.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],oa.set(t,this)}else{this.styleTag=t.createElement("style");let r=e.head||e;r.insertBefore(this.styleTag,r.firstChild)}this.modules=[],e[fo]=this}mount(e){let t=this.sheet,i=0,r=0;for(let s=0;s<e.length;s++){let o=e[s],l=this.modules.indexOf(o);if(l<r&&l>-1&&(this.modules.splice(l,1),r--,l=-1),l==-1){if(this.modules.splice(r++,0,o),t)for(let a=0;a<o.rules.length;a++)t.insertRule(o.rules[a],i++)}else{for(;r<l;)i+=this.modules[r++].rules.length;i+=o.rules.length,r++}}if(!t){let s="";for(let o=0;o<this.modules.length;o++)s+=this.modules[o].getRules()+`
`;this.styleTag.textContent=s}}}var zt={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ti={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},lg=typeof navigator<"u"&&/Mac/.test(navigator.platform),ag=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ve=0;ve<10;ve++)zt[48+ve]=zt[96+ve]=String(ve);for(var ve=1;ve<=24;ve++)zt[ve+111]="F"+ve;for(var ve=65;ve<=90;ve++)zt[ve]=String.fromCharCode(ve+32),Ti[ve]=String.fromCharCode(ve);for(var Ms in zt)Ti.hasOwnProperty(Ms)||(Ti[Ms]=zt[Ms]);function cg(n){var e=lg&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||ag&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?Ti:zt)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function $r(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function Ln(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function hg(n){let e=n.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function cr(n,e){if(!e.anchorNode)return!1;try{return Ln(n,e.anchorNode)}catch{return!1}}function Ai(n){return n.nodeType==3?Bn(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Vr(n,e,t,i){return t?la(n,e,t,i,-1)||la(n,e,t,i,1):!1}function Fr(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function la(n,e,t,i,r){for(;;){if(n==t&&e==i)return!0;if(e==(r<0?0:Wt(n))){if(n.nodeName=="DIV")return!1;let s=n.parentNode;if(!s||s.nodeType!=1)return!1;e=Fr(n)+(r<0?0:1),n=s}else if(n.nodeType==1){if(n=n.childNodes[e+(r<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=r<0?Wt(n):0}else return!1}}function Wt(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function il(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function ug(n){return{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function fg(n,e,t,i,r,s,o,l){let a=n.ownerDocument,c=a.defaultView||window;for(let h=n;h;)if(h.nodeType==1){let u,f=h==a.body;if(f)u=ug(c);else{if(h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let g=h.getBoundingClientRect();u={left:g.left,right:g.left+h.clientWidth,top:g.top,bottom:g.top+h.clientHeight}}let d=0,p=0;if(r=="nearest")e.top<u.top?(p=-(u.top-e.top+o),t>0&&e.bottom>u.bottom+p&&(p=e.bottom-u.bottom+p+o)):e.bottom>u.bottom&&(p=e.bottom-u.bottom+o,t<0&&e.top-p<u.top&&(p=-(u.top+p-e.top+o)));else{let g=e.bottom-e.top,y=u.bottom-u.top;p=(r=="center"&&g<=y?e.top+g/2-y/2:r=="start"||r=="center"&&t<0?e.top-o:e.bottom-y+o)-u.top}if(i=="nearest"?e.left<u.left?(d=-(u.left-e.left+s),t>0&&e.right>u.right+d&&(d=e.right-u.right+d+s)):e.right>u.right&&(d=e.right-u.right+s,t<0&&e.left<u.left+d&&(d=-(u.left+d-e.left+s))):d=(i=="center"?e.left+(e.right-e.left)/2-(u.right-u.left)/2:i=="start"==l?e.left-s:e.right-(u.right-u.left)+s)-u.left,d||p)if(f)c.scrollBy(d,p);else{let g=0,y=0;if(p){let b=h.scrollTop;h.scrollTop+=p,y=h.scrollTop-b}if(d){let b=h.scrollLeft;h.scrollLeft+=d,g=h.scrollLeft-b}e={left:e.left-g,top:e.top-y,right:e.right-g,bottom:e.bottom-y},g&&Math.abs(g-d)<1&&(i="nearest"),y&&Math.abs(y-p)<1&&(r="nearest")}if(f)break;h=h.assignedSlot||h.parentNode}else if(h.nodeType==11)h=h.host;else break}function dg(n){let e=n.ownerDocument;for(let t=n.parentNode;t&&t!=e.body;)if(t.nodeType==1){if(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)return t;t=t.assignedSlot||t.parentNode}else if(t.nodeType==11)t=t.host;else break;return null}class pg{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?Wt(t):0),i,Math.min(e.focusOffset,i?Wt(i):0))}set(e,t,i,r){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=r}}let wn=null;function Ah(n){if(n.setActive)return n.setActive();if(wn)return n.focus(wn);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(wn==null?{get preventScroll(){return wn={preventScroll:!0},!0}}:void 0),!wn){wn=!1;for(let t=0;t<e.length;){let i=e[t++],r=e[t++],s=e[t++];i.scrollTop!=r&&(i.scrollTop=r),i.scrollLeft!=s&&(i.scrollLeft=s)}}}let aa;function Bn(n,e,t=e){let i=aa||(aa=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function Mn(n,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},r=new KeyboardEvent("keydown",i);r.synthetic=!0,n.dispatchEvent(r);let s=new KeyboardEvent("keyup",i);return s.synthetic=!0,n.dispatchEvent(s),r.defaultPrevented||s.defaultPrevented}function mg(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function Ch(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function gg(n,e){let t=e.focusNode,i=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=i)return!1;for(i=Math.min(i,Wt(t));;)if(i){if(t.nodeType!=1)return!1;let r=t.childNodes[i-1];r.contentEditable=="false"?i--:(t=r,i=Wt(t))}else{if(t==n)return!0;i=Fr(t),t=t.parentNode}}function Mh(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}class xe{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new xe(e.parentNode,Fr(e),t)}static after(e,t){return new xe(e.parentNode,Fr(e)+1,t)}}const rl=[];class J{constructor(){this.parent=null,this.dom=null,this.dirty=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.dirty&2){let i=this.dom,r=null,s;for(let o of this.children){if(o.dirty){if(!o.dom&&(s=r?r.nextSibling:i.firstChild)&&s!=e.docView.compositionNode){let l=J.get(s);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(s)}o.sync(e,t),o.dirty=0}if(s=r?r.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&s!=o.dom&&(t.written=!0),o.dom.parentNode==i)for(;s&&s!=o.dom;)s=ca(s);else i.insertBefore(o.dom,s);r=o.dom}for(s=r?r.nextSibling:i.firstChild,s&&t&&t.node==i&&(t.written=!0);s;)s=ca(s)}else if(this.dirty&1)for(let i of this.children)i.dirty&&(i.sync(e,t),i.dirty=0)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let r=Wt(e)==0?0:t==0?-1:1;for(;;){let s=e.parentNode;if(s==this.dom)break;r==0&&s.firstChild!=s.lastChild&&(e==s.firstChild?r=-1:r=1),e=s}r<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!J.get(i);)i=i.nextSibling;if(!i)return this.length;for(let r=0,s=0;;r++){let o=this.children[r];if(o.dom==i)return s;s+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let r=-1,s=-1,o=-1,l=-1;for(let a=0,c=i,h=i;a<this.children.length;a++){let u=this.children[a],f=c+u.length;if(c<e&&f>t)return u.domBoundsAround(e,t,c);if(f>=e&&r==-1&&(r=a,s=c),c>t&&u.dom.parentNode==this.dom){o=a,l=h;break}h=f,c=f+u.breakAfter}return{from:s,to:l<0?i+this.length:l,startDOM:(r?this.children[r-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.dirty|=2),t.dirty&1)return;t.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=rl){this.markDirty();for(let r=e;r<t;r++){let s=this.children[r];s.parent==this&&s.destroy()}this.children.splice(e,t-e,...i);for(let r=0;r<i.length;r++)i[r].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Oh(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,r,s,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}J.prototype.breakAfter=0;function ca(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class Oh{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Nh(n,e,t,i,r,s,o,l,a){let{children:c}=n,h=c.length?c[e]:null,u=s.length?s[s.length-1]:null,f=u?u.breakAfter:o;if(!(e==i&&h&&!o&&!f&&s.length<2&&h.merge(t,r,s.length?u:null,t==0,l,a))){if(i<c.length){let d=c[i];d&&r<d.length?(e==i&&(d=d.split(r),r=0),!f&&u&&d.merge(0,r,u,!0,0,a)?s[s.length-1]=d:(r&&d.merge(0,r,null,!1,0,a),s.push(d))):d?.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(h&&(h.breakAfter=o,t>0&&(!o&&s.length&&h.merge(t,h.length,s[0],!1,l,0)?h.breakAfter=s.shift().breakAfter:(t<h.length||h.children.length&&h.children[h.children.length-1].length==0)&&h.merge(t,h.length,null,!1,l,0),e++));e<i&&s.length;)if(c[i-1].become(s[s.length-1]))i--,s.pop(),a=s.length?0:l;else if(c[e].become(s[0]))e++,s.shift(),l=s.length?0:a;else break;!s.length&&e&&i<c.length&&!c[e-1].breakAfter&&c[i].merge(0,0,c[e-1],!1,l,a)&&e--,(e<i||s.length)&&n.replaceChildren(e,i,s)}}function Eh(n,e,t,i,r,s){let o=n.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:c,off:h}=o.findPos(e,-1),u=e-t;for(let f of i)u+=f.length;n.length+=u,Nh(n,c,h,l,a,i,0,r,s)}let Fe=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},po=typeof document<"u"?document:{documentElement:{style:{}}};const mo=/Edge\/(\d+)/.exec(Fe.userAgent),Dh=/MSIE \d/.test(Fe.userAgent),go=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Fe.userAgent),ls=!!(Dh||go||mo),ha=!ls&&/gecko\/(\d+)/i.test(Fe.userAgent),Os=!ls&&/Chrome\/(\d+)/.exec(Fe.userAgent),ua="webkitFontSmoothing"in po.documentElement.style,_h=!ls&&/Apple Computer/.test(Fe.vendor),fa=_h&&(/Mobile\/\w+/.test(Fe.userAgent)||Fe.maxTouchPoints>2);var M={mac:fa||/Mac/.test(Fe.platform),windows:/Win/.test(Fe.platform),linux:/Linux|X11/.test(Fe.platform),ie:ls,ie_version:Dh?po.documentMode||6:go?+go[1]:mo?+mo[1]:0,gecko:ha,gecko_version:ha?+(/Firefox\/(\d+)/.exec(Fe.userAgent)||[0,0])[1]:0,chrome:!!Os,chrome_version:Os?+Os[1]:0,ios:fa,android:/Android\b/.test(Fe.userAgent),webkit:ua,safari:_h,webkit_version:ua?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:po.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const yg=256;class fn extends J{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return i&&(!(i instanceof fn)||this.length-(t-e)+i.length>yg)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new fn(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new xe(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return yo(this.dom,e,t)}}class Ct extends J{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let r of t)r.setParent(this)}setAttrs(e){if(Ch(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e,t){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,r,s,o){return i&&(!(i instanceof Ct&&i.mark.eq(this.mark))||e&&s<=0||t<this.length&&o<=0)?!1:(Eh(this,e,t,i?i.children:[],s-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,r=-1,s=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),r<0&&i>=e&&(r=s),i=a,s++}let o=this.length-e;return this.length=e,r>-1&&(this.children.length=r,this.markDirty()),new Ct(this.mark,t,o)}domAtPos(e){return Rh(this,e)}coordsAt(e,t){return Vh(this,e,t)}}function yo(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let r=e,s=e,o=0;e==0&&t<0||e==i&&t>=0?M.chrome||M.gecko||(e?(r--,o=1):s<i&&(s++,o=-1)):t<0?r--:s<i&&s++;let l=Bn(n,r,s).getClientRects();if(!l.length)return null;let a=l[(o?o<0:t>=0)?0:l.length-1];return M.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,c=>c.width)||a),o?il(a,o<0):a||null}class It extends J{constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}static create(e,t,i){return new(e.customView||It)(e,t,i)}split(e){let t=It.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,t,i,r,s,o){return i&&(!(i instanceof It)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e instanceof It&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return U.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,r=this.posAtStart;return i?i.slice(r,r+this.length):U.empty}domAtPos(e){return(this.length?e==0:this.side>0)?xe.before(this.dom):xe.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let r=this.dom.getClientRects(),s=null;if(!r.length)return null;let o=this.side?this.side<0:e>0;for(let l=o?r.length-1:0;s=r[l],!(e>0?l==0:l==r.length-1||s.top<s.bottom);l+=o?-1:1);return il(s,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ph extends It{domAtPos(e){let{topView:t,text:i}=this.widget;return t?bo(e,0,t,i,this.length-t.length,(r,s)=>r.domAtPos(s),(r,s)=>new xe(r,Math.min(s,r.nodeValue.length))):new xe(i,Math.min(e,i.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,t){let{topView:i,text:r}=this.widget;return i?Bh(e,t,i,r,this.length-i.length):Math.min(t,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,t){let{topView:i,text:r}=this.widget;return i?bo(e,t,i,r,this.length-i.length,(s,o,l)=>s.coordsAt(o,l),(s,o,l)=>yo(s,o,l)):yo(r,e,t)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function bo(n,e,t,i,r,s,o){if(t instanceof Ct){for(let l=t.dom.firstChild;l;l=l.nextSibling){let a=J.get(l);if(a){let c=Ln(l,i),h=a.length+(c?r:0);if(n<h||n==h&&a.getSide()<=0)return c?bo(n,e,a,i,r,s,o):s(a,n,e);n-=h}else{let c=Lh(n,e,l,o);if(typeof c!="number")return c;n=c}}return s(t,t.length,-1)}else return t.dom==i?o(i,n,e):s(t,n,e)}function Lh(n,e,t,i){if(t.nodeType==3){let r=t.nodeValue.length;if(n<=r)return i(t,n,e);n-=r}else if(t.nodeType==1&&t.contentEditable!="false")for(let r=t.firstChild;r;r=r.nextSibling){let s=Lh(n,e,r,i);if(typeof s!="number")return s;n=s}return n}function Bh(n,e,t,i,r){if(t instanceof Ct){let s=0;for(let o=t.dom.firstChild;o;o=o.nextSibling){let l=J.get(o);if(l){let a=Ln(o,i);if(Ln(o,n))return s+(a?Bh(n,e,l,i,r):l.localPosFromDOM(n,e));s+=l.length+(a?r:0)}else{let a=Ih(n,e,o);if(a.result!=null)return s+a.result;s+=a.size}}}else if(t.dom==i)return Math.min(e,i.nodeValue.length);return t.localPosFromDOM(n,e)}function Ih(n,e,t){if(t.nodeType==3)return n==t?{result:e}:{size:t.nodeValue.length};if(t.nodeType==1&&t.contentEditable!="false"){let i=0;for(let r=t.firstChild,s=0;;r=r.nextSibling,s++){if(n==t&&s==e)return{result:i};if(!r)return{size:i};let o=Ih(n,e,r);if(o.result!=null)return{result:e+o.result};i+=o.size}}else return t.contains(n)?{result:0}:{size:0}}class In extends J{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof In&&e.side==this.side}split(){return new In(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?xe.before(this.dom):xe.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return U.empty}get isHidden(){return!0}}fn.prototype.children=It.prototype.children=In.prototype.children=rl;function Rh(n,e){let t=n.dom,{children:i}=n,r=0;for(let s=0;r<i.length;r++){let o=i[r],l=s+o.length;if(!(l==s&&o.getSide()<=0)){if(e>s&&e<l&&o.dom.parentNode==t)return o.domAtPos(e-s);if(e<=s)break;s=l}}for(let s=r;s>0;s--){let o=i[s-1];if(o.dom.parentNode==t)return o.domAtPos(o.length)}for(let s=r;s<i.length;s++){let o=i[s];if(o.dom.parentNode==t)return o.domAtPos(0)}return new xe(t,0)}function $h(n,e,t){let i,{children:r}=n;t>0&&e instanceof Ct&&r.length&&(i=r[r.length-1])instanceof Ct&&i.mark.eq(e.mark)?$h(i,e.children[0],t-1):(r.push(e),e.setParent(n)),n.length+=e.length}function Vh(n,e,t){let i=null,r=-1,s=null,o=-1;function l(c,h){for(let u=0,f=0;u<c.children.length&&f<=h;u++){let d=c.children[u],p=f+d.length;p>=h&&(d.children.length?l(d,h-f):(!s||s.isHidden&&t>0)&&(p>h||f==p&&d.getSide()>0)?(s=d,o=h-f):(f<h||f==p&&d.getSide()<0&&!d.isHidden)&&(i=d,r=h-f)),f=p}}l(n,e);let a=(t<0?i:s)||i||s;return a?a.coordsAt(Math.max(0,a==i?r:o),t):bg(n)}function bg(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let t=Ai(e);return t[t.length-1]||null}function wo(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}function sl(n,e){if(n==e)return!0;if(!n||!e)return!1;let t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r of t)if(i.indexOf(r)==-1||n[r]!==e[r])return!1;return!0}function vo(n,e,t){let i=null;if(e)for(let r in e)t&&r in t||n.removeAttribute(i=r);if(t)for(let r in t)e&&e[r]==t[r]||n.setAttribute(i=r,t[r]);return!!i}class Pi{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get customView(){return null}get isHidden(){return!1}destroy(e){}}var Se=function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n}(Se||(Se={}));class ne extends Pn{constructor(e,t,i,r){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=r}get heightRelevant(){return!1}static mark(e){return new as(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new jt(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,r;if(e.isBlockGap)i=-5e8,r=4e8;else{let{start:s,end:o}=Fh(e,t);i=(s?t?-3e8:-1:5e8)-1,r=(o?t?2e8:1:-6e8)+1}return new jt(e,i,r,t,e.widget||null,!0)}static line(e){return new Li(e)}static set(e,t=!1){return le.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ne.none=le.empty;class as extends ne{constructor(e){let{start:t,end:i}=Fh(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof as&&this.tagName==e.tagName&&this.class==e.class&&sl(this.attrs,e.attrs)}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}as.prototype.point=!1;class Li extends ne{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Li&&this.spec.class==e.spec.class&&sl(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Li.prototype.mapMode=Be.TrackBefore;Li.prototype.point=!0;class jt extends ne{constructor(e,t,i,r,s,o){super(t,i,s,e),this.block=r,this.isReplace=o,this.mapMode=r?t<=0?Be.TrackBefore:Be.TrackAfter:Be.TrackDel}get type(){return this.startSide<this.endSide?Se.WidgetRange:this.startSide<=0?Se.WidgetBefore:Se.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof jt&&wg(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}jt.prototype.point=!0;function Fh(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t??e,end:i??e}}function wg(n,e){return n==e||!!(n&&e&&n.compare(e))}function ko(n,e,t,i=0){let r=t.length-1;r>=0&&t[r]+i>=n?t[r]=Math.max(t[r],e):t.push(n,e)}class Ie extends J{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,r,s,o){if(i){if(!(i instanceof Ie))return!1;this.dom||i.transferDOM(this)}return r&&this.setDeco(i?i.attrs:null),Eh(this,e,t,i?i.children:[],s,o),!0}split(e){let t=new Ie;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:r}=this.childPos(e);r&&(t.append(this.children[i].split(r),0),this.children[i].merge(r,this.children[i].length,null,!1,0,0),i++);for(let s=i;s<this.children.length;s++)t.append(this.children[s],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){sl(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){$h(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=wo(t,this.attrs||{})),i&&(this.attrs=wo({class:i},this.attrs||{}))}domAtPos(e){return Rh(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e,t){var i;this.dom?this.dirty&4&&(Ch(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(vo(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let r=this.dom.lastChild;for(;r&&J.get(r)instanceof Ct;)r=r.lastChild;if(!r||!this.length||r.nodeName!="BR"&&((i=J.get(r))===null||i===void 0?void 0:i.isEditable)==!1&&(!M.ios||!this.children.some(s=>s instanceof fn))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let i of this.children){if(!(i instanceof fn)||/[^ -~]/.test(i.text))return null;let r=Ai(i.dom);if(r.length!=1)return null;e+=r[0].width,t=r[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let i=Vh(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:r}=this.parent.view.viewState,s=i.bottom-i.top;if(Math.abs(s-r.lineHeight)<2&&r.textHeight<s){let o=(s-r.textHeight)/2;return{top:i.top+o,bottom:i.bottom-o,left:i.left,right:i.left}}}return i}become(e){return!1}get type(){return Se.Text}static find(e,t){for(let i=0,r=0;i<e.children.length;i++){let s=e.children[i],o=r+s.length;if(o>=t){if(s instanceof Ie)return s;if(o>t)break}r=o+s.breakAfter}return null}}class on extends J{constructor(e,t,i){super(),this.widget=e,this.length=t,this.type=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,r,s,o){return i&&(!(i instanceof on)||!this.widget.compare(i.widget)||e>0&&s<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?xe.before(this.dom):xe.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new on(this.widget,t,this.type);return i.breakAfter=this.breakAfter,i}get children(){return rl}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):U.empty}domBoundsAround(){return null}become(e){return e instanceof on&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.type=e.type,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ol{constructor(e,t,i,r){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=r,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof on&&e.type==Se.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ie),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Hi(new In(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,this.posCovered()||this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:s,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=s,this.textOff=0}let r=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(Hi(new fn(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=0}}span(e,t,i,r){this.buildText(t-e,i,r),this.pos=t,this.openStart<0&&(this.openStart=r)}point(e,t,i,r,s,o){if(this.disallowBlockEffectsFor[o]&&i instanceof jt){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=t-e;if(i instanceof jt)if(i.block){let{type:a}=i;a==Se.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new on(i.widget||new da("div"),l,a))}else{let a=It.create(i.widget||new da("span"),l,l?0:i.startSide),c=this.atCursorPos&&!a.isEditable&&s<=r.length&&(e<t||i.startSide>0),h=!a.isEditable&&(e<t||s>r.length||i.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!c&&!a.isEditable&&(this.pendingBuffer=0),this.flushBuffer(r),c&&(u.append(Hi(new In(1),r),s),s=r.length+Math.max(0,s-r.length)),u.append(Hi(a,r),s),this.atCursorPos=h,this.pendingBuffer=h?e<t||s>r.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=r.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=s)}static build(e,t,i,r,s){let o=new ol(e,t,i,s);return o.openEnd=le.spans(r,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Hi(n,e){for(let t of e)n=new Ct(t,[n],n.length);return n}class da extends Pi{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}const Hh=P.define(),zh=P.define(),Wh=P.define(),jh=P.define(),xo=P.define(),Uh=P.define(),Zh=P.define(),qh=P.define({combine:n=>n.some(e=>e)}),vg=P.define({combine:n=>n.some(e=>e)});class Hr{constructor(e,t="nearest",i="nearest",r=5,s=5){this.range=e,this.y=t,this.x=i,this.yMargin=r,this.xMargin=s}map(e){return e.empty?this:new Hr(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const pa=te.define({map:(n,e)=>n.map(e)});function ut(n,e,t){let i=n.facet(jh);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const cs=P.define({combine:n=>n.length?n[0]:!0});let kg=0;const Xn=P.define();class Ge{constructor(e,t,i,r){this.id=e,this.create=t,this.domEventHandlers=i,this.extension=r(this)}static define(e,t){const{eventHandlers:i,provide:r,decorations:s}=t||{};return new Ge(kg++,e,i,o=>{let l=[Xn.of(o)];return s&&l.push(Ci.of(a=>{let c=a.plugin(o);return c?s(c):ne.none})),r&&l.push(r(o)),l})}static fromClass(e,t){return Ge.define(i=>new e(i),t)}}class Ns{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(ut(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){ut(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){ut(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Kh=P.define(),ll=P.define(),Ci=P.define(),al=P.define(),Gh=P.define();function Jh(n){let e=0,t=0,i=0,r=0;for(let s of n.state.facet(Gh)){let o=s(n);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(r=Math.max(r,o.bottom)))}return{left:e,right:t,top:i,bottom:r}}const Qn=P.define();class ft{constructor(e,t,i,r){this.fromA=e,this.toA=t,this.fromB=i,this.toB=r}join(e){return new ft(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let r=e[t-1];if(!(r.fromA>i.toA)){if(r.toA<i.fromA)break;i=i.join(r),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let r=0,s=0,o=0,l=0;;r++){let a=r==e.length?null:e[r],c=o-l,h=a?a.fromB:1e9;for(;s<t.length&&t[s]<h;){let u=t[s],f=t[s+1],d=Math.max(l,u),p=Math.min(h,f);if(d<=p&&new ft(d+c,p+c,d,p).addToSet(i),f>h)break;s+=2}if(!a)return i;new ft(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class zr{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=ge.empty(this.startState.doc.length);for(let s of i)this.changes=this.changes.compose(s.changes);let r=[];this.changes.iterChangedRanges((s,o,l,a)=>r.push(new ft(s,o,l,a))),this.changedRanges=r}static create(e,t,i){return new zr(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var ye=function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n}(ye||(ye={}));const So=ye.LTR,xg=ye.RTL;function Yh(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const Sg=Yh("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),Tg=Yh("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),To=Object.create(null),Qe=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);To[e]=t,To[t]=-e}function Ag(n){return n<=247?Sg[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?Tg[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8203?256:64336<=n&&n<=65023?4:n==8204?256:1}const Cg=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class On{constructor(e,t,i){this.from=e,this.to=t,this.level=i}get dir(){return this.level%2?xg:So}side(e,t){return this.dir==t==e?this.to:this.from}static find(e,t,i,r){let s=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(s<0||(r!=0?r<0?l.from<t:l.to>t:e[s].level>l.level))&&(s=o)}}if(s<0)throw new RangeError("Index out of range");return s}}const ie=[];function Mg(n,e){let t=n.length,i=e==So?1:2,r=e==So?2:1;if(!n||i==1&&!Cg.test(n))return Xh(t);for(let o=0,l=i,a=i;o<t;o++){let c=Ag(n.charCodeAt(o));c==512?c=l:c==8&&a==4&&(c=16),ie[o]=c==4?2:c,c&7&&(a=c),l=c}for(let o=0,l=i,a=i;o<t;o++){let c=ie[o];if(c==128)o<t-1&&l==ie[o+1]&&l&24?c=ie[o]=l:ie[o]=256;else if(c==64){let h=o+1;for(;h<t&&ie[h]==64;)h++;let u=o&&l==8||h<t&&ie[h]==8?a==1?1:8:256;for(let f=o;f<h;f++)ie[f]=u;o=h-1}else c==8&&a==1&&(ie[o]=1);l=c,c&7&&(a=c)}for(let o=0,l=0,a=0,c,h,u;o<t;o++)if(h=To[c=n.charCodeAt(o)])if(h<0){for(let f=l-3;f>=0;f-=3)if(Qe[f+1]==-h){let d=Qe[f+2],p=d&2?i:d&4?d&1?r:i:0;p&&(ie[o]=ie[Qe[f]]=p),l=f;break}}else{if(Qe.length==189)break;Qe[l++]=o,Qe[l++]=c,Qe[l++]=a}else if((u=ie[o])==2||u==1){let f=u==i;a=f?0:1;for(let d=l-3;d>=0;d-=3){let p=Qe[d+2];if(p&2)break;if(f)Qe[d+2]|=2;else{if(p&4)break;Qe[d+2]|=4}}}for(let o=0;o<t;o++)if(ie[o]==256){let l=o+1;for(;l<t&&ie[l]==256;)l++;let a=(o?ie[o-1]:i)==1,c=(l<t?ie[l]:i)==1,h=a==c?a?1:2:i;for(let u=o;u<l;u++)ie[u]=h;o=l-1}let s=[];if(i==1)for(let o=0;o<t;){let l=o,a=ie[o++]!=1;for(;o<t&&a==(ie[o]!=1);)o++;if(a)for(let c=o;c>l;){let h=c,u=ie[--c]!=2;for(;c>l&&u==(ie[c-1]!=2);)c--;s.push(new On(c,h,u?2:1))}else s.push(new On(l,o,0))}else for(let o=0;o<t;){let l=o,a=ie[o++]==2;for(;o<t&&a==(ie[o]==2);)o++;s.push(new On(l,o,a?1:2))}return s}function Xh(n){return[new On(0,n,0)]}let Qh="";function Og(n,e,t,i,r){var s;let o=i.head-n.from,l=-1;if(o==0){if(!r||!n.length)return null;e[0].level!=t&&(o=e[0].side(!1,t),l=0)}else if(o==n.length){if(r)return null;let f=e[e.length-1];f.level!=t&&(o=f.side(!0,t),l=e.length-1)}l<0&&(l=On.find(e,o,(s=i.bidiLevel)!==null&&s!==void 0?s:-1,i.assoc));let a=e[l];o==a.side(r,t)&&(a=e[l+=r?1:-1],o=a.side(!r,t));let c=r==(a.dir==t),h=He(n.text,o,c);if(Qh=n.text.slice(Math.min(o,h),Math.max(o,h)),h!=a.side(r,t))return x.cursor(h+n.from,c?-1:1,a.level);let u=l==(r?e.length-1:0)?null:e[l+(r?1:-1)];return!u&&a.level!=t?x.cursor(r?n.to:n.from,r?-1:1,t):u&&u.level<a.level?x.cursor(u.side(!r,t)+n.from,r?1:-1,u.level):x.cursor(h+n.from,r?-1:1,a.level)}const xn="";class eu{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(Z.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=xn}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let r=e;;){this.findPointBefore(i,r);let s=this.text.length;this.readNode(r);let o=r.nextSibling;if(o==t)break;let l=J.get(r),a=J.get(o);(l&&a?l.breakAfter:(l?l.breakAfter:ma(r))||ma(o)&&(r.nodeName!="BR"||r.cmIgnore)&&this.text.length>s)&&this.lineBreak(),r=o}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,r=this.lineSeparator?null:/\r\n?|\n/g;;){let s=-1,o=1,l;if(this.lineSeparator?(s=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=r.exec(t))&&(s=l.index,o=l[0].length),this.append(t.slice(i,s<0?t.length:s)),s<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=s+o}}readNode(e){if(e.cmIgnore)return;let t=J.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let r=i.iter();!r.next().done;)r.lineBreak?this.lineBreak():this.append(r.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+Math.min(t,i.offset))}}function ma(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}class ga{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class ya extends J{constructor(e){super(),this.view=e,this.compositionDeco=ne.none,this.compositionNode=null,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ie],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ft(0,0,0,e.state.doc.length)],0)}get length(){return this.view.state.doc.length}update(e){let t=e.changedRanges;this.minWidth>0&&t.length&&(t.every(({fromA:o,toA:l})=>l<this.minWidthFrom||o>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),{deco:this.compositionDeco,node:this.compositionNode}=this.view.inputState.composing<0?ei:Eg(this.view,e.changes),(M.ie||M.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let i=this.decorations,r=this.updateDeco(),s=Lg(i,r,e.changes);return t=ft.extendWithRanges(t,s),this.dirty==0&&t.length==0?!1:(this.updateInner(t,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let s=M.chrome||M.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,s),this.dirty=0,s&&(s.written||i.selectionRange.focusNode!=s.node)&&(this.forceSelection=!0),this.dom.style.height=""});let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let s of this.children)s instanceof on&&s.widget instanceof ba&&r.push(s.dom);i.updateGaps(r)}updateChildren(e,t){let i=this.childCursor(t);for(let r=e.length-1;;r--){let s=r>=0?e[r]:null;if(!s)break;let{fromA:o,toA:l,fromB:a,toB:c}=s,{content:h,breakAtStart:u,openStart:f,openEnd:d}=ol.build(this.view.state.doc,a,c,this.decorations,this.dynamicDecorationMap),{i:p,off:g}=i.findPos(l,1),{i:y,off:b}=i.findPos(o,-1);Nh(this,y,b,p,g,h,u,f,d)}}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,r=i==this.dom,s=!r&&cr(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(r||t||s))return;let o=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,a=this.domAtPos(l.anchor),c=l.empty?a:this.domAtPos(l.head);if(M.gecko&&l.empty&&!this.compositionDeco.size&&Ng(a)){let u=document.createTextNode("");this.view.observer.ignore(()=>a.node.insertBefore(u,a.node.childNodes[a.offset]||null)),a=c=new xe(u,0),o=!0}let h=this.view.observer.selectionRange;(o||!h.focusNode||!Vr(a.node,a.offset,h.anchorNode,h.anchorOffset)||!Vr(c.node,c.offset,h.focusNode,h.focusOffset))&&(this.view.observer.ignore(()=>{M.android&&M.chrome&&this.dom.contains(h.focusNode)&&Bg(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let u=$r(this.view.root);if(u)if(l.empty){if(M.gecko){let f=_g(a.node,a.offset);if(f&&f!=3){let d=nu(a.node,a.offset,f==1?1:-1);d&&(a=new xe(d,f==1?0:d.nodeValue.length))}}u.collapse(a.node,a.offset),l.bidiLevel!=null&&h.cursorBidiLevel!=null&&(h.cursorBidiLevel=l.bidiLevel)}else if(u.extend){u.collapse(a.node,a.offset);try{u.extend(c.node,c.offset)}catch{}}else{let f=document.createRange();l.anchor>l.head&&([a,c]=[c,a]),f.setEnd(c.node,c.offset),f.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(f)}s&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(a,c)),this.impreciseAnchor=a.precise?null:new xe(h.anchorNode,h.anchorOffset),this.impreciseHead=c.precise?null:new xe(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:e}=this,t=e.state.selection.main,i=$r(e.root),{anchorNode:r,anchorOffset:s}=e.observer.selectionRange;if(!i||!t.empty||!t.assoc||!i.modify)return;let o=Ie.find(this,t.head);if(!o)return;let l=o.posAtStart;if(t.head==l||t.head==l+o.length)return;let a=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!a||!c||a.bottom>c.top)return;let h=this.domAtPos(t.head+t.assoc);i.collapse(h.node,h.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let u=e.observer.selectionRange;e.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=t.from&&i.collapse(r,s)}nearest(e){for(let t=e;t;){let i=J.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let r=this.children[t];if(i<r.length||r instanceof Ie)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){for(let i=this.length,r=this.children.length-1;;r--){let s=this.children[r],o=i-s.breakAfter-s.length;if(e>o||e==o&&s.type!=Se.WidgetBefore&&s.type!=Se.WidgetAfter&&(!r||t==2||this.children[r-1].breakAfter||this.children[r-1].type==Se.WidgetBefore&&t>-2))return s.coordsAt(e-o,t);i=o}}measureVisibleLineHeights(e){let t=[],{from:i,to:r}=e,s=this.view.contentDOM.clientWidth,o=s>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==ye.LTR;for(let c=0,h=0;h<this.children.length;h++){let u=this.children[h],f=c+u.length;if(f>r)break;if(c>=i){let d=u.dom.getBoundingClientRect();if(t.push(d.height),o){let p=u.dom.lastChild,g=p?Ai(p):[];if(g.length){let y=g[g.length-1],b=a?y.right-d.left:d.right-y.left;b>l&&(l=b,this.minWidth=s,this.minWidthFrom=c,this.minWidthTo=f)}}}c=f+u.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?ye.RTL:ye.LTR}measureTextSize(){for(let s of this.children)if(s instanceof Ie){let o=s.measureTextSize();if(o)return o}let e=document.createElement("div"),t,i,r;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let s=Ai(e.firstChild)[0];t=e.getBoundingClientRect().height,i=s?s.width/27:7,r=s?s.height:t,e.remove()}),{lineHeight:t,charWidth:i,textHeight:r}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new Oh(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,r=0;;r++){let s=r==t.viewports.length?null:t.viewports[r],o=s?s.from-1:this.length;if(o>i){let l=t.lineBlockAt(o).bottom-t.lineBlockAt(i).top;e.push(ne.replace({widget:new ba(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!s)break;i=s.to+1}return ne.set(e)}updateDeco(){let e=this.view.state.facet(Ci).map((t,i)=>(this.dynamicDecorationMap[i]=typeof t=="function")?t(this.view):t);for(let t=e.length;t<e.length+3;t++)this.dynamicDecorationMap[t]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),r;if(!i)return;!t.empty&&(r=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,r.left),top:Math.min(i.top,r.top),right:Math.max(i.right,r.right),bottom:Math.max(i.bottom,r.bottom)});let s=Jh(this.view),o={left:i.left-s.left,top:i.top-s.top,right:i.right+s.right,bottom:i.bottom+s.bottom};fg(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==ye.LTR)}}function Ng(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}class ba extends Pi{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function tu(n){let e=n.observer.selectionRange,t=e.focusNode&&nu(e.focusNode,e.focusOffset,0);if(!t)return null;let i=n.docView.nearest(t);if(!i)return null;if(i instanceof Ie){let r=t;for(;r.parentNode!=i.dom;)r=r.parentNode;let s=r.previousSibling;for(;s&&!J.get(s);)s=s.previousSibling;let o=s?J.get(s).posAtEnd:i.posAtStart;return{from:o,to:o,node:r,text:t}}else{for(;;){let{parent:s}=i;if(!s)return null;if(s instanceof Ie)break;i=s}let r=i.posAtStart;return{from:r,to:r+i.length,node:i.dom,text:t}}}const ei={deco:ne.none,node:null};function Eg(n,e){let t=tu(n);if(!t)return ei;let{from:i,to:r,node:s,text:o}=t,l=e.mapPos(i,1),a=Math.max(l,e.mapPos(r,-1)),{state:c}=n,h=new eu([],c);s.nodeType==3?h.readTextNode(s):h.readRange(s.firstChild,null);let{text:u}=h;if(u.indexOf(xn)>-1)return ei;if(a-l<u.length)if(c.doc.sliceString(l,Math.min(c.doc.length,l+u.length))==u)a=l+u.length;else if(c.doc.sliceString(Math.max(0,a-u.length),a)==u)l=a-u.length;else return ei;else if(c.doc.sliceString(l,a)!=u)return ei;let f=J.get(s);return f instanceof Ph?f=f.widget.topView:f&&(f.parent=null),{deco:ne.set(ne.replace({widget:new Dg(s,o,f),inclusive:!0}).range(l,a)),node:s}}class Dg extends Pi{constructor(e,t,i){super(),this.top=e,this.text=t,this.topView=i}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return Ph}}function nu(n,e,t){if(t<=0)for(let i=n,r=e;;){if(i.nodeType==3)return i;if(i.nodeType==1&&r>0)i=i.childNodes[r-1],r=Wt(i);else break}if(t>=0)for(let i=n,r=e;;){if(i.nodeType==3)return i;if(i.nodeType==1&&r<i.childNodes.length&&t>=0)i=i.childNodes[r],r=0;else break}return null}function _g(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}class Pg{constructor(){this.changes=[]}compareRange(e,t){ko(e,t,this.changes)}comparePoint(e,t){ko(e,t,this.changes)}}function Lg(n,e,t){let i=new Pg;return le.compare(n,e,t,i),i.changes}function Bg(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function Ig(n,e,t=1){let i=n.charCategorizer(e),r=n.doc.lineAt(e),s=e-r.from;if(r.length==0)return x.cursor(e);s==0?t=1:s==r.length&&(t=-1);let o=s,l=s;t<0?o=He(r.text,s,!1):l=He(r.text,s);let a=i(r.text.slice(o,l));for(;o>0;){let c=He(r.text,o,!1);if(i(r.text.slice(c,o))!=a)break;o=c}for(;l<r.length;){let c=He(r.text,l);if(i(r.text.slice(l,c))!=a)break;l=c}return x.range(o+r.from,l+r.from)}function Rg(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function $g(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function Es(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function wa(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function va(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function Ao(n,e,t){let i,r,s,o,l=!1,a,c,h,u;for(let p=n.firstChild;p;p=p.nextSibling){let g=Ai(p);for(let y=0;y<g.length;y++){let b=g[y];r&&Es(r,b)&&(b=wa(va(b,r.bottom),r.top));let v=Rg(e,b),A=$g(t,b);if(v==0&&A==0)return p.nodeType==3?ka(p,e,t):Ao(p,e,t);if(!i||o>A||o==A&&s>v){i=p,r=b,s=v,o=A;let k=A?t<b.top?-1:1:v?e<b.left?-1:1:0;l=!k||(k>0?y<g.length-1:y>0)}v==0?t>b.bottom&&(!h||h.bottom<b.bottom)?(a=p,h=b):t<b.top&&(!u||u.top>b.top)&&(c=p,u=b):h&&Es(h,b)?h=va(h,b.bottom):u&&Es(u,b)&&(u=wa(u,b.top))}}if(h&&h.bottom>=t?(i=a,r=h):u&&u.top<=t&&(i=c,r=u),!i)return{node:n,offset:0};let f=Math.max(r.left,Math.min(r.right,e));if(i.nodeType==3)return ka(i,f,t);if(l&&i.contentEditable!="false")return Ao(i,f,t);let d=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(r.left+r.right)/2?1:0);return{node:n,offset:d}}function ka(n,e,t){let i=n.nodeValue.length,r=-1,s=1e9,o=0;for(let l=0;l<i;l++){let a=Bn(n,l,l+1).getClientRects();for(let c=0;c<a.length;c++){let h=a[c];if(h.top==h.bottom)continue;o||(o=e-h.left);let u=(h.top>t?h.top-t:t-h.bottom)-1;if(h.left-1<=e&&h.right+1>=e&&u<s){let f=e>=(h.left+h.right)/2,d=f;if((M.chrome||M.gecko)&&Bn(n,l).getBoundingClientRect().left==h.right&&(d=!f),u<=0)return{node:n,offset:l+(d?1:0)};r=l+(d?1:0),s=u}}}return{node:n,offset:r>-1?r:o>0?n.nodeValue.length:0}}function iu(n,e,t,i=-1){var r,s;let o=n.contentDOM.getBoundingClientRect(),l=o.top+n.viewState.paddingTop,a,{docHeight:c}=n.viewState,{x:h,y:u}=e,f=u-l;if(f<0)return 0;if(f>c)return n.state.doc.length;for(let k=n.viewState.heightOracle.textHeight/2,E=!1;a=n.elementAtHeight(f),a.type!=Se.Text;)for(;f=i>0?a.bottom+k:a.top-k,!(f>=0&&f<=c);){if(E)return t?null:0;E=!0,i=-i}u=l+f;let d=a.from;if(d<n.viewport.from)return n.viewport.from==0?0:t?null:xa(n,o,a,h,u);if(d>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:t?null:xa(n,o,a,h,u);let p=n.dom.ownerDocument,g=n.root.elementFromPoint?n.root:p,y=g.elementFromPoint(h,u);y&&!n.contentDOM.contains(y)&&(y=null),y||(h=Math.max(o.left+1,Math.min(o.right-1,h)),y=g.elementFromPoint(h,u),y&&!n.contentDOM.contains(y)&&(y=null));let b,v=-1;if(y&&((r=n.docView.nearest(y))===null||r===void 0?void 0:r.isEditable)!=!1){if(p.caretPositionFromPoint){let k=p.caretPositionFromPoint(h,u);k&&({offsetNode:b,offset:v}=k)}else if(p.caretRangeFromPoint){let k=p.caretRangeFromPoint(h,u);k&&({startContainer:b,startOffset:v}=k,(!n.contentDOM.contains(b)||M.safari&&Vg(b,v,h)||M.chrome&&Fg(b,v,h))&&(b=void 0))}}if(!b||!n.docView.dom.contains(b)){let k=Ie.find(n.docView,d);if(!k)return f>a.top+a.height/2?a.to:a.from;({node:b,offset:v}=Ao(k.dom,h,u))}let A=n.docView.nearest(b);if(!A)return null;if(A.isWidget&&((s=A.dom)===null||s===void 0?void 0:s.nodeType)==1){let k=A.dom.getBoundingClientRect();return e.y<k.top||e.y<=k.bottom&&e.x<=(k.left+k.right)/2?A.posAtStart:A.posAtEnd}else return A.localPosFromDOM(b,v)+A.posAtStart}function xa(n,e,t,i,r){let s=Math.round((i-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&t.height>n.defaultLineHeight*1.5){let l=n.viewState.heightOracle.textHeight,a=Math.floor((r-t.top-(n.defaultLineHeight-l)*.5)/l);s+=a*n.viewState.heightOracle.lineLength}let o=n.state.sliceDoc(t.from,t.to);return t.from+sg(o,s,n.state.tabSize)}function Vg(n,e,t){let i;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(let r=n.nextSibling;r;r=r.nextSibling)if(r.nodeType!=1||r.nodeName!="BR")return!1;return Bn(n,i-1,i).getBoundingClientRect().left>t}function Fg(n,e,t){if(e!=0)return!1;for(let r=n;;){let s=r.parentNode;if(!s||s.nodeType!=1||s.firstChild!=r)return!1;if(s.classList.contains("cm-line"))break;r=s}let i=n.nodeType==1?n.getBoundingClientRect():Bn(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return t-i.left>5}function Hg(n,e){let t=n.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==Se.Text))return i}return t}function zg(n,e,t,i){let r=Hg(n,e.head),s=!i||r.type!=Se.Text||!(n.lineWrapping||r.widgetLineBreaks)?null:n.coordsAtPos(e.assoc<0&&e.head>r.from?e.head-1:e.head);if(s){let o=n.dom.getBoundingClientRect(),l=n.textDirectionAt(r.from),a=n.posAtCoords({x:t==(l==ye.LTR)?o.right-1:o.left+1,y:(s.top+s.bottom)/2});if(a!=null)return x.cursor(a,t?-1:1)}return x.cursor(t?r.to:r.from,t?-1:1)}function Sa(n,e,t,i){let r=n.state.doc.lineAt(e.head),s=n.bidiSpans(r),o=n.textDirectionAt(r.from);for(let l=e,a=null;;){let c=Og(r,s,o,l,t),h=Qh;if(!c){if(r.number==(t?n.state.doc.lines:1))return l;h=`
`,r=n.state.doc.line(r.number+(t?1:-1)),s=n.bidiSpans(r),c=x.cursor(t?r.from:r.to)}if(a){if(!a(h))return l}else{if(!i)return c;a=i(h)}l=c}}function Wg(n,e,t){let i=n.state.charCategorizer(e),r=i(t);return s=>{let o=i(s);return r==wt.Space&&(r=o),r==o}}function jg(n,e,t,i){let r=e.head,s=t?1:-1;if(r==(t?n.state.doc.length:0))return x.cursor(r,e.assoc);let o=e.goalColumn,l,a=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(r),h=n.documentTop;if(c)o==null&&(o=c.left-a.left),l=s<0?c.top:c.bottom;else{let d=n.viewState.lineBlockAt(r);o==null&&(o=Math.min(a.right-a.left,n.defaultCharacterWidth*(r-d.from))),l=(s<0?d.top:d.bottom)+h}let u=a.left+o,f=i??n.viewState.heightOracle.textHeight>>1;for(let d=0;;d+=10){let p=l+(f+d)*s,g=iu(n,{x:u,y:p},!1,s);if(p<a.top||p>a.bottom||(s<0?g<r:g>r))return x.cursor(g,e.assoc,void 0,o)}}function hr(n,e,t){for(;;){let i=0;for(let r of n)r.between(e-1,e+1,(s,o,l)=>{if(e>s&&e<o){let a=i||t||(e-s<o-e?-1:1);e=a<0?s:o,i=a}});if(!i)return e}}function Ds(n,e,t){let i=hr(n.state.facet(al).map(r=>r(n)),t.from,e.head>t.from?-1:1);return i==t.from?t:x.cursor(i,i<t.from?1:-1)}class Ug{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null;let t=(i,r)=>{this.ignoreDuringComposition(r)||r.type=="keydown"&&this.keydown(e,r)||(this.mustFlushObserver(r)&&e.observer.forceFlush(),this.runCustomHandlers(r.type,e,r)?r.preventDefault():i(e,r))};for(let i in pe){let r=pe[i];e.contentDOM.addEventListener(i,s=>{Ta(e,s)&&t(r,s)},Co[i]),this.registeredEvents.push(i)}e.scrollDOM.addEventListener("mousedown",i=>{if(i.target==e.scrollDOM&&i.clientY>e.contentDOM.getBoundingClientRect().bottom&&(t(pe.mousedown,i),!i.defaultPrevented&&i.button==2)){let r=e.contentDOM.style.minHeight;e.contentDOM.style.minHeight="100%",setTimeout(()=>e.contentDOM.style.minHeight=r,200)}}),e.scrollDOM.addEventListener("drop",i=>{i.target==e.scrollDOM&&i.clientY>e.contentDOM.getBoundingClientRect().bottom&&t(pe.drop,i)}),M.chrome&&M.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,M.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,t){var i;let r;this.customHandlers=[];for(let s of t)if(r=(i=s.update(e).spec)===null||i===void 0?void 0:i.domEventHandlers){this.customHandlers.push({plugin:s.value,handlers:r});for(let o in r)this.registeredEvents.indexOf(o)<0&&o!="scroll"&&(this.registeredEvents.push(o),e.contentDOM.addEventListener(o,l=>{Ta(e,l)&&this.runCustomHandlers(o,e,l)&&l.preventDefault()}))}}runCustomHandlers(e,t,i){for(let r of this.customHandlers){let s=r.handlers[e];if(s)try{if(s.call(r.plugin,i,t)||i.defaultPrevented)return!0}catch(o){ut(t.state,o)}}return!1}runScrollHandlers(e,t){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let i of this.customHandlers){let r=i.handlers.scroll;if(r)try{r.call(i.plugin,t,e)}catch(s){ut(e.state,s)}}}keydown(e,t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(t.keyCode!=27&&su.indexOf(t.keyCode)<0&&(e.inputState.lastEscPress=0),M.android&&M.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return e.observer.delayAndroidKey(t.key,t.keyCode),!0;let i;return M.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((i=ru.find(r=>r.keyCode==t.keyCode))&&!t.ctrlKey||Zg.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=i||t,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let t=this.pendingIOSKey;return t?(this.pendingIOSKey=void 0,Mn(e.contentDOM,t.key,t.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:M.safari&&!M.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const ru=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],Zg="dthko",su=[16,17,18,20,91,92,224,225],zi=6;function Wi(n){return Math.max(0,n)*.7+8}class qg{constructor(e,t,i,r){this.view=e,this.style=i,this.mustSelect=r,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParent=dg(e.contentDOM),this.atoms=e.state.facet(al).map(o=>o(e));let s=e.contentDOM.ownerDocument;s.addEventListener("mousemove",this.move=this.move.bind(this)),s.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(Z.allowMultipleSelections)&&Kg(e,t),this.dragging=Jg(e,t)&&cu(t)==1?null:!1}start(e){this.dragging===!1&&(e.preventDefault(),this.select(e))}move(e){var t;if(e.buttons==0)return this.destroy();if(this.dragging!==!1)return;this.select(this.lastEvent=e);let i=0,r=0,s=((t=this.scrollParent)===null||t===void 0?void 0:t.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},o=Jh(this.view);e.clientX-o.left<=s.left+zi?i=-Wi(s.left-e.clientX):e.clientX+o.right>=s.right-zi&&(i=Wi(e.clientX-s.right)),e.clientY-o.top<=s.top+zi?r=-Wi(s.top-e.clientY):e.clientY+o.bottom>=s.bottom-zi&&(r=Wi(e.clientY-s.bottom)),this.setScrollSpeed(i,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let i=0;i<e.ranges.length;i++){let r=e.ranges[i],s=null;if(r.empty){let o=hr(this.atoms,r.from,0);o!=r.from&&(s=x.cursor(o,-1))}else{let o=hr(this.atoms,r.from,-1),l=hr(this.atoms,r.to,1);(o!=r.from||l!=r.to)&&(s=x.range(r.from==r.anchor?o:l,r.from==r.head?o:l))}s&&(t||(t=e.ranges.slice()),t[i]=s)}return t?x.create(t,e.mainIndex):e}select(e){let{view:t}=this,i=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!i.eq(t.state.selection)||i.main.assoc!=t.state.selection.main.assoc)&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function Kg(n,e){let t=n.state.facet(Hh);return t.length?t[0](e):M.mac?e.metaKey:e.ctrlKey}function Gg(n,e){let t=n.state.facet(zh);return t.length?t[0](e):M.mac?!e.altKey:!e.ctrlKey}function Jg(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=$r(n.root);if(!i||i.rangeCount==0)return!0;let r=i.getRangeAt(0).getClientRects();for(let s=0;s<r.length;s++){let o=r[s];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function Ta(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=J.get(t))&&i.ignoreEvent(e))return!1;return!0}const pe=Object.create(null),Co=Object.create(null),ou=M.ie&&M.ie_version<15||M.ios&&M.webkit_version<604;function Yg(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),lu(n,t.value)},50)}function lu(n,e){let{state:t}=n,i,r=1,s=t.toText(e),o=s.lines==t.selection.ranges.length;if(Mo!=null&&t.selection.ranges.every(a=>a.empty)&&Mo==s.toString()){let a=-1;i=t.changeByRange(c=>{let h=t.doc.lineAt(c.from);if(h.from==a)return{range:c};a=h.from;let u=t.toText((o?s.line(r++).text:e)+t.lineBreak);return{changes:{from:h.from,insert:u},range:x.cursor(c.from+u.length)}})}else o?i=t.changeByRange(a=>{let c=s.line(r++);return{changes:{from:a.from,to:a.to,insert:c.text},range:x.cursor(a.from+c.length)}}):i=t.replaceSelection(s);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}pe.keydown=(n,e)=>{n.inputState.setSelectionOrigin("select"),e.keyCode==27&&(n.inputState.lastEscPress=Date.now())};pe.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};pe.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};Co.touchstart=Co.touchmove={passive:!0};pe.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return;let t=null;for(let i of n.state.facet(Wh))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=ey(n,e)),t){let i=!n.hasFocus;n.inputState.startMouseSelection(new qg(n,e,t,i)),i&&n.observer.ignore(()=>Ah(n.contentDOM)),n.inputState.mouseSelection&&n.inputState.mouseSelection.start(e)}};function Aa(n,e,t,i){if(i==1)return x.cursor(e,t);if(i==2)return Ig(n.state,e,t);{let r=Ie.find(n.docView,e),s=n.state.doc.lineAt(r?r.posAtEnd:e),o=r?r.posAtStart:s.from,l=r?r.posAtEnd:s.to;return l<n.state.doc.length&&l==s.to&&l++,x.range(o,l)}}let au=(n,e)=>n>=e.top&&n<=e.bottom,Ca=(n,e,t)=>au(e,t)&&n>=t.left&&n<=t.right;function Xg(n,e,t,i){let r=Ie.find(n.docView,e);if(!r)return 1;let s=e-r.posAtStart;if(s==0)return 1;if(s==r.length)return-1;let o=r.coordsAt(s,-1);if(o&&Ca(t,i,o))return-1;let l=r.coordsAt(s,1);return l&&Ca(t,i,l)?1:o&&au(i,o)?-1:1}function Ma(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:Xg(n,t,e.clientX,e.clientY)}}const Qg=M.ie&&M.ie_version<=11;let Oa=null,Na=0,Ea=0;function cu(n){if(!Qg)return n.detail;let e=Oa,t=Ea;return Oa=n,Ea=Date.now(),Na=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(Na+1)%3:1}function ey(n,e){let t=Ma(n,e),i=cu(e),r=n.state.selection;return{update(s){s.docChanged&&(t.pos=s.changes.mapPos(t.pos),r=r.map(s.changes))},get(s,o,l){let a=Ma(n,s),c,h=Aa(n,a.pos,a.bias,i);if(t.pos!=a.pos&&!o){let u=Aa(n,t.pos,t.bias,i),f=Math.min(u.from,h.from),d=Math.max(u.to,h.to);h=f<h.from?x.range(f,d):x.range(d,f)}return o?r.replaceRange(r.main.extend(h.from,h.to)):l&&i==1&&r.ranges.length>1&&(c=ty(r,a.pos))?c:l?r.addRange(h):x.create([h])}}}function ty(n,e){for(let t=0;t<n.ranges.length;t++){let{from:i,to:r}=n.ranges[t];if(i<=e&&r>=e)return x.create(n.ranges.slice(0,t).concat(n.ranges.slice(t+1)),n.mainIndex==t?0:n.mainIndex-(n.mainIndex>t?1:0))}return null}pe.dragstart=(n,e)=>{let{selection:{main:t}}=n.state,{mouseSelection:i}=n.inputState;i&&(i.dragging=t),e.dataTransfer&&(e.dataTransfer.setData("Text",n.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove")};function Da(n,e,t,i){if(!t)return;let r=n.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:s}=n.inputState,o=i&&s&&s.dragging&&Gg(n,e)?{from:s.dragging.from,to:s.dragging.to}:null,l={from:r,insert:t},a=n.state.changes(o?[o,l]:l);n.focus(),n.dispatch({changes:a,selection:{anchor:a.mapPos(r,-1),head:a.mapPos(r,1)},userEvent:o?"move.drop":"input.drop"})}pe.drop=(n,e)=>{if(!e.dataTransfer)return;if(n.state.readOnly)return e.preventDefault();let t=e.dataTransfer.files;if(t&&t.length){e.preventDefault();let i=Array(t.length),r=0,s=()=>{++r==t.length&&Da(n,e,i.filter(o=>o!=null).join(n.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=s,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),s()},l.readAsText(t[o])}}else Da(n,e,e.dataTransfer.getData("Text"),!0)};pe.paste=(n,e)=>{if(n.state.readOnly)return e.preventDefault();n.observer.flush();let t=ou?null:e.clipboardData;t?(lu(n,t.getData("text/plain")||t.getData("text/uri-text")),e.preventDefault()):Yg(n)};function ny(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function iy(n){let e=[],t=[],i=!1;for(let r of n.selection.ranges)r.empty||(e.push(n.sliceDoc(r.from,r.to)),t.push(r));if(!e.length){let r=-1;for(let{from:s}of n.selection.ranges){let o=n.doc.lineAt(s);o.number>r&&(e.push(o.text),t.push({from:o.from,to:Math.min(n.doc.length,o.to+1)})),r=o.number}i=!0}return{text:e.join(n.lineBreak),ranges:t,linewise:i}}let Mo=null;pe.copy=pe.cut=(n,e)=>{let{text:t,ranges:i,linewise:r}=iy(n.state);if(!t&&!r)return;Mo=r?t:null;let s=ou?null:e.clipboardData;s?(e.preventDefault(),s.clearData(),s.setData("text/plain",t)):ny(n,t),e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"})};const hu=zn.define();function uu(n,e){let t=[];for(let i of n.facet(Zh)){let r=i(n,e);r&&t.push(r)}return t?n.update({effects:t,annotations:hu.of(!0)}):null}function fu(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let t=uu(n.state,e);t?n.dispatch(t):n.update([])}},10)}pe.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),fu(n)};pe.blur=n=>{n.observer.clearSelectionRange(),fu(n)};pe.compositionstart=pe.compositionupdate=n=>{n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0)};pe.compositionend=n=>{n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,M.chrome&&M.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.compositionDeco.size&&n.update([])},50)};pe.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};pe.beforeinput=(n,e)=>{var t;let i;if(M.chrome&&M.android&&(i=ru.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let r=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var s;(((s=window.visualViewport)===null||s===void 0?void 0:s.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}};const _a=["pre-wrap","normal","pre-line","break-spaces"];class ry{constructor(e){this.lineWrapping=e,this.doc=U.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return _a.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let r=e[i];r<0?i++:this.heightSamples[Math.floor(r*10)]||(t=!0,this.heightSamples[Math.floor(r*10)]=!0)}return t}refresh(e,t,i,r,s,o){let l=_a.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=t,this.charWidth=i,this.textHeight=r,this.lineLength=s,a){this.heightSamples={};for(let c=0;c<o.length;c++){let h=o[c];h<0?c++:this.heightSamples[Math.floor(h*10)]=!0}}return a}}class sy{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class ot{constructor(e,t,i,r,s){this.from=e,this.length=t,this.top=i,this.height=r,this._content=s}get type(){return typeof this._content=="number"?Se.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof jt?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new ot(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var X=function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n}(X||(X={}));const ur=.001;class _e{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>ur&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return _e.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,r){let s=this,o=i.doc;for(let l=r.length-1;l>=0;l--){let{fromA:a,toA:c,fromB:h,toB:u}=r[l],f=s.lineAt(a,X.ByPosNoHeight,i.setDoc(t),0,0),d=f.to>=c?f:s.lineAt(c,X.ByPosNoHeight,i,0,0);for(u+=d.to-c,c=d.to;l>0&&f.from<=r[l-1].toA;)a=r[l-1].fromA,h=r[l-1].fromB,l--,a<f.from&&(f=s.lineAt(a,X.ByPosNoHeight,i,0,0));h+=f.from-a,a=f.from;let p=cl.build(i.setDoc(o),e,h,u);s=s.replace(a,c,p)}return s.updateHeight(i,0)}static empty(){return new Ve(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,r=0,s=0;for(;;)if(t==i)if(r>s*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,r-=l.size}else if(s>r*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,s-=l.size}else break;else if(r<s){let l=e[t++];l&&(r+=l.size)}else{let l=e[--i];l&&(s+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new oy(_e.of(e.slice(0,t)),o,_e.of(e.slice(i)))}}_e.prototype.size=1;class du extends _e{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,r){return new ot(r,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,r,s){return this.blockAt(0,i,r,s)}forEachLine(e,t,i,r,s,o){e<=s+this.length&&t>=s&&o(this.blockAt(0,i,r,s))}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more&&this.setHeight(e,r.heights[r.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Ve extends du{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,r){return new ot(r,this.length,i,this.height,this.breaks)}replace(e,t,i){let r=i[0];return i.length==1&&(r instanceof Ve||r instanceof be&&r.flags&4)&&Math.abs(this.length-r.length)<10?(r instanceof be?r=new Ve(r.length,this.height):r.height=this.height,this.outdated||(r.outdated=!1),r):_e.of(i)}updateHeight(e,t=0,i=!1,r){return r&&r.from<=t&&r.more?this.setHeight(e,r.heights[r.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class be extends _e{constructor(e){super(e,0)}heightMetrics(e,t){let i=e.doc.lineAt(t).number,r=e.doc.lineAt(t+this.length).number,s=r-i+1,o,l=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*s);o=a/s,this.length>s+1&&(l=(this.height-a)/(this.length-s-1))}else o=this.height/s;return{firstLine:i,lastLine:r,perLine:o,perChar:l}}blockAt(e,t,i,r){let{firstLine:s,lastLine:o,perLine:l,perChar:a}=this.heightMetrics(t,r);if(t.lineWrapping){let c=r+Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length),h=t.doc.lineAt(c),u=l+h.length*a,f=Math.max(i,e-u/2);return new ot(h.from,h.length,f,u,0)}else{let c=Math.max(0,Math.min(o-s,Math.floor((e-i)/l))),{from:h,length:u}=t.doc.line(s+c);return new ot(h,u,i+l*c,l,0)}}lineAt(e,t,i,r,s){if(t==X.ByHeight)return this.blockAt(e,i,r,s);if(t==X.ByPosNoHeight){let{from:d,to:p}=i.doc.lineAt(e);return new ot(d,p-d,0,0,0)}let{firstLine:o,perLine:l,perChar:a}=this.heightMetrics(i,s),c=i.doc.lineAt(e),h=l+c.length*a,u=c.number-o,f=r+l*u+a*(c.from-s-u);return new ot(c.from,c.length,Math.max(r,Math.min(f,r+this.height-h)),h,0)}forEachLine(e,t,i,r,s,o){e=Math.max(e,s),t=Math.min(t,s+this.length);let{firstLine:l,perLine:a,perChar:c}=this.heightMetrics(i,s);for(let h=e,u=r;h<=t;){let f=i.doc.lineAt(h);if(h==e){let p=f.number-l;u+=a*p+c*(e-s-p)}let d=a+c*f.length;o(new ot(f.from,f.length,u,d,0)),u+=d,h=f.to+1}}replace(e,t,i){let r=this.length-t;if(r>0){let s=i[i.length-1];s instanceof be?i[i.length-1]=new be(s.length+r):i.push(null,new be(r-1))}if(e>0){let s=i[0];s instanceof be?i[0]=new be(e+s.length):i.unshift(new be(e-1),null)}return _e.of(i)}decomposeLeft(e,t){t.push(new be(e-1),null)}decomposeRight(e,t){t.push(null,new be(this.length-e-1))}updateHeight(e,t=0,i=!1,r){let s=t+this.length;if(r&&r.from<=t+this.length&&r.more){let o=[],l=Math.max(t,r.from),a=-1;for(r.from>t&&o.push(new be(r.from-t-1).updateHeight(e,t));l<=s&&r.more;){let h=e.doc.lineAt(l).length;o.length&&o.push(null);let u=r.heights[r.index++];a==-1?a=u:Math.abs(u-a)>=ur&&(a=-2);let f=new Ve(h,u);f.outdated=!1,o.push(f),l+=h+1}l<=s&&o.push(null,new be(s-l).updateHeight(e,l));let c=_e.of(o);return(a<0||Math.abs(c.height-this.height)>=ur||Math.abs(a-this.heightMetrics(e,t).perLine)>=ur)&&(e.heightChanged=!0),c}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class oy extends _e{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,r){let s=i+this.left.height;return e<s?this.left.blockAt(e,t,i,r):this.right.blockAt(e,t,s,r+this.left.length+this.break)}lineAt(e,t,i,r,s){let o=r+this.left.height,l=s+this.left.length+this.break,a=t==X.ByHeight?e<o:e<l,c=a?this.left.lineAt(e,t,i,r,s):this.right.lineAt(e,t,i,o,l);if(this.break||(a?c.to<l:c.from>l))return c;let h=t==X.ByPosNoHeight?X.ByPosNoHeight:X.ByPos;return a?c.join(this.right.lineAt(l,h,i,o,l)):this.left.lineAt(l,h,i,r,s).join(c)}forEachLine(e,t,i,r,s,o){let l=r+this.left.height,a=s+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,r,s,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let c=this.lineAt(a,X.ByPos,i,r,s);e<c.from&&this.left.forEachLine(e,c.from-1,i,r,s,o),c.to>=e&&c.from<=t&&o(c),t>c.to&&this.right.forEachLine(c.to+1,t,i,l,a,o)}}replace(e,t,i){let r=this.left.length+this.break;if(t<r)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-r,t-r,i));let s=[];e>0&&this.decomposeLeft(e,s);let o=s.length;for(let l of i)s.push(l);if(e>0&&Pa(s,o-1),t<this.length){let l=s.length;this.decomposeRight(t,s),Pa(s,l)}return _e.of(s)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,r=i+this.break;if(e>=r)return this.right.decomposeRight(e-r,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<r&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?_e.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,r){let{left:s,right:o}=this,l=t+s.length+this.break,a=null;return r&&r.from<=t+s.length&&r.more?a=s=s.updateHeight(e,t,i,r):s.updateHeight(e,t,i),r&&r.from<=l+o.length&&r.more?a=o=o.updateHeight(e,l,i,r):o.updateHeight(e,l,i),a?this.balanced(s,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function Pa(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof be&&(i=n[e+1])instanceof be&&n.splice(e-1,3,new be(t.length+1+i.length))}const ly=5;class cl{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),r=this.nodes[this.nodes.length-1];r instanceof Ve?r.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Ve(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let r=i.widget?i.widget.estimatedHeight:0,s=i.widget?i.widget.lineBreaks:0;r<0&&(r=this.oracle.lineHeight);let o=t-e;i.block?this.addBlock(new du(o,r,i)):(o||s||r>=ly)&&this.addLineDeco(r,s,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Ve(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new be(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Ve)return e;let t=new Ve(0,-1);return this.nodes.push(t),t}addBlock(e){var t;this.enterLine();let i=(t=e.deco)===null||t===void 0?void 0:t.type;i==Se.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,i!=Se.WidgetBefore&&(this.covering=e)}addLineDeco(e,t,i){let r=this.ensureLine();r.length+=i,r.collapsed+=i,r.widgetHeight=Math.max(r.widgetHeight,e),r.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof Ve)&&!this.isCovered?this.nodes.push(new Ve(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let r of this.nodes)r instanceof Ve&&r.updateHeight(this.oracle,i),i+=r?r.length:1;return this.nodes}static build(e,t,i,r){let s=new cl(i,e);return le.spans(t,i,r,s,0),s.finish(i)}}function ay(n,e,t){let i=new cy;return le.compare(n,e,t,i,0),i.changes}class cy{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,r){(e<t||i&&i.heightRelevant||r&&r.heightRelevant)&&ko(e,t,this.changes,5)}}function hy(n,e){let t=n.getBoundingClientRect(),i=n.ownerDocument,r=i.defaultView||window,s=Math.max(0,t.left),o=Math.min(r.innerWidth,t.right),l=Math.max(0,t.top),a=Math.min(r.innerHeight,t.bottom);for(let c=n.parentNode;c&&c!=i.body;)if(c.nodeType==1){let h=c,u=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&u.overflow!="visible"){let f=h.getBoundingClientRect();s=Math.max(s,f.left),o=Math.min(o,f.right),l=Math.max(l,f.top),a=c==n.parentNode?f.bottom:Math.min(a,f.bottom)}c=u.position=="absolute"||u.position=="fixed"?h.offsetParent:h.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:s-t.left,right:Math.max(s,o)-t.left,top:l-(t.top+e),bottom:Math.max(l,a)-(t.top+e)}}function uy(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class _s{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let r=e[i],s=t[i];if(r.from!=s.from||r.to!=s.to||r.size!=s.size)return!1}return!0}draw(e){return ne.replace({widget:new fy(this.size,e)}).range(this.from,this.to)}}class fy extends Pi{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class La{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Ba,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=ye.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(ll).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new ry(t),this.stateDeco=e.facet(Ci).filter(i=>typeof i!="function"),this.heightMap=_e.empty().applyChanges(this.stateDeco,U.empty,this.heightOracle.setDoc(e.doc),[new ft(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ne.set(this.lineGaps.map(i=>i.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let r=i?t.head:t.anchor;if(!e.some(({from:s,to:o})=>r>=s&&r<=o)){let{from:s,to:o}=this.lineBlockAt(r);e.push(new ji(s,o))}}this.viewports=e.sort((i,r)=>i.from-r.from),this.scaler=this.heightMap.height<=7e6?Ba:new my(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:ti(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ci).filter(h=>typeof h!="function");let r=e.changedRanges,s=ft.extendWithRanges(r,ay(i,this.stateDeco,e?e.changes:ge.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),s),this.heightMap.height!=o&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let a=s.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let c=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),c&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(vg)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),r=this.heightOracle,s=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?ye.RTL:ye.LTR;let o=this.heightOracle.mustRefreshForWrapping(s),l=t.getBoundingClientRect(),a=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let c=0,h=0,u=parseInt(i.paddingTop)||0,f=parseInt(i.paddingBottom)||0;(this.paddingTop!=u||this.paddingBottom!=f)&&(this.paddingTop=u,this.paddingBottom=f,c|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(r.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=8),this.scrollTop!=e.scrollDOM.scrollTop&&(this.scrollAnchorHeight=-1,this.scrollTop=e.scrollDOM.scrollTop),this.scrolledToBottom=Mh(e.scrollDOM);let d=(this.printing?uy:hy)(t,this.paddingTop),p=d.top-this.pixelViewport.top,g=d.bottom-this.pixelViewport.bottom;this.pixelViewport=d;let y=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(y!=this.inView&&(this.inView=y,y&&(a=!0)),!this.inView&&!this.scrollTarget)return 0;let b=l.width;if((this.contentDOMWidth!=b||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,c|=8),a){let A=e.docView.measureVisibleLineHeights(this.viewport);if(r.mustRefreshForHeights(A)&&(o=!0),o||r.lineWrapping&&Math.abs(b-this.contentDOMWidth)>r.charWidth){let{lineHeight:k,charWidth:E,textHeight:N}=e.docView.measureTextSize();o=k>0&&r.refresh(s,k,E,N,b/E,A),o&&(e.docView.minWidth=0,c|=8)}p>0&&g>0?h=Math.max(p,g):p<0&&g<0&&(h=Math.min(p,g)),r.heightChanged=!1;for(let k of this.viewports){let E=k.from==this.viewport.from?A:e.docView.measureVisibleLineHeights(k);this.heightMap=(o?_e.empty().applyChanges(this.stateDeco,U.empty,this.heightOracle,[new ft(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(r,0,o,new sy(k.from,E))}r.heightChanged&&(c|=2)}let v=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return v&&(this.viewport=this.getViewport(h,this.scrollTarget)),this.updateForViewport(),(c&2||v)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),r=this.heightMap,s=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,a=new ji(r.lineAt(o-i*1e3,X.ByHeight,s,0,0).from,r.lineAt(l+(1-i)*1e3,X.ByHeight,s,0,0).to);if(t){let{head:c}=t.range;if(c<a.from||c>a.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=r.lineAt(c,X.ByPos,s,0,0),f;t.y=="center"?f=(u.top+u.bottom)/2-h/2:t.y=="start"||t.y=="nearest"&&c<a.from?f=u.top:f=u.bottom-h,a=new ji(r.lineAt(f-1e3/2,X.ByHeight,s,0,0).from,r.lineAt(f+h+1e3/2,X.ByHeight,s,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),r=t.mapPos(e.to,1);return new ji(this.heightMap.lineAt(i,X.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(r,X.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:r}=this.heightMap.lineAt(e,X.ByPos,this.heightOracle,0,0),{bottom:s}=this.heightMap.lineAt(t,X.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||r<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||s>=l+Math.max(10,Math.min(i,250)))&&r>o-2*1e3&&s<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let r of e)t.touchesRange(r.from,r.to)||i.push(new _s(t.mapPos(r.from),t.mapPos(r.to),r.size));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,r=i?1e4:2e3,s=r>>1,o=r<<1;if(this.defaultTextDirection!=ye.LTR&&!i)return[];let l=[],a=(c,h,u,f)=>{if(h-c<s)return;let d=this.state.selection.main,p=[d.from];d.empty||p.push(d.to);for(let y of p)if(y>c&&y<h){a(c,y-10,u,f),a(y+10,h,u,f);return}let g=py(e,y=>y.from>=u.from&&y.to<=u.to&&Math.abs(y.from-c)<s&&Math.abs(y.to-h)<s&&!p.some(b=>y.from<b&&y.to>b));if(!g){if(h<u.to&&t&&i&&t.visibleRanges.some(y=>y.from<=h&&y.to>=h)){let y=t.moveToLineBoundary(x.cursor(h),!1,!0).head;y>c&&(h=y)}g=new _s(c,h,this.gapSize(u,c,h,f))}l.push(g)};for(let c of this.viewportLines){if(c.length<o)continue;let h=dy(c.from,c.to,this.stateDeco);if(h.total<o)continue;let u=this.scrollTarget?this.scrollTarget.range.head:null,f,d;if(i){let p=r/this.heightOracle.lineLength*this.heightOracle.lineHeight,g,y;if(u!=null){let b=Zi(h,u),v=((this.visibleBottom-this.visibleTop)/2+p)/c.height;g=b-v,y=b+v}else g=(this.visibleTop-c.top-p)/c.height,y=(this.visibleBottom-c.top+p)/c.height;f=Ui(h,g),d=Ui(h,y)}else{let p=h.total*this.heightOracle.charWidth,g=r*this.heightOracle.charWidth,y,b;if(u!=null){let v=Zi(h,u),A=((this.pixelViewport.right-this.pixelViewport.left)/2+g)/p;y=v-A,b=v+A}else y=(this.pixelViewport.left-g)/p,b=(this.pixelViewport.right+g)/p;f=Ui(h,y),d=Ui(h,b)}f>c.from&&a(c.from,f,c,h),d<c.to&&a(d,c.to,c,h)}return l}gapSize(e,t,i,r){let s=Zi(r,i)-Zi(r,t);return this.heightOracle.lineWrapping?e.height*s:r.total*this.heightOracle.charWidth*s}updateLineGaps(e){_s.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=ne.set(e.map(t=>t.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];le.spans(e,this.viewport.from,this.viewport.to,{span(r,s){t.push({from:r,to:s})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((r,s)=>r.from!=t[s].from||r.to!=t[s].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||ti(this.heightMap.lineAt(e,X.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return ti(this.heightMap.lineAt(this.scaler.fromDOM(e),X.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return ti(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class ji{constructor(e,t){this.from=e,this.to=t}}function dy(n,e,t){let i=[],r=n,s=0;return le.spans(t,n,e,{span(){},point(o,l){o>r&&(i.push({from:r,to:o}),s+=o-r),r=l}},20),r<e&&(i.push({from:r,to:e}),s+=e-r),{total:s,ranges:i}}function Ui({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let r=0;;r++){let{from:s,to:o}=e[r],l=o-s;if(i<=l)return s+i;i-=l}}function Zi(n,e){let t=0;for(let{from:i,to:r}of n.ranges){if(e<=r){t+=e-i;break}t+=r-i}return t/n.total}function py(n,e){for(let t of n)if(e(t))return t}const Ba={toDOM(n){return n},fromDOM(n){return n},scale:1};class my{constructor(e,t,i){let r=0,s=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let c=t.lineAt(l,X.ByPos,e,0,0).top,h=t.lineAt(a,X.ByPos,e,0,0).bottom;return r+=h-c,{from:l,to:a,top:c,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-r)/(t.height-r);for(let l of this.viewports)l.domTop=o+(l.top-s)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),s=l.bottom}toDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.top)return r+(e-i)*this.scale;if(e<=s.bottom)return s.domTop+(e-s.top);i=s.bottom,r=s.domBottom}}fromDOM(e){for(let t=0,i=0,r=0;;t++){let s=t<this.viewports.length?this.viewports[t]:null;if(!s||e<s.domTop)return i+(e-r)/this.scale;if(e<=s.domBottom)return s.top+(e-s.domTop);i=s.bottom,r=s.domBottom}}}function ti(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new ot(n.from,n.length,t,i-t,Array.isArray(n._content)?n._content.map(r=>ti(r,e)):n._content)}const qi=P.define({combine:n=>n.join(" ")}),Oo=P.define({combine:n=>n.indexOf(!0)>-1}),No=Ht.newName(),pu=Ht.newName(),mu=Ht.newName(),gu={"&light":"."+pu,"&dark":"."+mu};function Eo(n,e,t){return new Ht(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,r=>{if(r=="&")return n;if(!t||!t[r])throw new RangeError(`Unsupported selector: ${r}`);return t[r]}):n+" "+i}})}const gy=Eo("."+No,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},gu);class yy{constructor(e,t,i,r){this.typeOver=r,this.bounds=null,this.text="";let{impreciseHead:s,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let l=s||o?[]:wy(e),a=new eu(l,e.state);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=vy(l,this.bounds.from)}else{let l=e.observer.selectionRange,a=s&&s.node==l.focusNode&&s.offset==l.focusOffset||!Ln(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),c=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!Ln(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset);this.newSel=x.single(c,a)}}}function yu(n,e){let t,{newSel:i}=e,r=n.state.selection.main,s=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:l}=e.bounds,a=r.from,c=null;(s===8||M.android&&e.text.length<l-o)&&(a=r.to,c="end");let h=by(n.state.doc.sliceString(o,l,xn),e.text,a-o,c);h&&(M.chrome&&s==13&&h.toB==h.from+2&&e.text.slice(h.from,h.toB)==xn+xn&&h.toB--,t={from:o+h.from,to:o+h.toA,insert:U.of(e.text.slice(h.from,h.toB).split(xn))})}else i&&(!n.hasFocus&&n.state.facet(cs)||i.main.eq(r))&&(i=null);if(!t&&!i)return!1;if(!t&&e.typeOver&&!r.empty&&i&&i.main.empty?t={from:r.from,to:r.to,insert:n.state.doc.slice(r.from,r.to)}:t&&t.from>=r.from&&t.to<=r.to&&(t.from!=r.from||t.to!=r.to)&&r.to-r.from-(t.to-t.from)<=4?t={from:r.from,to:r.to,insert:n.state.doc.slice(r.from,t.from).append(t.insert).append(n.state.doc.slice(t.to,r.to))}:(M.mac||M.android)&&t&&t.from==t.to&&t.from==r.head-1&&/^\. ?$/.test(t.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(i&&t.insert.length==2&&(i=x.single(i.main.anchor-1,i.main.head-1)),t={from:r.from,to:r.to,insert:U.of([" "])}):M.chrome&&t&&t.from==t.to&&t.from==r.head&&t.insert.toString()==`
 `&&n.lineWrapping&&(i&&(i=x.single(i.main.anchor-1,i.main.head-1)),t={from:r.from,to:r.to,insert:U.of([" "])}),t){let o=n.state;if(M.ios&&n.inputState.flushIOSKey(n)||M.android&&(t.from==r.from&&t.to==r.to&&t.insert.length==1&&t.insert.lines==2&&Mn(n.contentDOM,"Enter",13)||(t.from==r.from-1&&t.to==r.to&&t.insert.length==0||s==8&&t.insert.length<t.to-t.from)&&Mn(n.contentDOM,"Backspace",8)||t.from==r.from&&t.to==r.to+1&&t.insert.length==0&&Mn(n.contentDOM,"Delete",46)))return!0;let l=t.insert.toString();if(n.state.facet(Uh).some(h=>h(n,t.from,t.to,l)))return!0;n.inputState.composing>=0&&n.inputState.composing++;let a;if(t.from>=r.from&&t.to<=r.to&&t.to-t.from>=(r.to-r.from)/3&&(!i||i.main.empty&&i.main.from==t.from+t.insert.length)&&n.inputState.composing<0){let h=r.from<t.from?o.sliceDoc(r.from,t.from):"",u=r.to>t.to?o.sliceDoc(t.to,r.to):"";a=o.replaceSelection(n.state.toText(h+t.insert.sliceString(0,void 0,n.state.lineBreak)+u))}else{let h=o.changes(t),u=i&&i.main.to<=h.newLength?i.main:void 0;if(o.selection.ranges.length>1&&n.inputState.composing>=0&&t.to<=r.to&&t.to>=r.to-10){let f=n.state.sliceDoc(t.from,t.to),d=tu(n)||n.state.doc.lineAt(r.head),p=r.to-t.to,g=r.to-r.from;a=o.changeByRange(y=>{if(y.from==r.from&&y.to==r.to)return{changes:h,range:u||y.map(h)};let b=y.to-p,v=b-f.length;if(y.to-y.from!=g||n.state.sliceDoc(v,b)!=f||d&&y.to>=d.from&&y.from<=d.to)return{range:y};let A=o.changes({from:v,to:b,insert:t.insert}),k=y.to-r.to;return{changes:A,range:u?x.range(Math.max(0,u.anchor+k),Math.max(0,u.head+k)):y.map(A)}})}else a={changes:h,selection:u&&o.selection.replaceRange(u)}}let c="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,c+=".compose",n.inputState.compositionFirstChange&&(c+=".start",n.inputState.compositionFirstChange=!1)),n.dispatch(a,{scrollIntoView:!0,userEvent:c}),!0}else if(i&&!i.main.eq(r)){let o=!1,l="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(o=!0),l=n.inputState.lastSelectionOrigin),n.dispatch({selection:i,scrollIntoView:o,userEvent:l}),!0}else return!1}function by(n,e,t,i){let r=Math.min(n.length,e.length),s=0;for(;s<r&&n.charCodeAt(s)==e.charCodeAt(s);)s++;if(s==r&&n.length==e.length)return null;let o=n.length,l=e.length;for(;o>0&&l>0&&n.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,s-Math.min(o,l));t-=o+a-s}if(o<s&&n.length<e.length){let a=t<=s&&t>=o?s-t:0;s-=a,l=s+(l-o),o=s}else if(l<s){let a=t<=s&&t>=l?s-t:0;s-=a,o=s+(o-l),l=s}return{from:s,toA:o,toB:l}}function wy(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:r,focusOffset:s}=n.observer.selectionRange;return t&&(e.push(new ga(t,i)),(r!=t||s!=i)&&e.push(new ga(r,s))),e}function vy(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?x.single(t+e,i+e):null}const ky={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Ps=M.ie&&M.ie_version<=11;class xy{constructor(e){this.view=e,this.active=!1,this.selectionRange=new pg,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.resizeContent=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let i of t)this.queue.push(i);(M.ie&&M.ie_version<=11||M.ios&&e.composing)&&t.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Ps&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM),this.resizeContent=new ResizeObserver(()=>this.view.requestMeasure()),this.resizeContent.observe(e.contentDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,r=this.selectionRange;if(i.state.facet(cs)?i.root.activeElement!=this.dom:!cr(i.dom,r))return;let s=r.anchorNode&&i.docView.nearest(r.anchorNode);if(s&&s.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(M.ie&&M.ie_version<=11||M.android&&M.chrome)&&!i.state.selection.main.empty&&r.focusNode&&Vr(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=M.safari&&e.root.nodeType==11&&hg(this.dom.ownerDocument)==this.dom&&Sy(this.view)||$r(e.root);if(!t||this.selectionRange.eq(t))return!1;let i=cr(this.dom,t);return i&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&gg(this.dom,t)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(t),i&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,ky),Ps&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Ps&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let r=()=>{let s=this.delayedAndroidKey;s&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=s.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&s.force&&Mn(this.dom,s.key,s.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(r)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,r=!1;for(let s of e){let o=this.readMutation(s);o&&(o.typeOver&&(r=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:r}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),r=this.selectionChanged&&cr(this.dom,this.selectionRange);return e<0&&!r?null:(e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new yy(this.view,e,t,i))}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return!1;let i=this.view.state,r=yu(this.view,t);return this.view.state==i&&this.view.update([]),r}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.dirty|=4),e.type=="childList"){let i=Ia(t,e.previousSibling||e.target.previousSibling,-1),r=Ia(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:r?t.posBefore(r):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,t,i,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect(),(r=this.resizeContent)===null||r===void 0||r.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function Ia(n,e,t){for(;e;){let i=J.get(e);if(i&&i.parent==n)return i;let r=e.parentNode;e=r!=n.dom?r:t>0?e.nextSibling:e.previousSibling}return null}function Sy(n){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(n.contentDOM.addEventListener("beforeinput",t,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,r=e.startOffset,s=e.endContainer,o=e.endOffset,l=n.docView.domAtPos(n.state.selection.main.anchor);return Vr(l.node,l.offset,s,o)&&([i,r,s,o]=[s,o,i,r]),{anchorNode:i,anchorOffset:r,focusNode:s,focusOffset:o}}class R{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: fixed; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(t=>this.update([t])),this.dispatch=this.dispatch.bind(this),this._root=e.root||mg(e.parent)||document,this.viewState=new La(e.state||Z.create(e)),this.plugins=this.state.facet(Xn).map(t=>new Ns(t));for(let t of this.plugins)t.update(this);this.observer=new xy(this),this.inputState=new Ug(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new ya(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...e){let t=e.length==1&&e[0]instanceof Ae?e[0]:this.state.update(...e);this._dispatch(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i=!1,r,s=this.state;for(let f of e){if(f.startState!=s)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");s=f.state}if(this.destroyed){this.viewState.state=s;return}let o=this.hasFocus,l=0,a=null;e.some(f=>f.annotation(hu))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,a=uu(s,o),a||(l=1));let c=this.observer.delayedAndroidKey,h=null;if(c?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(s.doc)||!this.state.selection.eq(s.selection))&&(h=null)):this.observer.clear(),s.facet(Z.phrases)!=this.state.facet(Z.phrases))return this.setState(s);r=zr.create(this,s,e),r.flags|=l;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let f of e){if(u&&(u=u.map(f.changes)),f.scrollIntoView){let{main:d}=f.state.selection;u=new Hr(d.empty?d:x.cursor(d.head,d.head>d.anchor?-1:1))}for(let d of f.effects)d.is(pa)&&(u=d.value)}this.viewState.update(r,u),this.bidiCache=Wr.update(this.bidiCache,r.changes),r.empty||(this.updatePlugins(r),this.inputState.update(r)),t=this.docView.update(r),this.state.facet(Qn)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(r.startState.facet(qi)!=r.state.facet(qi)&&(this.viewState.mustMeasureContent=!0),(t||i||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!r.empty)for(let f of this.state.facet(xo))f(r);(a||h)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),h&&!yu(this,h)&&c.force&&Mn(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new La(e),this.plugins=e.facet(Xn).map(i=>new Ns(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView=new ya(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Xn),i=e.state.facet(Xn);if(t!=i){let r=[];for(let s of i){let o=t.indexOf(s);if(o<0)r.push(new Ns(s));else{let l=this.plugins[o];l.mustUpdate=e,r.push(l)}}for(let s of this.plugins)s.mustUpdate!=e&&s.destroy(this);this.plugins=r,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let r of this.plugins)r.mustUpdate=e;for(let r=0;r<this.plugins.length;r++)this.plugins[r].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,{scrollTop:r}=i,{scrollAnchorPos:s,scrollAnchorHeight:o}=this.viewState;r!=this.viewState.scrollTop&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if(Mh(i))s=-1,o=this.viewState.heightMap.height;else{let d=this.viewState.scrollAnchorAt(r);s=d.from,o=d.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];a&4||([this.measureRequests,c]=[c,this.measureRequests]);let h=c.map(d=>{try{return d.read(this)}catch(p){return ut(this.state,p),Ra}}),u=zr.create(this,this.state,[]),f=!1;u.flags|=a,t?t.flags|=a:t=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),f=this.docView.update(u));for(let d=0;d<c.length;d++)if(h[d]!=Ra)try{let p=c[d];p.write&&p.write(h[d],this)}catch(p){ut(this.state,p)}if(f&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null;continue}else{let p=(s<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(s).top)-o;if(p>1||p<-1){r=i.scrollTop=r+p,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(xo))l(t)}get themeClasses(){return No+" "+(this.state.facet(Oo)?mu:pu)+" "+this.state.facet(qi)}updateAttrs(){let e=$a(this,Kh,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(cs)?"true":"false",class:"cm-content",style:`${M.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),$a(this,ll,t);let i=this.observer.ignore(()=>{let r=vo(this.contentDOM,this.contentAttrs,t),s=vo(this.dom,this.editorAttrs,e);return r||s});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let r of i.effects)if(r.is(R.announce)){t&&(this.announceDOM.textContent=""),t=!1;let s=this.announceDOM.appendChild(document.createElement("div"));s.textContent=r.value}}mountStyles(){this.styleModules=this.state.facet(Qn),Ht.mount(this.root,this.styleModules.concat(gy).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Ds(this,e,Sa(this,e,t,i))}moveByGroup(e,t){return Ds(this,e,Sa(this,e,t,i=>Wg(this,e.head,i)))}moveToLineBoundary(e,t,i=!0){return zg(this,e,t,i)}moveVertically(e,t,i){return Ds(this,e,jg(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),iu(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let r=this.state.doc.lineAt(e),s=this.bidiSpans(r),o=s[On.find(s,e-r.from,-1,t)];return il(i,o.dir==ye.LTR==t>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(qh)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>Ty)return Xh(e.length);let t=this.textDirectionAt(e.from);for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t)return r.order;let i=Mg(e.text,t);return this.bidiCache.push(new Wr(e.from,e.to,t,i)),i}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||M.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{Ah(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return pa.of(new Hr(typeof e=="number"?x.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}static domEventHandlers(e){return Ge.define(()=>({}),{eventHandlers:e})}static theme(e,t){let i=Ht.newName(),r=[qi.of(i),Qn.of(Eo(`.${i}`,e))];return t&&t.dark&&r.push(Oo.of(!0)),r}static baseTheme(e){return el.lowest(Qn.of(Eo("."+No,e,gu)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),r=i&&J.get(i)||J.get(e);return((t=r?.rootView)===null||t===void 0?void 0:t.view)||null}}R.styleModule=Qn;R.inputHandler=Uh;R.focusChangeEffect=Zh;R.perLineTextDirection=qh;R.exceptionSink=jh;R.updateListener=xo;R.editable=cs;R.mouseSelectionStyle=Wh;R.dragMovesSelection=zh;R.clickAddsSelectionRange=Hh;R.decorations=Ci;R.atomicRanges=al;R.scrollMargins=Gh;R.darkTheme=Oo;R.contentAttributes=ll;R.editorAttributes=Kh;R.lineWrapping=R.contentAttributes.of({class:"cm-lineWrapping"});R.announce=te.define();const Ty=4096,Ra={};class Wr{constructor(e,t,i,r){this.from=e,this.to=t,this.dir=i,this.order=r}static update(e,t){if(t.empty)return e;let i=[],r=e.length?e[e.length-1].dir:ye.LTR;for(let s=Math.max(0,e.length-10);s<e.length;s++){let o=e[s];o.dir==r&&!t.touchesRange(o.from,o.to)&&i.push(new Wr(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.order))}return i}}function $a(n,e,t){for(let i=n.state.facet(e),r=i.length-1;r>=0;r--){let s=i[r],o=typeof s=="function"?s(n):s;o&&wo(o,t)}return t}const Ay=M.mac?"mac":M.windows?"win":M.linux?"linux":"key";function Cy(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let r,s,o,l;for(let a=0;a<t.length-1;++a){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))l=!0;else if(/^a(lt)?$/i.test(c))r=!0;else if(/^(c|ctrl|control)$/i.test(c))s=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))e=="mac"?l=!0:s=!0;else throw new Error("Unrecognized modifier name: "+c)}return r&&(i="Alt-"+i),s&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function Ki(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const My=el.default(R.domEventHandlers({keydown(n,e){return Dy(Oy(e.state),n,e,"editor")}})),bu=P.define({enables:My}),Va=new WeakMap;function Oy(n){let e=n.facet(bu),t=Va.get(e);return t||Va.set(e,t=Ey(e.reduce((i,r)=>i.concat(r),[]))),t}let _t=null;const Ny=4e3;function Ey(n,e=Ay){let t=Object.create(null),i=Object.create(null),r=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},s=(o,l,a,c)=>{var h,u;let f=t[o]||(t[o]=Object.create(null)),d=l.split(/ (?!$)/).map(y=>Cy(y,e));for(let y=1;y<d.length;y++){let b=d.slice(0,y).join(" ");r(b,!0),f[b]||(f[b]={preventDefault:!0,run:[v=>{let A=_t={view:v,prefix:b,scope:o};return setTimeout(()=>{_t==A&&(_t=null)},Ny),!0}]})}let p=d.join(" ");r(p,!1);let g=f[p]||(f[p]={preventDefault:!1,run:((u=(h=f._any)===null||h===void 0?void 0:h.run)===null||u===void 0?void 0:u.slice())||[]});a&&g.run.push(a),c&&(g.preventDefault=!0)};for(let o of n){let l=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let c of l){let h=t[c]||(t[c]=Object.create(null));h._any||(h._any={preventDefault:!1,run:[]});for(let u in h)h[u].run.push(o.any)}let a=o[e]||o.key;if(a)for(let c of l)s(c,a,o.run,o.preventDefault),o.shift&&s(c,"Shift-"+a,o.shift,o.preventDefault)}return t}function Dy(n,e,t,i){let r=cg(e),s=lr(r,0),o=eo(s)==r.length&&r!=" ",l="",a=!1;_t&&_t.view==t&&_t.scope==i&&(l=_t.prefix+" ",(a=su.indexOf(e.keyCode)<0)&&(_t=null));let c=new Set,h=p=>{if(p){for(let g of p.run)if(!c.has(g)&&(c.add(g),g(t,e)))return!0;p.preventDefault&&(a=!0)}return!1},u=n[i],f,d;if(u){if(h(u[l+Ki(r,e,!o)]))return!0;if(o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(M.windows&&e.ctrlKey&&e.altKey)&&(f=zt[e.keyCode])&&f!=r){if(h(u[l+Ki(f,e,!0)]))return!0;if(e.shiftKey&&(d=Ti[e.keyCode])!=r&&d!=f&&h(u[l+Ki(d,e,!1)]))return!0}else if(o&&e.shiftKey&&h(u[l+Ki(r,e,!0)]))return!0;if(h(u._any))return!0}return a}const _y=!M.ios,Py={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};_y&&(Py[".cm-line"].caretColor="transparent !important");const Gi="-10000px";class wu{constructor(e,t,i){this.facet=t,this.createTooltipView=i,this.input=e.state.facet(t),this.tooltips=this.input.filter(r=>r),this.tooltipViews=this.tooltips.map(i)}update(e){var t;let i=e.state.facet(this.facet),r=i.filter(o=>o);if(i===this.input){for(let o of this.tooltipViews)o.update&&o.update(e);return!1}let s=[];for(let o=0;o<r.length;o++){let l=r[o],a=-1;if(l){for(let c=0;c<this.tooltips.length;c++){let h=this.tooltips[c];h&&h.create==l.create&&(a=c)}if(a<0)s[o]=this.createTooltipView(l);else{let c=s[o]=this.tooltipViews[a];c.update&&c.update(e)}}}for(let o of this.tooltipViews)s.indexOf(o)<0&&(o.dom.remove(),(t=o.destroy)===null||t===void 0||t.call(o));return this.input=i,this.tooltips=r,this.tooltipViews=s,!0}}function Ly(n){let{win:e}=n;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const Ls=P.define({combine:n=>{var e,t,i;return{position:M.ios?"absolute":((e=n.find(r=>r.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=n.find(r=>r.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((i=n.find(r=>r.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||Ly}}}),Fa=new WeakMap,By=Ge.fromClass(class{constructor(n){this.view=n,this.inView=!0,this.lastTransaction=0,this.measureTimeout=-1;let e=n.state.facet(Ls);this.position=e.position,this.parent=e.parent,this.classes=n.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.manager=new wu(n,vu,t=>this.createTooltip(t)),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),n.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let n of this.manager.tooltipViews)this.intersectionObserver.observe(n.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(n){n.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(n);e&&this.observeIntersection();let t=e||n.geometryChanged,i=n.state.facet(Ls);if(i.position!=this.position){this.position=i.position;for(let r of this.manager.tooltipViews)r.dom.style.position=this.position;t=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let r of this.manager.tooltipViews)this.container.appendChild(r.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(n){let e=n.create(this.view);if(e.dom.classList.add("cm-tooltip"),n.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let t=document.createElement("div");t.className="cm-tooltip-arrow",e.dom.appendChild(t)}return e.dom.style.position=this.position,e.dom.style.top=Gi,this.container.appendChild(e.dom),e.mount&&e.mount(this.view),e}destroy(){var n,e;this.view.win.removeEventListener("resize",this.measureSoon);for(let t of this.manager.tooltipViews)t.dom.remove(),(n=t.destroy)===null||n===void 0||n.call(t);(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let n=this.view.dom.getBoundingClientRect();return{editor:n,parent:this.parent?this.container.getBoundingClientRect():n,pos:this.manager.tooltips.map((e,t)=>{let i=this.manager.tooltipViews[t];return i.getCoords?i.getCoords(e.pos):this.view.coordsAtPos(e.pos)}),size:this.manager.tooltipViews.map(({dom:e})=>e.getBoundingClientRect()),space:this.view.state.facet(Ls).tooltipSpace(this.view)}}writeMeasure(n){var e;let{editor:t,space:i}=n,r=[];for(let s=0;s<this.manager.tooltips.length;s++){let o=this.manager.tooltips[s],l=this.manager.tooltipViews[s],{dom:a}=l,c=n.pos[s],h=n.size[s];if(!c||c.bottom<=Math.max(t.top,i.top)||c.top>=Math.min(t.bottom,i.bottom)||c.right<Math.max(t.left,i.left)-.1||c.left>Math.min(t.right,i.right)+.1){a.style.top=Gi;continue}let u=o.arrow?l.dom.querySelector(".cm-tooltip-arrow"):null,f=u?7:0,d=h.right-h.left,p=(e=Fa.get(l))!==null&&e!==void 0?e:h.bottom-h.top,g=l.offset||Ry,y=this.view.textDirection==ye.LTR,b=h.width>i.right-i.left?y?i.left:i.right-h.width:y?Math.min(c.left-(u?14:0)+g.x,i.right-d):Math.max(i.left,c.left-d+(u?14:0)-g.x),v=!!o.above;!o.strictSide&&(v?c.top-(h.bottom-h.top)-g.y<i.top:c.bottom+(h.bottom-h.top)+g.y>i.bottom)&&v==i.bottom-c.bottom>c.top-i.top&&(v=!v);let A=(v?c.top-i.top:i.bottom-c.bottom)-f;if(A<p&&l.resize!==!1){if(A<this.view.defaultLineHeight){a.style.top=Gi;continue}Fa.set(l,p),a.style.height=(p=A)+"px"}else a.style.height&&(a.style.height="");let k=v?c.top-p-f-g.y:c.bottom+f+g.y,E=b+d;if(l.overlap!==!0)for(let N of r)N.left<E&&N.right>b&&N.top<k+p&&N.bottom>k&&(k=v?N.top-p-2-f:N.bottom+f+2);this.position=="absolute"?(a.style.top=k-n.parent.top+"px",a.style.left=b-n.parent.left+"px"):(a.style.top=k+"px",a.style.left=b+"px"),u&&(u.style.left=`${c.left+(y?g.x:-g.x)-(b+14-7)}px`),l.overlap!==!0&&r.push({left:b,top:k,right:E,bottom:k+p}),a.classList.toggle("cm-tooltip-above",v),a.classList.toggle("cm-tooltip-below",!v),l.positioned&&l.positioned(n.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let n of this.manager.tooltipViews)n.dom.style.top=Gi}},{eventHandlers:{scroll(){this.maybeMeasure()}}}),Iy=R.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),Ry={x:0,y:0},vu=P.define({enables:[By,Iy]}),jr=P.define();class hl{constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new wu(e,jr,t=>this.createHostedView(t))}static create(e){return new hl(e)}createHostedView(e){let t=e.create(this.view);return t.dom.classList.add("cm-tooltip-section"),this.dom.appendChild(t.dom),this.mounted&&t.mount&&t.mount(this.view),t}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)(e=t.destroy)===null||e===void 0||e.call(t)}}const $y=vu.compute([jr],n=>{let e=n.facet(jr).filter(t=>t);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.filter(t=>t.end!=null).map(t=>t.end)),create:hl.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class Vy{constructor(e,t,i,r,s){this.view=e,this.source=t,this.field=i,this.setHover=r,this.hoverTime=s,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{lastMove:e}=this,t=this.view.contentDOM.contains(e.target)?this.view.posAtCoords(e):null;if(t==null)return;let i=this.view.coordsAtPos(t);if(i==null||e.y<i.top||e.y>i.bottom||e.x<i.left-this.view.defaultCharacterWidth||e.x>i.right+this.view.defaultCharacterWidth)return;let r=this.view.bidiSpans(this.view.state.doc.lineAt(t)).find(l=>l.from<=t&&l.to>=t),s=r&&r.dir==ye.RTL?-1:1,o=this.source(this.view,t,e.x<i.left?-s:s);if(o?.then){let l=this.pending={pos:t};o.then(a=>{this.pending==l&&(this.pending=null,a&&this.view.dispatch({effects:this.setHover.of(a)}))},a=>ut(this.view.state,a,"hover tooltip"))}else o&&this.view.dispatch({effects:this.setHover.of(o)})}mousemove(e){var t;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let i=this.active;if(i&&!Ha(this.lastMove.target)||this.pending){let{pos:r}=i||this.pending,s=(t=i?.end)!==null&&t!==void 0?t:r;(r==s?this.view.posAtCoords(this.lastMove)!=r:!Fy(this.view,r,s,e.clientX,e.clientY,6))&&(this.view.dispatch({effects:this.setHover.of(null)}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1,this.active&&!Ha(e.relatedTarget)&&this.view.dispatch({effects:this.setHover.of(null)})}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}function Ha(n){for(let e=n;e;e=e.parentNode)if(e.nodeType==1&&e.classList.contains("cm-tooltip"))return!0;return!1}function Fy(n,e,t,i,r,s){let o=document.createRange(),l=n.domAtPos(e),a=n.domAtPos(t);o.setEnd(a.node,a.offset),o.setStart(l.node,l.offset);let c=o.getClientRects();o.detach();for(let h=0;h<c.length;h++){let u=c[h];if(Math.max(u.top-r,r-u.bottom,u.left-i,i-u.right)<=s)return!0}return!1}function Hy(n,e={}){let t=te.define(),i=Mt.define({create(){return null},update(r,s){if(r&&(e.hideOnChange&&(s.docChanged||s.selection)||e.hideOn&&e.hideOn(s,r)))return null;if(r&&s.docChanged){let o=s.changes.mapPos(r.pos,-1,Be.TrackDel);if(o==null)return null;let l=Object.assign(Object.create(null),r);l.pos=o,r.end!=null&&(l.end=s.changes.mapPos(r.end)),r=l}for(let o of s.effects)o.is(t)&&(r=o.value),o.is(zy)&&(r=null);return r},provide:r=>jr.from(r)});return[i,Ge.define(r=>new Vy(r,n,i,t,e.hoverTime||300)),$y]}const zy=te.define(),za=P.define({combine(n){let e,t;for(let i of n)e=e||i.topContainer,t=t||i.bottomContainer;return{topContainer:e,bottomContainer:t}}}),Wy=Ge.fromClass(class{constructor(n){this.input=n.state.facet(Do),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(n));let e=n.state.facet(za);this.top=new Ji(n,!0,e.topContainer),this.bottom=new Ji(n,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(n){let e=n.state.facet(za);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Ji(n.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Ji(n.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=n.state.facet(Do);if(t!=this.input){let i=t.filter(a=>a),r=[],s=[],o=[],l=[];for(let a of i){let c=this.specs.indexOf(a),h;c<0?(h=a(n.view),l.push(h)):(h=this.panels[c],h.update&&h.update(n)),r.push(h),(h.top?s:o).push(h)}this.specs=i,this.panels=r,this.top.sync(s),this.bottom.sync(o);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let i of this.panels)i.update&&i.update(n)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:n=>R.scrollMargins.of(e=>{let t=e.plugin(n);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class Ji{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Wa(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Wa(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Wa(n){let e=n.nextSibling;return n.remove(),e}const Do=P.define({enables:Wy});class Rn extends Pn{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Rn.prototype.elementClass="";Rn.prototype.toDOM=void 0;Rn.prototype.mapMode=Be.TrackBefore;Rn.prototype.startSide=Rn.prototype.endSide=-1;Rn.prototype.point=!0;const jy=1024;let Uy=0;class Bs{constructor(e,t){this.from=e,this.to=t}}class W{constructor(e={}){this.id=Uy++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=We.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}W.closedBy=new W({deserialize:n=>n.split(" ")});W.openedBy=new W({deserialize:n=>n.split(" ")});W.group=new W({deserialize:n=>n.split(" ")});W.contextHash=new W({perNode:!0});W.lookAhead=new W({perNode:!0});W.mounted=new W({perNode:!0});const Zy=Object.create(null);class We{constructor(e,t,i,r=0){this.name=e,this.props=t,this.id=i,this.flags=r}static define(e){let t=e.props&&e.props.length?Object.create(null):Zy,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),r=new We(e.name||"",t,e.id,i);if(e.props){for(let s of e.props)if(Array.isArray(s)||(s=s(r)),s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[s[0].id]=s[1]}}return r}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(W.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let r of i.split(" "))t[r]=e[i];return i=>{for(let r=i.prop(W.group),s=-1;s<(r?r.length:0);s++){let o=t[s<0?i.name:r[s]];if(o)return o}}}}We.none=new We("",Object.create(null),0,8);const Yi=new WeakMap,ja=new WeakMap;var ke;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(ke||(ke={}));class Ce{constructor(e,t,i,r,s){if(this.type=e,this.children=t,this.positions=i,this.length=r,this.props=null,s&&s.length){this.props=Object.create(null);for(let[o,l]of s)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=this.prop(W.mounted);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let r=i.toString();r&&(t&&(t+=","),t+=r)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new qr(this.topNode,e)}cursorAt(e,t=0,i=0){let r=Yi.get(this)||this.topNode,s=new qr(r);return s.moveTo(e,t),Yi.set(this,s._tree),s}get topNode(){return new St(this,0,0,null)}resolve(e,t=0){let i=$n(Yi.get(this)||this.topNode,e,t,!1);return Yi.set(this,i),i}resolveInner(e,t=0){let i=$n(ja.get(this)||this.topNode,e,t,!0);return ja.set(this,i),i}iterate(e){let{enter:t,leave:i,from:r=0,to:s=this.length}=e,o=e.mode||0,l=(o&ke.IncludeAnonymous)>0;for(let a=this.cursor(o|ke.IncludeAnonymous);;){let c=!1;if(a.from<=s&&a.to>=r&&(!l&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;c=!0}for(;c&&i&&(l||!a.type.isAnonymous)&&i(a),!a.nextSibling();){if(!a.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:dl(We.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,r)=>new Ce(this.type,t,i,r,this.propValues),e.makeTree||((t,i,r)=>new Ce(We.none,t,i,r)))}static build(e){return Ky(e)}}Ce.empty=new Ce(We.none,[],[],0);class ul{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new ul(this.buffer,this.index)}}class pn{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return We.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],r=this.set.types[t],s=r.name;if(/\W/.test(s)&&!r.isError&&(s=JSON.stringify(s)),e+=4,i==e)return s;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return s+"("+o.join(",")+")"}findChild(e,t,i,r,s){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(ku(s,r,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i){let r=this.buffer,s=new Uint16Array(t-e),o=0;for(let l=e,a=0;l<t;){s[a++]=r[l++],s[a++]=r[l++]-i;let c=s[a++]=r[l++]-i;s[a++]=r[l++]-e,o=Math.max(o,c)}return new pn(s,o,this.set)}}function ku(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function xu(n,e){let t=n.childBefore(e);for(;t;){let i=t.lastChild;if(!i||i.to!=t.to)break;i.type.isError&&i.from==i.to?(n=t,t=i.prevSibling):t=i}return n}function $n(n,e,t,i){for(var r;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let o=!i&&n instanceof St&&n.index<0?null:n.parent;if(!o)return n;n=o}let s=i?0:ke.IgnoreOverlays;if(i)for(let o=n,l=o.parent;l;o=l,l=o.parent)o instanceof St&&o.index<0&&((r=l.enter(e,t,s))===null||r===void 0?void 0:r.from)!=o.from&&(n=l);for(;;){let o=n.enter(e,t,s);if(!o)return n;n=o}}class St{constructor(e,t,i,r){this._tree=e,this.from=t,this.index=i,this._parent=r}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,r,s=0){for(let o=this;;){for(let{children:l,positions:a}=o._tree,c=t>0?l.length:-1;e!=c;e+=t){let h=l[e],u=a[e]+o.from;if(ku(r,i,u,u+h.length)){if(h instanceof pn){if(s&ke.ExcludeBuffers)continue;let f=h.findChild(0,h.buffer.length,t,i-u,r);if(f>-1)return new Rt(new qy(o,h,e,u),null,f)}else if(s&ke.IncludeAnonymous||!h.type.isAnonymous||fl(h)){let f;if(!(s&ke.IgnoreMounts)&&h.props&&(f=h.prop(W.mounted))&&!f.overlay)return new St(f.tree,u,e,o);let d=new St(h,u,e,o);return s&ke.IncludeAnonymous||!d.type.isAnonymous?d:d.nextChild(t<0?h.children.length-1:0,t,i,r)}}}if(s&ke.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let r;if(!(i&ke.IgnoreOverlays)&&(r=this._tree.prop(W.mounted))&&r.overlay){let s=e-this.from;for(let{from:o,to:l}of r.overlay)if((t>0?o<=s:o<s)&&(t<0?l>=s:l>s))return new St(r.tree,r.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new qr(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,t=0){return $n(this,e,t,!1)}resolveInner(e,t=0){return $n(this,e,t,!0)}enterUnfinishedNodesBefore(e){return xu(this,e)}getChild(e,t=null,i=null){let r=Ur(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Ur(this,e,t,i)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return Zr(this,e)}}function Ur(n,e,t,i){let r=n.cursor(),s=[];if(!r.firstChild())return s;if(t!=null){for(;!r.type.is(t);)if(!r.nextSibling())return s}for(;;){if(i!=null&&r.type.is(i))return s;if(r.type.is(e)&&s.push(r.node),!r.nextSibling())return i==null?s:[]}}function Zr(n,e,t=e.length-1){for(let i=n.parent;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class qy{constructor(e,t,i,r){this.parent=e,this.buffer=t,this.index=i,this.start=r}}class Rt{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.context.start,i);return s<0?null:new Rt(this.context,this,s)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&ke.ExcludeBuffers)return null;let{buffer:r}=this.context,s=r.findChild(this.index+4,r.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return s<0?null:new Rt(this.context,this,s)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Rt(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Rt(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}cursor(e=0){return new qr(this,e)}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,r=this.index+4,s=i.buffer[this.index+3];if(s>r){let o=i.buffer[this.index+1];e.push(i.slice(r,s,o)),t.push(0)}return new Ce(this.type,e,t,this.to-this.from)}resolve(e,t=0){return $n(this,e,t,!1)}resolveInner(e,t=0){return $n(this,e,t,!0)}enterUnfinishedNodesBefore(e){return xu(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,t=null,i=null){let r=Ur(this,e,t,i);return r.length?r[0]:null}getChildren(e,t=null,i=null){return Ur(this,e,t,i)}get node(){return this}matchContext(e){return Zr(this,e)}}class qr{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof St)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:r}=this.buffer;return this.type=t||r.set.types[r.buffer[e]],this.from=i+r.buffer[e+1],this.to=i+r.buffer[e+2],!0}yield(e){return e?e instanceof St?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:r}=this.buffer,s=r.findChild(this.index+4,r.buffer[this.index+3],e,t-this.buffer.start,i);return s<0?!1:(this.stack.push(this.index),this.yieldBuf(s))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&ke.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&ke.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&ke.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let r=i<0?0:this.stack[i]+4;if(this.index!=r)return this.yieldBuf(t.findChild(r,this.index,-1,0,4))}else{let r=t.buffer[this.index+3];if(r<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(r)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:r}=this;if(r){if(e>0){if(this.index<r.buffer.buffer.length)return!1}else for(let s=0;s<this.index;s++)if(r.buffer.buffer[s+3]<this.index)return!1;({index:t,parent:i}=r)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let s=t+e,o=e<0?-1:i._tree.children.length;s!=o;s+=e){let l=i._tree.children[s];if(this.mode&ke.IncludeAnonymous||l instanceof pn||!l.type.isAnonymous||fl(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let r=this.index,s=this.stack.length;s>=0;){for(let o=e;o;o=o._parent)if(o.index==r){if(r==this.index)return o;t=o,i=s+1;break e}r=this.stack[--s]}for(let r=i;r<this.stack.length;r++)t=new Rt(this.buffer,t,this.stack[r]);return this.bufferNode=new Rt(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let r=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(r=!0)}for(;r&&t&&t(this),r=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,r=!0}}}matchContext(e){if(!this.buffer)return Zr(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let r=e.length-1,s=this.stack.length-1;r>=0;s--){if(s<0)return Zr(this.node,e,r);let o=i[t.buffer[this.stack[s]]];if(!o.isAnonymous){if(e[r]&&e[r]!=o.name)return!1;r--}}return!0}}function fl(n){return n.children.some(e=>e instanceof pn||!e.type.isAnonymous||fl(e))}function Ky(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:r=jy,reused:s=[],minRepeatType:o=i.types.length}=n,l=Array.isArray(t)?new ul(t,t.length):t,a=i.types,c=0,h=0;function u(k,E,N,z,re){let{id:F,start:V,end:K,size:he}=l,ae=h;for(;he<0;)if(l.next(),he==-1){let Ye=s[F];N.push(Ye),z.push(V-k);return}else if(he==-3){c=F;return}else if(he==-4){h=F;return}else throw new RangeError(`Unrecognized record size: ${he}`);let Re=a[F],ze,De,Bi=V-k;if(K-V<=r&&(De=g(l.pos-E,re))){let Ye=new Uint16Array(De.size-De.skip),$e=l.pos-De.size,bt=Ye.length;for(;l.pos>$e;)bt=y(De.start,Ye,bt);ze=new pn(Ye,K-De.start,i),Bi=De.start-k}else{let Ye=l.pos-he;l.next();let $e=[],bt=[],Kt=F>=o?F:-1,mn=0,Ii=K;for(;l.pos>Ye;)Kt>=0&&l.id==Kt&&l.size>=0?(l.end<=Ii-r&&(d($e,bt,V,mn,l.end,Ii,Kt,ae),mn=$e.length,Ii=l.end),l.next()):u(V,Ye,$e,bt,Kt);if(Kt>=0&&mn>0&&mn<$e.length&&d($e,bt,V,mn,V,Ii,Kt,ae),$e.reverse(),bt.reverse(),Kt>-1&&mn>0){let xl=f(Re);ze=dl(Re,$e,bt,0,$e.length,0,K-V,xl,xl)}else ze=p(Re,$e,bt,K-V,ae-K)}N.push(ze),z.push(Bi)}function f(k){return(E,N,z)=>{let re=0,F=E.length-1,V,K;if(F>=0&&(V=E[F])instanceof Ce){if(!F&&V.type==k&&V.length==z)return V;(K=V.prop(W.lookAhead))&&(re=N[F]+V.length+K)}return p(k,E,N,z,re)}}function d(k,E,N,z,re,F,V,K){let he=[],ae=[];for(;k.length>z;)he.push(k.pop()),ae.push(E.pop()+N-re);k.push(p(i.types[V],he,ae,F-re,K-F)),E.push(re-N)}function p(k,E,N,z,re=0,F){if(c){let V=[W.contextHash,c];F=F?[V].concat(F):[V]}if(re>25){let V=[W.lookAhead,re];F=F?[V].concat(F):[V]}return new Ce(k,E,N,z,F)}function g(k,E){let N=l.fork(),z=0,re=0,F=0,V=N.end-r,K={size:0,start:0,skip:0};e:for(let he=N.pos-k;N.pos>he;){let ae=N.size;if(N.id==E&&ae>=0){K.size=z,K.start=re,K.skip=F,F+=4,z+=4,N.next();continue}let Re=N.pos-ae;if(ae<0||Re<he||N.start<V)break;let ze=N.id>=o?4:0,De=N.start;for(N.next();N.pos>Re;){if(N.size<0)if(N.size==-3)ze+=4;else break e;else N.id>=o&&(ze+=4);N.next()}re=De,z+=ae,F+=ze}return(E<0||z==k)&&(K.size=z,K.start=re,K.skip=F),K.size>4?K:void 0}function y(k,E,N){let{id:z,start:re,end:F,size:V}=l;if(l.next(),V>=0&&z<o){let K=N;if(V>4){let he=l.pos-(V-4);for(;l.pos>he;)N=y(k,E,N)}E[--N]=K,E[--N]=F-k,E[--N]=re-k,E[--N]=z}else V==-3?c=z:V==-4&&(h=z);return N}let b=[],v=[];for(;l.pos>0;)u(n.start||0,n.bufferStart||0,b,v,-1);let A=(e=n.length)!==null&&e!==void 0?e:b.length?v[0]+b[0].length:0;return new Ce(a[n.topID],b.reverse(),v.reverse(),A)}const Ua=new WeakMap;function fr(n,e){if(!n.isAnonymous||e instanceof pn||e.type!=n)return 1;let t=Ua.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof Ce)){t=1;break}t+=fr(n,i)}Ua.set(e,t)}return t}function dl(n,e,t,i,r,s,o,l,a){let c=0;for(let p=i;p<r;p++)c+=fr(n,e[p]);let h=Math.ceil(c*1.5/8),u=[],f=[];function d(p,g,y,b,v){for(let A=y;A<b;){let k=A,E=g[A],N=fr(n,p[A]);for(A++;A<b;A++){let z=fr(n,p[A]);if(N+z>=h)break;N+=z}if(A==k+1){if(N>h){let z=p[k];d(z.children,z.positions,0,z.children.length,g[k]+v);continue}u.push(p[k])}else{let z=g[A-1]+p[A-1].length-E;u.push(dl(n,p,g,k,A,E,z,null,a))}f.push(E+v-s)}}return d(e,t,i,r,0),(l||a)(u,f,o)}class ln{constructor(e,t,i,r,s=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=r,this.open=(s?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let r=[new ln(0,e.length,e,0,!1,i)];for(let s of t)s.to>e.length&&r.push(s);return r}static applyChanges(e,t,i=128){if(!t.length)return e;let r=[],s=1,o=e.length?e[0]:null;for(let l=0,a=0,c=0;;l++){let h=l<t.length?t[l]:null,u=h?h.fromA:1e9;if(u-a>=i)for(;o&&o.from<u;){let f=o;if(a>=f.from||u<=f.to||c){let d=Math.max(f.from,a)-c,p=Math.min(f.to,u)-c;f=d>=p?null:new ln(d,p,f.tree,f.offset+c,l>0,!!h)}if(f&&r.push(f),o.to>u)break;o=s<e.length?e[s++]:null}if(!h)break;a=h.toA,c=h.toA-h.toB}return r}}class Gy{startParse(e,t,i){return typeof e=="string"&&(e=new Jy(e)),i=i?i.length?i.map(r=>new Bs(r.from,r.to)):[new Bs(0,0)]:[new Bs(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let r=this.startParse(e,t,i);for(;;){let s=r.advance();if(s)return s}}}class Jy{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new W({perNode:!0});let Yy=0;class rt{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=Yy++}static define(e){if(e?.base)throw new Error("Can not derive from a modified tag");let t=new rt([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new Kr;return t=>t.modified.indexOf(e)>-1?t:Kr.get(t.base||t,t.modified.concat(e).sort((i,r)=>i.id-r.id))}}let Xy=0;class Kr{constructor(){this.instances=[],this.id=Xy++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&Qy(t,l.modified));if(i)return i;let r=[],s=new rt(r,e,t);for(let l of t)l.instances.push(s);let o=e0(t);for(let l of e.set)if(!l.modified.length)for(let a of o)r.push(Kr.get(l,a));return s}}function Qy(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function e0(n){let e=[[]];for(let t=0;t<n.length;t++)for(let i=0,r=e.length;i<r;i++)e.push(e[i].concat(n[t]));return e.sort((t,i)=>i.length-t.length)}function t0(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let r of t.split(" "))if(r){let s=[],o=2,l=r;for(let u=0;;){if(l=="..."&&u>0&&u+3==r.length){o=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!f)throw new RangeError("Invalid path: "+r);if(s.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),u+=f[0].length,u==r.length)break;let d=r[u++];if(u==r.length&&d=="!"){o=0;break}if(d!="/")throw new RangeError("Invalid path: "+r);l=r.slice(u)}let a=s.length-1,c=s[a];if(!c)throw new RangeError("Invalid path: "+r);let h=new Gr(i,o,a>0?s.slice(0,a):null);e[c]=h.sort(e[c])}}return Su.add(e)}const Su=new W;class Gr{constructor(e,t,i,r){this.tags=e,this.mode=t,this.context=i,this.next=r}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Gr.empty=new Gr([],2,null);function Tu(n,e){let t=Object.create(null);for(let s of n)if(!Array.isArray(s.tag))t[s.tag.id]=s.class;else for(let o of s.tag)t[o.id]=s.class;let{scope:i,all:r=null}=e||{};return{style:s=>{let o=r;for(let l of s)for(let a of l.set){let c=t[a.id];if(c){o=o?o+" "+c:c;break}}return o},scope:i}}function n0(n,e){let t=null;for(let i of n){let r=i.style(e);r&&(t=t?t+" "+r:r)}return t}function i0(n,e,t,i=0,r=n.length){let s=new r0(i,Array.isArray(e)?e:[e],t);s.highlightRange(n.cursor(),i,r,"",s.highlighters),s.flush(r)}class r0{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,r,s){let{type:o,from:l,to:a}=e;if(l>=i||a<=t)return;o.isTop&&(s=this.highlighters.filter(d=>!d.scope||d.scope(o)));let c=r,h=s0(e)||Gr.empty,u=n0(s,h.tags);if(u&&(c&&(c+=" "),c+=u,h.mode==1&&(r+=(r?" ":"")+u)),this.startSpan(Math.max(t,l),c),h.opaque)return;let f=e.tree&&e.tree.prop(W.mounted);if(f&&f.overlay){let d=e.node.enter(f.overlay[0].from+l,1),p=this.highlighters.filter(y=>!y.scope||y.scope(f.tree.type)),g=e.firstChild();for(let y=0,b=l;;y++){let v=y<f.overlay.length?f.overlay[y]:null,A=v?v.from+l:a,k=Math.max(t,b),E=Math.min(i,A);if(k<E&&g)for(;e.from<E&&(this.highlightRange(e,k,E,r,s),this.startSpan(Math.min(E,e.to),c),!(e.to>=A||!e.nextSibling())););if(!v||A>i)break;b=v.to+l,b>t&&(this.highlightRange(d.cursor(),Math.max(t,v.from+l),Math.min(i,b),"",p),this.startSpan(Math.min(i,b),c))}g&&e.parent()}else if(e.firstChild()){f&&(r="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,r,s),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function s0(n){let e=n.type.prop(Su);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const T=rt.define,Xi=T(),Nt=T(),Za=T(Nt),qa=T(Nt),Et=T(),Qi=T(Et),Is=T(Et),nt=T(),Gt=T(nt),et=T(),tt=T(),_o=T(),Gn=T(_o),er=T(),w={comment:Xi,lineComment:T(Xi),blockComment:T(Xi),docComment:T(Xi),name:Nt,variableName:T(Nt),typeName:Za,tagName:T(Za),propertyName:qa,attributeName:T(qa),className:T(Nt),labelName:T(Nt),namespace:T(Nt),macroName:T(Nt),literal:Et,string:Qi,docString:T(Qi),character:T(Qi),attributeValue:T(Qi),number:Is,integer:T(Is),float:T(Is),bool:T(Et),regexp:T(Et),escape:T(Et),color:T(Et),url:T(Et),keyword:et,self:T(et),null:T(et),atom:T(et),unit:T(et),modifier:T(et),operatorKeyword:T(et),controlKeyword:T(et),definitionKeyword:T(et),moduleKeyword:T(et),operator:tt,derefOperator:T(tt),arithmeticOperator:T(tt),logicOperator:T(tt),bitwiseOperator:T(tt),compareOperator:T(tt),updateOperator:T(tt),definitionOperator:T(tt),typeOperator:T(tt),controlOperator:T(tt),punctuation:_o,separator:T(_o),bracket:Gn,angleBracket:T(Gn),squareBracket:T(Gn),paren:T(Gn),brace:T(Gn),content:nt,heading:Gt,heading1:T(Gt),heading2:T(Gt),heading3:T(Gt),heading4:T(Gt),heading5:T(Gt),heading6:T(Gt),contentSeparator:T(nt),list:T(nt),quote:T(nt),emphasis:T(nt),strong:T(nt),link:T(nt),monospace:T(nt),strikethrough:T(nt),inserted:T(),deleted:T(),changed:T(),invalid:T(),meta:er,documentMeta:T(er),annotation:T(er),processingInstruction:T(er),definition:rt.defineModifier(),constant:rt.defineModifier(),function:rt.defineModifier(),standard:rt.defineModifier(),local:rt.defineModifier(),special:rt.defineModifier()};Tu([{tag:w.link,class:"tok-link"},{tag:w.heading,class:"tok-heading"},{tag:w.emphasis,class:"tok-emphasis"},{tag:w.strong,class:"tok-strong"},{tag:w.keyword,class:"tok-keyword"},{tag:w.atom,class:"tok-atom"},{tag:w.bool,class:"tok-bool"},{tag:w.url,class:"tok-url"},{tag:w.labelName,class:"tok-labelName"},{tag:w.inserted,class:"tok-inserted"},{tag:w.deleted,class:"tok-deleted"},{tag:w.literal,class:"tok-literal"},{tag:w.string,class:"tok-string"},{tag:w.number,class:"tok-number"},{tag:[w.regexp,w.escape,w.special(w.string)],class:"tok-string2"},{tag:w.variableName,class:"tok-variableName"},{tag:w.local(w.variableName),class:"tok-variableName tok-local"},{tag:w.definition(w.variableName),class:"tok-variableName tok-definition"},{tag:w.special(w.variableName),class:"tok-variableName2"},{tag:w.definition(w.propertyName),class:"tok-propertyName tok-definition"},{tag:w.typeName,class:"tok-typeName"},{tag:w.namespace,class:"tok-namespace"},{tag:w.className,class:"tok-className"},{tag:w.macroName,class:"tok-macroName"},{tag:w.propertyName,class:"tok-propertyName"},{tag:w.operator,class:"tok-operator"},{tag:w.comment,class:"tok-comment"},{tag:w.meta,class:"tok-meta"},{tag:w.invalid,class:"tok-invalid"},{tag:w.punctuation,class:"tok-punctuation"}]);var Rs;const ni=new W,o0=new W;class ct{constructor(e,t,i=[],r=""){this.data=e,this.name=r,Z.prototype.hasOwnProperty("tree")||Object.defineProperty(Z.prototype,"tree",{get(){return gt(this)}}),this.parser=t,this.extension=[Fn.of(this),Z.languageData.of((s,o,l)=>{let a=Ka(s,o,l),c=a.type.prop(ni);if(!c)return[];let h=s.facet(c),u=a.type.prop(o0);if(u){let f=a.resolve(o-a.from,l);for(let d of u)if(d.test(f,s)){let p=s.facet(d.facet);return d.type=="replace"?p:p.concat(h)}}return h})].concat(i)}isActiveAt(e,t,i=-1){return Ka(e,t,i).type.prop(ni)==this.data}findRegions(e){let t=e.facet(Fn);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],r=(s,o)=>{if(s.prop(ni)==this.data){i.push({from:o,to:o+s.length});return}let l=s.prop(W.mounted);if(l){if(l.tree.prop(ni)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+s.length});return}else if(l.overlay){let a=i.length;if(r(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<s.children.length;a++){let c=s.children[a];c instanceof Ce&&r(c,s.positions[a]+o)}};return r(gt(e),0),i}get allowsNesting(){return!0}}ct.setState=te.define();function Ka(n,e,t){let i=n.facet(Fn),r=gt(n).topNode;if(!i||i.allowsNesting)for(let s=r;s;s=s.enter(e,t,ke.ExcludeBuffers))s.type.isTop&&(r=s);return r}function gt(n){let e=n.field(ct.state,!1);return e?e.tree:Ce.empty}class l0{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let Jn=null;class Jr{constructor(e,t,i=[],r,s,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=r,this.treeLen=s,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new Jr(e,t,[],Ce.empty,0,i,[],null)}startParse(){return this.parser.startParse(new l0(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=Ce.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let r=Date.now()+e;e=()=>Date.now()>r}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let r=this.parse.advance();if(r)if(this.fragments=this.withoutTempSkipped(ln.addTree(r,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=r,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(ln.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=Jn;Jn=this;try{return e()}finally{Jn=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Ga(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:r,treeLen:s,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((c,h,u,f)=>a.push({fromA:c,toA:h,fromB:u,toB:f})),i=ln.applyChanges(i,a),r=Ce.empty,s=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let c of this.skipped){let h=e.mapPos(c.from,1),u=e.mapPos(c.to,-1);h<u&&l.push({from:h,to:u})}}}return new Jr(this.parser,t,i,r,s,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:r,to:s}=this.skipped[i];r<e.to&&s>e.from&&(this.fragments=Ga(this.fragments,r,s),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Gy{createParse(t,i,r){let s=r[0].from,o=r[r.length-1].to;return{parsedPos:s,advance(){let a=Jn;if(a){for(let c of r)a.tempSkipped.push(c);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new Ce(We.none,[],[],o-s)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return Jn}}function Ga(n,e,t){return ln.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Vn{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Vn(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=Jr.create(e.facet(Fn).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Vn(i)}}ct.state=Mt.define({create:Vn.init,update(n,e){for(let t of e.effects)if(t.is(ct.setState))return t.value;return e.startState.facet(Fn)!=e.state.facet(Fn)?Vn.init(e.state):n.apply(e)}});let Au=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(Au=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:500-100})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const $s=typeof navigator<"u"&&(!((Rs=navigator.scheduling)===null||Rs===void 0)&&Rs.isInputPending)?()=>navigator.scheduling.isInputPending():null,a0=Ge.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(ct.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(ct.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=Au(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:r}}=this.view,s=i.field(ct.state);if(s.tree==s.context.tree&&s.context.isDone(r+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!$s?Math.max(25,e.timeRemaining()-5):1e9),l=s.context.treeLen<r&&i.doc.length>r+1e3,a=s.context.work(()=>$s&&$s()||Date.now()>o,r+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(s.context.takeTree(),this.view.dispatch({effects:ct.setState.of(new Vn(s.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(s.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ut(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Fn=P.define({combine(n){return n.length?n[0]:null},enables:n=>[ct.state,a0,R.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]}),c0=P.define(),pl=P.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function Yr(n){let e=n.facet(pl);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function Xr(n,e){let t="",i=n.tabSize,r=n.facet(pl)[0];if(r=="	"){for(;e>=i;)t+="	",e-=i;r=" "}for(let s=0;s<e;s++)t+=r;return t}function Cu(n,e){n instanceof Z&&(n=new hs(n));for(let i of n.state.facet(c0)){let r=i(n,e);if(r!==void 0)return r}let t=gt(n.state);return t?u0(n,t,e):null}class hs{constructor(e,t={}){this.state=e,this.options=t,this.unit=Yr(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:r,simulateDoubleBreak:s}=this.options;return r!=null&&r>=i.from&&r<=i.to?s&&r==e?{text:"",from:e}:(t<0?r<e:r<=e)?{text:i.text.slice(r-i.from),from:r}:{text:i.text.slice(0,r-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:r}=this.lineAt(e,t);return i.slice(e-r,Math.min(i.length,e+100-r))}column(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.countColumn(i,e-r),o=this.options.overrideIndentation?this.options.overrideIndentation(r):-1;return o>-1&&(s+=o-this.countColumn(i,i.search(/\S|$/))),s}countColumn(e,t=e.length){return nl(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:r}=this.lineAt(e,t),s=this.options.overrideIndentation;if(s){let o=s(r);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const h0=new W;function u0(n,e,t){return Mu(e.resolveInner(t).enterUnfinishedNodesBefore(t),t,n)}function f0(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function d0(n){let e=n.type.prop(h0);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(W.closedBy))){let r=n.lastChild,s=r&&i.indexOf(r.name)>-1;return o=>y0(o,!0,1,void 0,s&&!f0(o)?r.from:void 0)}return n.parent==null?p0:null}function Mu(n,e,t){for(;n;n=n.parent){let i=d0(n);if(i)return i(ml.create(t,e,n))}return null}function p0(){return 0}class ml extends hs{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.node=i}static create(e,t,i){return new ml(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(m0(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){let e=this.node.parent;return e?Mu(e,this.pos,this.base):0}}function m0(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function g0(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let r=n.options.simulateBreak,s=n.state.doc.lineAt(t.from),o=r==null||r<=s.from?s.to:Math.min(s.to,r);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped)return a.from<o?t:null;l=a.to}}function y0(n,e,t,i,r){let s=n.textAfter,o=s.match(/^\s*/)[0].length,l=i&&s.slice(o,o+i.length)==i||r==n.pos+o,a=e?g0(n):null;return a?l?n.column(a.from):n.column(a.to):n.baseIndent+(l?0:n.unit*t)}class us{constructor(e,t){this.specs=e;let i;function r(l){let a=Ht.newName();return(i||(i=Object.create(null)))["."+a]=l,a}const s=typeof t.all=="string"?t.all:t.all?r(t.all):void 0,o=t.scope;this.scope=o instanceof ct?l=>l.prop(ni)==o.data:o?l=>l==o:void 0,this.style=Tu(e.map(l=>({tag:l.tag,class:l.class||r(Object.assign({},l,{tag:null}))})),{all:s}).style,this.module=i?new Ht(i):null,this.themeType=t.themeType}static define(e,t){return new us(e,t||{})}}const Po=P.define(),Ou=P.define({combine(n){return n.length?[n[0]]:null}});function Vs(n){let e=n.facet(Po);return e.length?e:n.facet(Ou)}function Nu(n,e){let t=[w0],i;return n instanceof us&&(n.module&&t.push(R.styleModule.of(n.module)),i=n.themeType),e?.fallback?t.push(Ou.of(n)):i?t.push(Po.computeN([R.darkTheme],r=>r.facet(R.darkTheme)==(i=="dark")?[n]:[])):t.push(Po.of(n)),t}class b0{constructor(e){this.markCache=Object.create(null),this.tree=gt(e.state),this.decorations=this.buildDeco(e,Vs(e.state))}update(e){let t=gt(e.state),i=Vs(e.state),r=i!=Vs(e.startState);t.length<e.view.viewport.to&&!r&&t.type==this.tree.type?this.decorations=this.decorations.map(e.changes):(t!=this.tree||e.viewportChanged||r)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i))}buildDeco(e,t){if(!t||!this.tree.length)return ne.none;let i=new xi;for(let{from:r,to:s}of e.visibleRanges)i0(this.tree,t,(o,l,a)=>{i.add(o,l,this.markCache[a]||(this.markCache[a]=ne.mark({class:a})))},r,s);return i.finish()}}const w0=el.high(Ge.fromClass(b0,{decorations:n=>n.decorations})),v0=1e4,k0="()[]{}",x0=new W;function Lo(n,e,t){let i=n.prop(e<0?W.openedBy:W.closedBy);if(i)return i;if(n.name.length==1){let r=t.indexOf(n.name);if(r>-1&&r%2==(e<0?1:0))return[t[r+e]]}return null}function Bo(n){let e=n.type.prop(x0);return e?e(n.node):n}function Sn(n,e,t,i={}){let r=i.maxScanDistance||v0,s=i.brackets||k0,o=gt(n),l=o.resolveInner(e,t);for(let a=l;a;a=a.parent){let c=Lo(a.type,t,s);if(c&&a.from<a.to){let h=Bo(a);if(h&&(t>0?e>=h.from&&e<h.to:e>h.from&&e<=h.to))return S0(n,e,t,a,h,c,s)}}return T0(n,e,t,o,l.type,r,s)}function S0(n,e,t,i,r,s,o){let l=i.parent,a={from:r.from,to:r.to},c=0,h=l?.cursor();if(h&&(t<0?h.childBefore(i.from):h.childAfter(i.to)))do if(t<0?h.to<=i.from:h.from>=i.to){if(c==0&&s.indexOf(h.type.name)>-1&&h.from<h.to){let u=Bo(h);return{start:a,end:u?{from:u.from,to:u.to}:void 0,matched:!0}}else if(Lo(h.type,t,o))c++;else if(Lo(h.type,-t,o)){if(c==0){let u=Bo(h);return{start:a,end:u&&u.from<u.to?{from:u.from,to:u.to}:void 0,matched:!1}}c--}}while(t<0?h.prevSibling():h.nextSibling());return{start:a,matched:!1}}function T0(n,e,t,i,r,s,o){let l=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),a=o.indexOf(l);if(a<0||a%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},h=n.doc.iterRange(e,t>0?n.doc.length:0),u=0;for(let f=0;!h.next().done&&f<=s;){let d=h.value;t<0&&(f+=d.length);let p=e+f*t;for(let g=t>0?0:d.length-1,y=t>0?d.length:-1;g!=y;g+=t){let b=o.indexOf(d[g]);if(!(b<0||i.resolveInner(p+g,1).type!=r))if(b%2==0==t>0)u++;else{if(u==1)return{start:c,end:{from:p+g,to:p+g+1},matched:b>>1==a>>1};u--}}t>0&&(f+=d.length)}return h.done?{start:c,matched:!1}:null}const A0=Object.create(null),Ja=[We.none],Ya=[],C0=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])C0[n]=M0(A0,e);function Fs(n,e){Ya.indexOf(n)>-1||(Ya.push(n),console.warn(e))}function M0(n,e){let t=null;for(let s of e.split(".")){let o=n[s]||w[s];o?typeof o=="function"?t?t=o(t):Fs(s,`Modifier ${s} used at start of tag`):t?Fs(s,`Tag ${s} used as modifier`):t=o:Fs(s,`Unknown highlighting tag ${s}`)}if(!t)return 0;let i=e.replace(/ /g,"_"),r=We.define({id:Ja.length,name:i,props:[t0({[i]:t})]});return Ja.push(r),r.id}const O0=n=>{let{state:e}=n,t=e.doc.lineAt(e.selection.main.from),i=yl(n.state,t.from);return i.line?N0(n):i.block?D0(n):!1};function gl(n,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let r=n(e,t);return r?(i(t.update(r)),!0):!1}}const N0=gl(L0,0),E0=gl(Eu,0),D0=gl((n,e)=>Eu(n,e,P0(e)),0);function yl(n,e){let t=n.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const Yn=50;function _0(n,{open:e,close:t},i,r){let s=n.sliceDoc(i-Yn,i),o=n.sliceDoc(r,r+Yn),l=/\s*$/.exec(s)[0].length,a=/^\s*/.exec(o)[0].length,c=s.length-l;if(s.slice(c-e.length,c)==e&&o.slice(a,a+t.length)==t)return{open:{pos:i-l,margin:l&&1},close:{pos:r+a,margin:a&&1}};let h,u;r-i<=2*Yn?h=u=n.sliceDoc(i,r):(h=n.sliceDoc(i,i+Yn),u=n.sliceDoc(r-Yn,r));let f=/^\s*/.exec(h)[0].length,d=/\s*$/.exec(u)[0].length,p=u.length-d-t.length;return h.slice(f,f+e.length)==e&&u.slice(p,p+t.length)==t?{open:{pos:i+f+e.length,margin:/\s/.test(h.charAt(f+e.length))?1:0},close:{pos:r-d-t.length,margin:/\s/.test(u.charAt(p-1))?1:0}}:null}function P0(n){let e=[];for(let t of n.selection.ranges){let i=n.doc.lineAt(t.from),r=t.to<=i.to?i:n.doc.lineAt(t.to),s=e.length-1;s>=0&&e[s].to>i.from?e[s].to=r.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:r.to})}return e}function Eu(n,e,t=e.selection.ranges){let i=t.map(s=>yl(e,s.from).block);if(!i.every(s=>s))return null;let r=t.map((s,o)=>_0(e,i[o],s.from,s.to));if(n!=2&&!r.every(s=>s))return{changes:e.changes(t.map((s,o)=>r[o]?[]:[{from:s.from,insert:i[o].open+" "},{from:s.to,insert:" "+i[o].close}]))};if(n!=1&&r.some(s=>s)){let s=[];for(let o=0,l;o<r.length;o++)if(l=r[o]){let a=i[o],{open:c,close:h}=l;s.push({from:c.pos-a.open.length,to:c.pos+c.margin},{from:h.pos-h.margin,to:h.pos+a.close.length})}return{changes:s}}return null}function L0(n,e,t=e.selection.ranges){let i=[],r=-1;for(let{from:s,to:o}of t){let l=i.length,a=1e9,c=yl(e,s).line;if(c){for(let h=s;h<=o;){let u=e.doc.lineAt(h);if(u.from>r&&(s==o||o>u.from)){r=u.from;let f=/^\s*/.exec(u.text)[0].length,d=f==u.length,p=u.text.slice(f,f+c.length)==c?f:-1;f<u.text.length&&f<a&&(a=f),i.push({line:u,comment:p,token:c,indent:f,empty:d,single:!1})}h=u.to+1}if(a<1e9)for(let h=l;h<i.length;h++)i[h].indent<i[h].line.text.length&&(i[h].indent=a);i.length==l+1&&(i[l].single=!0)}}if(n!=2&&i.some(s=>s.comment<0&&(!s.empty||s.single))){let s=[];for(let{line:l,token:a,indent:c,empty:h,single:u}of i)(u||!h)&&s.push({from:l.from+c,insert:a+" "});let o=e.changes(s);return{changes:o,selection:e.selection.map(o,1)}}else if(n!=1&&i.some(s=>s.comment>=0)){let s=[];for(let{line:o,comment:l,token:a}of i)if(l>=0){let c=o.from+l,h=c+a.length;o.text[h-o.from]==" "&&h++,s.push({from:c,to:h})}return{changes:s}}return null}function Wn(n,e){return x.create(n.ranges.map(e),n.mainIndex)}function yt(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Je({state:n,dispatch:e},t){let i=Wn(n.selection,t);return i.eq(n.selection)?!1:(e(yt(n,i)),!0)}function fs(n,e){return x.cursor(e?n.to:n.from)}function Du(n,e){return Je(n,t=>t.empty?n.moveByChar(t,e):fs(t,e))}function Ee(n){return n.textDirectionAt(n.state.selection.main.head)==ye.LTR}const _u=n=>Du(n,!Ee(n)),Pu=n=>Du(n,Ee(n));function Lu(n,e){return Je(n,t=>t.empty?n.moveByGroup(t,e):fs(t,e))}const B0=n=>Lu(n,!Ee(n)),I0=n=>Lu(n,Ee(n));function R0(n,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function ds(n,e,t){let i=gt(n).resolveInner(e.head),r=t?W.closedBy:W.openedBy;for(let a=e.head;;){let c=t?i.childAfter(a):i.childBefore(a);if(!c)break;R0(n,c,r)?i=c:a=t?c.to:c.from}let s=i.type.prop(r),o,l;return s&&(o=t?Sn(n,i.from,1):Sn(n,i.to,-1))&&o.matched?l=t?o.end.to:o.end.from:l=t?i.to:i.from,x.cursor(l,t?-1:1)}const $0=n=>Je(n,e=>ds(n.state,e,!Ee(n))),V0=n=>Je(n,e=>ds(n.state,e,Ee(n)));function Bu(n,e){return Je(n,t=>{if(!t.empty)return fs(t,e);let i=n.moveVertically(t,e);return i.head!=t.head?i:n.moveToLineBoundary(t,e)})}const Iu=n=>Bu(n,!1),Ru=n=>Bu(n,!0);function $u(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,t=0,i=0,r;if(e){for(let s of n.state.facet(R.scrollMargins)){let o=s(n);o?.top&&(t=Math.max(o?.top,t)),o?.bottom&&(i=Math.max(o?.bottom,i))}r=n.scrollDOM.clientHeight-t-i}else r=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:i,selfScroll:e,height:Math.max(n.defaultLineHeight,r-5)}}function Vu(n,e){let t=$u(n),{state:i}=n,r=Wn(i.selection,o=>o.empty?n.moveVertically(o,e,t.height):fs(o,e));if(r.eq(i.selection))return!1;let s;if(t.selfScroll){let o=n.coordsAtPos(i.selection.main.head),l=n.scrollDOM.getBoundingClientRect(),a=l.top+t.marginTop,c=l.bottom-t.marginBottom;o&&o.top>a&&o.bottom<c&&(s=R.scrollIntoView(r.main.head,{y:"start",yMargin:o.top-a}))}return n.dispatch(yt(i,r),{effects:s}),!0}const Xa=n=>Vu(n,!1),Io=n=>Vu(n,!0);function qt(n,e,t){let i=n.lineBlockAt(e.head),r=n.moveToLineBoundary(e,t);if(r.head==e.head&&r.head!=(t?i.to:i.from)&&(r=n.moveToLineBoundary(e,t,!1)),!t&&r.head==i.from&&i.length){let s=/^\s*/.exec(n.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;s&&e.head!=i.from+s&&(r=x.cursor(i.from+s))}return r}const F0=n=>Je(n,e=>qt(n,e,!0)),H0=n=>Je(n,e=>qt(n,e,!1)),z0=n=>Je(n,e=>qt(n,e,!Ee(n))),W0=n=>Je(n,e=>qt(n,e,Ee(n))),j0=n=>Je(n,e=>x.cursor(n.lineBlockAt(e.head).from,1)),U0=n=>Je(n,e=>x.cursor(n.lineBlockAt(e.head).to,-1));function Z0(n,e,t){let i=!1,r=Wn(n.selection,s=>{let o=Sn(n,s.head,-1)||Sn(n,s.head,1)||s.head>0&&Sn(n,s.head-1,1)||s.head<n.doc.length&&Sn(n,s.head+1,-1);if(!o||!o.end)return s;i=!0;let l=o.start.from==s.head?o.end.to:o.end.from;return t?x.range(s.anchor,l):x.cursor(l)});return i?(e(yt(n,r)),!0):!1}const q0=({state:n,dispatch:e})=>Z0(n,e,!1);function je(n,e){let t=Wn(n.state.selection,i=>{let r=e(i);return x.range(i.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return t.eq(n.state.selection)?!1:(n.dispatch(yt(n.state,t)),!0)}function Fu(n,e){return je(n,t=>n.moveByChar(t,e))}const Hu=n=>Fu(n,!Ee(n)),zu=n=>Fu(n,Ee(n));function Wu(n,e){return je(n,t=>n.moveByGroup(t,e))}const K0=n=>Wu(n,!Ee(n)),G0=n=>Wu(n,Ee(n)),J0=n=>je(n,e=>ds(n.state,e,!Ee(n))),Y0=n=>je(n,e=>ds(n.state,e,Ee(n)));function ju(n,e){return je(n,t=>n.moveVertically(t,e))}const Uu=n=>ju(n,!1),Zu=n=>ju(n,!0);function qu(n,e){return je(n,t=>n.moveVertically(t,e,$u(n).height))}const Qa=n=>qu(n,!1),ec=n=>qu(n,!0),X0=n=>je(n,e=>qt(n,e,!0)),Q0=n=>je(n,e=>qt(n,e,!1)),eb=n=>je(n,e=>qt(n,e,!Ee(n))),tb=n=>je(n,e=>qt(n,e,Ee(n))),nb=n=>je(n,e=>x.cursor(n.lineBlockAt(e.head).from)),ib=n=>je(n,e=>x.cursor(n.lineBlockAt(e.head).to)),tc=({state:n,dispatch:e})=>(e(yt(n,{anchor:0})),!0),nc=({state:n,dispatch:e})=>(e(yt(n,{anchor:n.doc.length})),!0),ic=({state:n,dispatch:e})=>(e(yt(n,{anchor:n.selection.main.anchor,head:0})),!0),rc=({state:n,dispatch:e})=>(e(yt(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),rb=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),sb=({state:n,dispatch:e})=>{let t=ms(n).map(({from:i,to:r})=>x.range(i,Math.min(r+1,n.doc.length)));return e(n.update({selection:x.create(t),userEvent:"select"})),!0},ob=({state:n,dispatch:e})=>{let t=Wn(n.selection,i=>{var r;let s=gt(n).resolveInner(i.head,1);for(;!(s.from<i.from&&s.to>=i.to||s.to>i.to&&s.from<=i.from||!(!((r=s.parent)===null||r===void 0)&&r.parent));)s=s.parent;return x.range(s.to,s.from)});return e(yt(n,t)),!0},lb=({state:n,dispatch:e})=>{let t=n.selection,i=null;return t.ranges.length>1?i=x.create([t.main]):t.main.empty||(i=x.create([x.cursor(t.main.head)])),i?(e(yt(n,i)),!0):!1};function ps(n,e){if(n.state.readOnly)return!1;let t="delete.selection",{state:i}=n,r=i.changeByRange(s=>{let{from:o,to:l}=s;if(o==l){let a=e(o);a<o?(t="delete.backward",a=tr(n,a,!1)):a>o&&(t="delete.forward",a=tr(n,a,!0)),o=Math.min(o,a),l=Math.max(l,a)}else o=tr(n,o,!1),l=tr(n,l,!0);return o==l?{range:s}:{changes:{from:o,to:l},range:x.cursor(o)}});return r.changes.empty?!1:(n.dispatch(i.update(r,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?R.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function tr(n,e,t){if(n instanceof R)for(let i of n.state.facet(R.atomicRanges).map(r=>r(n)))i.between(e,e,(r,s)=>{r<e&&s>e&&(e=t?s:r)});return e}const Ku=(n,e)=>ps(n,t=>{let{state:i}=n,r=i.doc.lineAt(t),s,o;if(!e&&t>r.from&&t<r.from+200&&!/[^ \t]/.test(s=r.text.slice(0,t-r.from))){if(s[s.length-1]=="	")return t-1;let l=nl(s,i.tabSize),a=l%Yr(i)||Yr(i);for(let c=0;c<a&&s[s.length-1-c]==" ";c++)t--;o=t}else o=He(r.text,t-r.from,e,e)+r.from,o==t&&r.number!=(e?i.doc.lines:1)&&(o+=e?1:-1);return o}),Ro=n=>Ku(n,!1),Gu=n=>Ku(n,!0),Ju=(n,e)=>ps(n,t=>{let i=t,{state:r}=n,s=r.doc.lineAt(i),o=r.charCategorizer(i);for(let l=null;;){if(i==(e?s.to:s.from)){i==t&&s.number!=(e?r.doc.lines:1)&&(i+=e?1:-1);break}let a=He(s.text,i-s.from,e)+s.from,c=s.text.slice(Math.min(i,a)-s.from,Math.max(i,a)-s.from),h=o(c);if(l!=null&&h!=l)break;(c!=" "||i!=t)&&(l=h),i=a}return i}),Yu=n=>Ju(n,!1),ab=n=>Ju(n,!0),Xu=n=>ps(n,e=>{let t=n.lineBlockAt(e).to;return e<t?t:Math.min(n.state.doc.length,e+1)}),cb=n=>ps(n,e=>{let t=n.lineBlockAt(e).from;return e>t?t:Math.max(0,e-1)}),hb=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:U.of(["",""])},range:x.cursor(i.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},ub=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>{if(!i.empty||i.from==0||i.from==n.doc.length)return{range:i};let r=i.from,s=n.doc.lineAt(r),o=r==s.from?r-1:He(s.text,r-s.from,!1)+s.from,l=r==s.to?r+1:He(s.text,r-s.from,!0)+s.from;return{changes:{from:o,to:l,insert:n.doc.slice(r,l).append(n.doc.slice(o,r))},range:x.cursor(l)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function ms(n){let e=[],t=-1;for(let i of n.selection.ranges){let r=n.doc.lineAt(i.from),s=n.doc.lineAt(i.to);if(!i.empty&&i.to==s.from&&(s=n.doc.lineAt(i.to-1)),t>=r.number){let o=e[e.length-1];o.to=s.to,o.ranges.push(i)}else e.push({from:r.from,to:s.to,ranges:[i]});t=s.number+1}return e}function Qu(n,e,t){if(n.readOnly)return!1;let i=[],r=[];for(let s of ms(n)){if(t?s.to==n.doc.length:s.from==0)continue;let o=n.doc.lineAt(t?s.to+1:s.from-1),l=o.length+1;if(t){i.push({from:s.to,to:o.to},{from:s.from,insert:o.text+n.lineBreak});for(let a of s.ranges)r.push(x.range(Math.min(n.doc.length,a.anchor+l),Math.min(n.doc.length,a.head+l)))}else{i.push({from:o.from,to:s.from},{from:s.to,insert:n.lineBreak+o.text});for(let a of s.ranges)r.push(x.range(a.anchor-l,a.head-l))}}return i.length?(e(n.update({changes:i,scrollIntoView:!0,selection:x.create(r,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const fb=({state:n,dispatch:e})=>Qu(n,e,!1),db=({state:n,dispatch:e})=>Qu(n,e,!0);function ef(n,e,t){if(n.readOnly)return!1;let i=[];for(let r of ms(n))t?i.push({from:r.from,insert:n.doc.slice(r.from,r.to)+n.lineBreak}):i.push({from:r.to,insert:n.lineBreak+n.doc.slice(r.from,r.to)});return e(n.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const pb=({state:n,dispatch:e})=>ef(n,e,!1),mb=({state:n,dispatch:e})=>ef(n,e,!0),gb=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(ms(e).map(({from:r,to:s})=>(r>0?r--:s<e.doc.length&&s++,{from:r,to:s}))),i=Wn(e.selection,r=>n.moveVertically(r,!0)).map(t);return n.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function yb(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=gt(n).resolveInner(e),i=t.childBefore(e),r=t.childAfter(e),s;return i&&r&&i.to<=e&&r.from>=e&&(s=i.type.prop(W.closedBy))&&s.indexOf(r.name)>-1&&n.doc.lineAt(i.to).from==n.doc.lineAt(r.from).from?{from:i.to,to:r.from}:null}const bb=tf(!1),wb=tf(!0);function tf(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(r=>{let{from:s,to:o}=r,l=e.doc.lineAt(s),a=!n&&s==o&&yb(e,s);n&&(s=o=(o<=l.to?l:e.doc.lineAt(o)).to);let c=new hs(e,{simulateBreak:s,simulateDoubleBreak:!!a}),h=Cu(c,s);for(h==null&&(h=/^\s*/.exec(e.doc.lineAt(s).text)[0].length);o<l.to&&/\s/.test(l.text[o-l.from]);)o++;a?{from:s,to:o}=a:s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let u=["",Xr(e,h)];return a&&u.push(Xr(e,c.lineIndent(l.from,-1))),{changes:{from:s,to:o,insert:U.of(u)},range:x.cursor(s+1+u[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function bl(n,e){let t=-1;return n.changeByRange(i=>{let r=[];for(let o=i.from;o<=i.to;){let l=n.doc.lineAt(o);l.number>t&&(i.empty||i.to>l.from)&&(e(l,r,i),t=l.number),o=l.to+1}let s=n.changes(r);return{changes:r,range:x.range(s.mapPos(i.anchor,1),s.mapPos(i.head,1))}})}const vb=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),i=new hs(n,{overrideIndentation:s=>{let o=t[s];return o??-1}}),r=bl(n,(s,o,l)=>{let a=Cu(i,s.from);if(a==null)return;/\S/.test(s.text)||(a=0);let c=/^\s*/.exec(s.text)[0],h=Xr(n,a);(c!=h||l.from<s.from+c.length)&&(t[s.from]=a,o.push({from:s.from,to:s.from+c.length,insert:h}))});return r.changes.empty||e(n.update(r,{userEvent:"indent"})),!0},kb=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(bl(n,(t,i)=>{i.push({from:t.from,insert:n.facet(pl)})}),{userEvent:"input.indent"})),!0),xb=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(bl(n,(t,i)=>{let r=/^\s*/.exec(t.text)[0];if(!r)return;let s=nl(r,n.tabSize),o=0,l=Xr(n,Math.max(0,s-Yr(n)));for(;o<r.length&&o<l.length&&r.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:t.from+o,to:t.from+r.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),Sb=[{key:"Ctrl-b",run:_u,shift:Hu,preventDefault:!0},{key:"Ctrl-f",run:Pu,shift:zu},{key:"Ctrl-p",run:Iu,shift:Uu},{key:"Ctrl-n",run:Ru,shift:Zu},{key:"Ctrl-a",run:j0,shift:nb},{key:"Ctrl-e",run:U0,shift:ib},{key:"Ctrl-d",run:Gu},{key:"Ctrl-h",run:Ro},{key:"Ctrl-k",run:Xu},{key:"Ctrl-Alt-h",run:Yu},{key:"Ctrl-o",run:hb},{key:"Ctrl-t",run:ub},{key:"Ctrl-v",run:Io}],Tb=[{key:"ArrowLeft",run:_u,shift:Hu,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:B0,shift:K0,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:z0,shift:eb,preventDefault:!0},{key:"ArrowRight",run:Pu,shift:zu,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:I0,shift:G0,preventDefault:!0},{mac:"Cmd-ArrowRight",run:W0,shift:tb,preventDefault:!0},{key:"ArrowUp",run:Iu,shift:Uu,preventDefault:!0},{mac:"Cmd-ArrowUp",run:tc,shift:ic},{mac:"Ctrl-ArrowUp",run:Xa,shift:Qa},{key:"ArrowDown",run:Ru,shift:Zu,preventDefault:!0},{mac:"Cmd-ArrowDown",run:nc,shift:rc},{mac:"Ctrl-ArrowDown",run:Io,shift:ec},{key:"PageUp",run:Xa,shift:Qa},{key:"PageDown",run:Io,shift:ec},{key:"Home",run:H0,shift:Q0,preventDefault:!0},{key:"Mod-Home",run:tc,shift:ic},{key:"End",run:F0,shift:X0,preventDefault:!0},{key:"Mod-End",run:nc,shift:rc},{key:"Enter",run:bb},{key:"Mod-a",run:rb},{key:"Backspace",run:Ro,shift:Ro},{key:"Delete",run:Gu},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Yu},{key:"Mod-Delete",mac:"Alt-Delete",run:ab},{mac:"Mod-Backspace",run:cb},{mac:"Mod-Delete",run:Xu}].concat(Sb.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),Ab=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:$0,shift:J0},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:V0,shift:Y0},{key:"Alt-ArrowUp",run:fb},{key:"Shift-Alt-ArrowUp",run:pb},{key:"Alt-ArrowDown",run:db},{key:"Shift-Alt-ArrowDown",run:mb},{key:"Escape",run:lb},{key:"Mod-Enter",run:wb},{key:"Alt-l",mac:"Ctrl-l",run:sb},{key:"Mod-i",run:ob,preventDefault:!0},{key:"Mod-[",run:xb},{key:"Mod-]",run:kb},{key:"Mod-Alt-\\",run:vb},{key:"Shift-Mod-k",run:gb},{key:"Shift-Mod-\\",run:q0},{key:"Mod-/",run:O0},{key:"Alt-A",run:E0}].concat(Tb);function lt(){var n=arguments[0];typeof n=="string"&&(n=document.createElement(n));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=t[i];typeof r=="string"?n.setAttribute(i,r):r!=null&&(n[i]=r)}e++}for(;e<arguments.length;e++)nf(n,arguments[e]);return n}function nf(n,e){if(typeof e=="string")n.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)n.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)nf(n,e[t]);else throw new RangeError("Unsupported child node: "+e)}class Cb{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class Qt{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let r=e,s=i.facet(tn).markerFilter;s&&(r=s(r));let o=ne.set(r.map(l=>l.from==l.to||l.from==l.to-1&&i.doc.lineAt(l.from).to==l.from?ne.widget({widget:new Bb(l),diagnostic:l}).range(l.from):ne.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity+(l.markClass?" "+l.markClass:"")},diagnostic:l}).range(l.from,l.to)),!0);return new Qt(o,t,Hn(o))}}function Hn(n,e=null,t=0){let i=null;return n.between(t,1e9,(r,s,{spec:o})=>{if(!(e&&o.diagnostic!=e))return i=new Cb(r,s,o.diagnostic),!1}),i}function Mb(n,e){let t=n.startState.doc.lineAt(e.pos);return!!(n.effects.some(i=>i.is(wl))||n.changes.touchesRange(t.from,t.to))}function Ob(n,e){return n.field(Ze,!1)?e:e.concat(te.appendConfig.of(af))}function Nb(n,e){return{effects:Ob(n,[wl.of(e)])}}const wl=te.define(),rf=te.define(),sf=te.define(),Ze=Mt.define({create(){return new Qt(ne.none,null,null)},update(n,e){if(e.docChanged){let t=n.diagnostics.map(e.changes),i=null;if(n.selected){let r=e.changes.mapPos(n.selected.from,1);i=Hn(t,n.selected.diagnostic,r)||Hn(t,null,r)}n=new Qt(t,n.panel,i)}for(let t of e.effects)t.is(wl)?n=Qt.init(t.value,n.panel,e.state):t.is(rf)?n=new Qt(n.diagnostics,t.value?vl.open:null,n.selected):t.is(sf)&&(n=new Qt(n.diagnostics,n.panel,t.value));return n},provide:n=>[Do.from(n,e=>e.panel),R.decorations.from(n,e=>e.diagnostics)]}),Eb=ne.mark({class:"cm-lintRange cm-lintRange-active"});function Db(n,e,t){let{diagnostics:i}=n.state.field(Ze),r=[],s=2e8,o=0;i.between(e-(t<0?1:0),e+(t>0?1:0),(a,c,{spec:h})=>{e>=a&&e<=c&&(a==c||(e>a||t>0)&&(e<c||t<0))&&(r.push(h.diagnostic),s=Math.min(a,s),o=Math.max(c,o))});let l=n.state.facet(tn).tooltipFilter;return l&&(r=l(r)),r.length?{pos:s,end:o,above:n.state.doc.lineAt(s).to<o,create(){return{dom:_b(n,r)}}}:null}function _b(n,e){return lt("ul",{class:"cm-tooltip-lint"},e.map(t=>lf(n,t,!1)))}const sc=n=>{let e=n.state.field(Ze,!1);return!e||!e.panel?!1:(n.dispatch({effects:rf.of(!1)}),!0)},Pb=Ge.fromClass(class{constructor(n){this.view=n,this.timeout=-1,this.set=!0;let{delay:e}=n.state.facet(tn);this.lintTime=Date.now()+e,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,e)}run(){let n=Date.now();if(n<this.lintTime-10)setTimeout(this.run,this.lintTime-n);else{this.set=!1;let{state:e}=this.view,{sources:t}=e.facet(tn);Promise.all(t.map(i=>Promise.resolve(i(this.view)))).then(i=>{let r=i.reduce((s,o)=>s.concat(o));this.view.state.doc==e.doc&&this.view.dispatch(Nb(this.view.state,r))},i=>{ut(this.view.state,i)})}}update(n){let e=n.state.facet(tn);(n.docChanged||e!=n.startState.facet(tn)||e.needsRefresh&&e.needsRefresh(n))&&(this.lintTime=Date.now()+e.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,e.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}}),tn=P.define({combine(n){return Object.assign({sources:n.map(e=>e.source)},ig(n.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t}))}});function Lb(n,e={}){return[tn.of({source:n,config:e}),Pb,af]}function of(n){let e=[];if(n)e:for(let{name:t}of n){for(let i=0;i<t.length;i++){let r=t[i];if(/[a-zA-Z]/.test(r)&&!e.some(s=>s.toLowerCase()==r.toLowerCase())){e.push(r);continue e}}e.push("")}return e}function lf(n,e,t){var i;let r=t?of(e.actions):[];return lt("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},lt("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(i=e.actions)===null||i===void 0?void 0:i.map((s,o)=>{let l=!1,a=f=>{if(f.preventDefault(),l)return;l=!0;let d=Hn(n.state.field(Ze).diagnostics,e);d&&s.apply(n,d.from,d.to)},{name:c}=s,h=r[o]?c.indexOf(r[o]):-1,u=h<0?c:[c.slice(0,h),lt("u",c.slice(h,h+1)),c.slice(h+1)];return lt("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${c}${h<0?"":` (access key "${r[o]})"`}.`},u)}),e.source&&lt("div",{class:"cm-diagnosticSource"},e.source))}class Bb extends Pi{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return lt("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class oc{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=lf(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class vl{constructor(e){this.view=e,this.items=[];let t=r=>{if(r.keyCode==27)sc(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:s}=this.items[this.selectedIndex],o=of(s.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==r.keyCode){let a=Hn(this.view.state.field(Ze).diagnostics,s);a&&s.actions[l].apply(e,a.from,a.to)}}else return;r.preventDefault()},i=r=>{for(let s=0;s<this.items.length;s++)this.items[s].dom.contains(r.target)&&this.moveSelection(s)};this.list=lt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:i}),this.dom=lt("div",{class:"cm-panel-lint"},this.list,lt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>sc(this.view)},"")),this.update()}get selectedIndex(){let e=this.view.state.field(Ze).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Ze),i=0,r=!1,s=null;for(e.between(0,this.view.state.doc.length,(o,l,{spec:a})=>{let c=-1,h;for(let u=i;u<this.items.length;u++)if(this.items[u].diagnostic==a.diagnostic){c=u;break}c<0?(h=new oc(this.view,a.diagnostic),this.items.splice(i,0,h),r=!0):(h=this.items[c],c>i&&(this.items.splice(i,c-i),r=!0)),t&&h.diagnostic==t.diagnostic?h.dom.hasAttribute("aria-selected")||(h.dom.setAttribute("aria-selected","true"),s=h):h.dom.hasAttribute("aria-selected")&&h.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new oc(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),s?(this.list.setAttribute("aria-activedescendant",s.id),this.view.requestMeasure({key:this,read:()=>({sel:s.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:l})=>{o.top<l.top?this.list.scrollTop-=l.top-o.top:o.bottom>l.bottom&&(this.list.scrollTop+=o.bottom-l.bottom)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let e=this.list.firstChild;function t(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Ze),i=Hn(t.diagnostics,this.items[e].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:sf.of(i)})}static open(e){return new vl(e)}}function Ib(n,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(n)}</svg>')`}function nr(n){return Ib(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${n}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Rb=R.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:nr("#d11")},".cm-lintRange-warning":{backgroundImage:nr("orange")},".cm-lintRange-info":{backgroundImage:nr("#999")},".cm-lintRange-hint":{backgroundImage:nr("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),af=[Ze,R.decorations.compute([Ze],n=>{let{selected:e,panel:t}=n.field(Ze);return!e||!t||e.from==e.to?ne.none:ne.set([Eb.range(e.from,e.to)])}),Hy(Db,{hideOn:Mb}),Rb],$b="#e5c07b",lc="#e06c75",Vb="#56b6c2",Fb="#ffffff",dr="#abb2bf",$o="#7d8799",Hb="#61afef",zb="#98c379",ac="#d19a66",Wb="#c678dd",jb="#21252b",cc="#2c313a",hc="#282c34",Hs="#353a42",Ub="#3E4451",uc="#528bff",Zb=R.theme({"&":{color:dr,backgroundColor:hc},".cm-content":{caretColor:uc},".cm-cursor, .cm-dropCursor":{borderLeftColor:uc},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Ub},".cm-panels":{backgroundColor:jb,color:dr},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:hc,color:$o,border:"none"},".cm-activeLineGutter":{backgroundColor:cc},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Hs},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Hs,borderBottomColor:Hs},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:cc,color:dr}}},{dark:!0}),kl=us.define([{tag:w.keyword,color:Wb},{tag:[w.name,w.deleted,w.character,w.propertyName,w.macroName],color:lc},{tag:[w.function(w.variableName),w.labelName],color:Hb},{tag:[w.color,w.constant(w.name),w.standard(w.name)],color:ac},{tag:[w.definition(w.name),w.separator],color:dr},{tag:[w.typeName,w.className,w.number,w.changed,w.annotation,w.modifier,w.self,w.namespace],color:$b},{tag:[w.operator,w.operatorKeyword,w.url,w.escape,w.regexp,w.link,w.special(w.string)],color:Vb},{tag:[w.meta,w.comment],color:$o},{tag:w.strong,fontWeight:"bold"},{tag:w.emphasis,fontStyle:"italic"},{tag:w.strikethrough,textDecoration:"line-through"},{tag:w.link,color:$o,textDecoration:"underline"},{tag:w.heading,fontWeight:"bold",color:lc},{tag:[w.atom,w.bool,w.special(w.variableName)],color:ac},{tag:[w.processingInstruction,w.string,w.inserted],color:zb},{tag:w.invalid,color:Fb}]),qb=[Zb,Nu(kl)],Kb=dn("<div>");async function Gb(n){const e=[];return await n.highlightSyntax("",(t,i,r,s)=>{const o=[{function:w.function(w.variableName),variable:w.variableName,macro:w.macroName,bracket:w.bracket,operator:w.operator,number:w.number,string:w.string,namespace:w.namespace,keyword:w.keyword,type:w.typeName,enumMember:w.constant(w.variableName)}[s]],l=kl.style(o);e.push(ne.mark({class:l}).range(i,r))}),le.of(e.sort((t,i)=>t.from-i.from))}const Jb=(n,e)=>Ge.fromClass(class{constructor(t){this.decorations=le.of([])}async update(t){await new Promise(i=>setTimeout(i,1)),e(t.view.state.doc.toString()),this.decorations=await Gb(n),t.view.update([])}},{decorations:t=>t.decorations});function Yb(n){return(()=>{const e=Kb();return ts(t=>{kc(t,()=>{const i=new Set,r=()=>{for(const c of i)c()},[s,o]=at(n.code()),l=Hm({readFile:()=>Promise.resolve(new TextEncoder().encode(a.state.doc.toString())),resolvePath:c=>c,dirname:c=>c,relativePath:c=>c,watchFile:(c,h)=>(i.add(h),()=>i.delete(h)),writeFile:c=>Promise.resolve()}),a=new R({doc:n.code(),parent:t,extensions:[Jb(l,o),Nu(kl,{fallback:!0}),bu.of(Ab),R.updateListener.of(c=>{r(),n.setCode(c.state.doc.toString())}),Lb(async()=>{const c=[];return await l.getErrors("",(h,u,f)=>{c.push({from:h,to:u,severity:"error",message:f})}),c}),qb]});Vo(()=>{n.code()!==a.state.doc.toString()&&a.dispatch({changes:{from:0,to:a.state.doc.length,insert:n.code()}})})})},e),e})()}const Xb=dn('<div class="desmoscript-example">');function Qb(n){const[e,t]=at(void 0),[i,r]=at(n.children),[s,o]=at(Date.now()),[l,a]=at(!0);return setInterval(async()=>{if(Date.now()-s()>500&&l()){a(!1);const c=await rh(i(),{unsavedFiles:new Map([["index.desmo",i()]]),watchFiles:new Set,options:{annotateExpressionsWithEquivalentDesmoscript:!1},io:{readFile:()=>Promise.resolve(new TextEncoder().encode(i())),resolvePath:h=>h,dirname:h=>h,relativePath:h=>h,writeFile:h=>Promise.resolve(),watchFile:h=>{}}});c.type==="success"&&t(c.state)}},100),(()=>{const c=Xb();return se(c,Y(Yb,{class:"codemirror-container",code:i,setCode:h=>{i()!==h&&(r(h),o(Date.now()),a(!0))}}),null),se(c,Y(Wf,{state:()=>e(),class:"desmos-container",get graphpaper(){return n.graphpaper}}),null),c})()}const ew=n=>e=>{const[t,i]=at(void 0);return(async()=>i(await(await fetch(n+e.children+".desmo")).text()))(),Y(Ws,{get when(){return t()!==void 0},get children(){return Y(Qb,{get children(){return t()}})}})},cf=dn("<ol>"),tw=dn("<li><a>");function fc(n){const e=Number(n.tagName[1]);return isNaN(e)?7:e}function hf(n){const e=()=>n.headers()[n.position()],t=()=>fc(e()),i=()=>{const s=[];let o=n.position()+1;const l=n.headers();for(;o<l.length;){const a=fc(l[o]);if(a===t()+1)s.push(o);else if(a<=t())break;o++}return s},r=()=>n.onscreen().has(n.position());return Y(Ws,{get when(){return e()!==void 0},get children(){const s=tw(),o=s.firstChild;return ts(l=>{Vo(()=>{r()&&n.position()===Math.min(...n.onscreen().values())&&n.scrollNav(l.offsetTop)})},s),se(o,()=>e().innerHTML),se(s,Y(Ws,{get when(){return i().length>0},get children(){const l=cf();return se(l,Y(xf,{get each(){return i()},children:a=>Y(hf,{position:()=>a,get headers(){return n.headers},get onscreen(){return n.onscreen},get scrollNav(){return n.scrollNav}})})),l}}),null),nn(l=>{const a=r()?"onscreen":"",c="#"+e().id;return a!==l._v$&&vc(o,l._v$=a),c!==l._v$2&&br(o,"href",l._v$2=c),l},{_v$:void 0,_v$2:void 0}),s}})}function nw(n){const[e,t]=at([]),[i,r]=at(),[s,o]=at(new Set),l=()=>{const c=Array.from(n.scope.querySelectorAll("h1, h2, h3, h4, h5, h6")).filter(f=>f instanceof HTMLElement);t(c);const h=new Map(c.map((f,d)=>[f,d]));i()?.disconnect();const u=new IntersectionObserver(f=>{const d=new Set(s());for(const p of f)p.target instanceof HTMLElement&&(p.isIntersecting?d.add(h.get(p.target)??-1):d.delete(h.get(p.target)??-1));o(d)},{threshold:1,rootMargin:"0px"});for(const f of c)u.observe(f);r(u)};return l(),new MutationObserver(()=>{l()}).observe(n.scope,{subtree:!0,childList:!0}),(()=>{const c=cf();return se(c,Y(hf,{position:()=>0,headers:e,onscreen:s,get scrollNav(){return n.scrollNav}})),c})()}const iw=dn('<nav><div class="nav-inner">'),rw=dn(`<main><h1 id="desmoscript-docs">Desmoscript Docs</h1><h2 id="basics">Basics</h2><p>These are the docs for the Desmoscript programming language.</p><h3 id="minimal-example">Minimal Example</h3><h3 id="functions">Functions</h3><p>In Desmoscript, there is no <code>return</code> keyword. An expression is inferred to be a function's return value if it is the last expression in the function body. Unlike normal statements and expressions, this last expression should <em>not</em> end with a semicolon.</p><h3 id="text-notes-comments">Notes (AKA Text or Comments)</h3><p>You can create text expression in Desmos (and comment your code, too) by creating notes, which can simply be made by enclosing text in quotes.</p><h3 id="settings">Settings</h3><p>Change the graph settings with the <code>settings</code> keyword followed by a JSON literal (denoted by <code>@{}</code>). This follows almost exactly the same format as the <code>graph</code> property of the value returned by <code>Calc.getState()</code> in the developer console.</p><h2 id="data-types">Data Types</h2><h3 id="points">Points</h3><p>Points are notated in a manner identical to how Desmos notates them.</p><h3 id="lists">Lists</h3><p>Lists are notated similar to how they're notated in Desmos, except for ranges, Desmoscript uses <code>..</code> (two dots, not three).</p><h4 id="listcomps">List Comprehensions (Listcomps)</h4><p>List comprehensions use a syntax very similar to Desmos's.</p><h3 id="colors">Colors</h3><p>Colors are generated as normal. Use the <code>colorLatex</code> property to use computed colors. For more on how to display things, visit <a href="#display">this section</a>.</p><h3 id="polygons">Polygons</h3><h2 id="control-flow">Control Flow and Lifecycle</h2><h3 id="piecewise">Piecewise</h3><p>This is the syntax for piecewise functions, which are the Desmos equivalent of if-statements.</p><h3 id="actions">Actions</h3><p>Actions are an "escape hatch" from Desmos's normal lifecycle that allow mutations to variables to occur where they normally shouldn't happen. They are a powerful tool for implementing recursive operations, game loops, and other such "loop"-y structures that normal Desmos isn't particularly suited to. However, they should be used sparingly, as they can make projects harder to reason about and tend to be slower than simply updating a variable normally.</p><h4 id="cond-actions">Conditional Actions</h4><p>Actions can be placed in piecewises, allowing them to be updated conditionally.</p><h2 id="display">Display</h2><p>You can display expressions by appending them with a JSON-like data structure, like the example below. This JSON-like data structure follows the same format as the one you would get from <code>Calc.getState().expressions.list</code>.</p><p>Note that one of the properties being set here (<code>lineWidth</code>) is being set to <code>ds(25)</code>, not just <code>25</code>. This is done because <code>lineWidth</code> can be any desmoscript expression, not just a constant number. In general, the <code>ds()</code> keyword allows you to insert desmoscript into expression properties. <em>Keep this in mind while setting properties that you'd expect to be numbers, because they're often actually strings under-the-hood to support arbitrary Desmos expressions.</em></p><h2 id="macros">Macros</h2><h3 id="subst-macros">Substitution Macros</h3><p>Use the <code>subst!()</code> macro to create substitution macros.</p><h3 id="js-macros">JS Macros</h3><p>You can also directly call JavaScript code from desmoscript, allowing you to create macros that run arbitrary JavaScript, including operations such as file I/O. <a href="https://github.com/radian628/desmoscript/tree/main/examples/suzanne">See here for an example.`),Le=ew("../assets/examples/"),sw=()=>{let n;return[(()=>{const e=iw(),t=e.firstChild;return ts(i=>{n=i},t),se(t,Y(nw,{get scope(){return document.body},scrollNav:i=>{n.scrollTop=i-n.clientHeight/2}})),e})(),(()=>{const e=rw(),t=e.firstChild,i=t.nextSibling,r=i.nextSibling,s=r.nextSibling,o=s.nextSibling,l=o.nextSibling,a=l.nextSibling,c=a.nextSibling,h=c.nextSibling,u=h.nextSibling,f=u.nextSibling,d=f.nextSibling,p=d.nextSibling,g=p.nextSibling,y=g.nextSibling,b=y.nextSibling,v=b.nextSibling,A=v.nextSibling,k=A.nextSibling,E=k.nextSibling,N=E.nextSibling,z=N.nextSibling,re=z.nextSibling,F=re.nextSibling,V=F.nextSibling,K=V.nextSibling,he=K.nextSibling,ae=he.nextSibling,Re=ae.nextSibling,ze=Re.nextSibling,De=ze.nextSibling,Bi=De.nextSibling,Ye=Bi.nextSibling,$e=Ye.nextSibling;return se(e,Y(Le,{children:"first"}),o),se(e,Y(Le,{children:"functions"}),a),se(e,Y(Le,{children:"notes"}),h),se(e,Y(Le,{children:"settings"}),f),se(e,Y(Le,{children:"points"}),g),se(e,Y(Le,{children:"lists"}),b),se(e,Y(Le,{children:"listcomps"}),A),se(e,Y(Le,{children:"colors"}),E),se(e,Y(Le,{children:"polygons"}),N),se(e,Y(Le,{children:"piecewise"}),F),se(e,Y(Le,{children:"actions"}),K),se(e,Y(Le,{children:"cond-actions"}),ae),se(e,Y(Le,{children:"show"}),De),se(e,Y(Le,{children:"subst"}),$e),e})()]},ow=document.getElementById("root");_f(()=>Y(sw,{}),ow);document.body.classList.toggle("dark",matchMedia("(prefers-color-scheme: dark)").matches);
